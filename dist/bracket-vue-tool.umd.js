(function(w,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(w=typeof globalThis<"u"?globalThis:w||self,t(w.BracketVueTool={},w.Vue))})(this,function(w,t){"use strict";const I={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination"},p="TBD",d={ONE:"teamOne",TWO:"teamTwo"},g={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},x=(l,i)=>{const a=l.__vccOpts||l;for(const[e,r]of i)a[e]=r;return a},q={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(l,{expose:i,emit:a}){i();const e=l,r=a,n=t.ref(e.team.name),o=t.computed(()=>{var f;return n.value===p?null:((f=e.availableTeams.find(O=>O.name===n.value))==null?void 0:f.logo)||null});t.watch(()=>e.team,f=>{n.value=f.name},{immediate:!0}),t.onMounted(()=>{console.log("TeamSelect mounted:",{team:e.team,availableTeams:e.availableTeams})});const h=f=>f===p?!1:e.selectedTeams.includes(f)&&f!==e.team.name||f===e.team.name&&e.team.name!==p,c=t.computed(()=>e.availableTeams?e.availableTeams.filter(f=>f.name===p||f.name===e.team.name?!0:!h(f.name)):[]),b={props:e,emit:r,selectedTeam:n,selectedTeamLogo:o,isTeamSelected:h,availableTeamsForSelection:c,highlightTeam:()=>{e.team.name!==p&&r("highlight-team",e.team.name)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:()=>{const f=e.availableTeams.find(O=>O.name===n.value);console.log("Updating team:",{selectedTeam:n.value,selectedTeamData:f}),r("update:team",{position:e.teamPosition,team:{id:(f==null?void 0:f.id)||null,name:n.value,logo:(f==null?void 0:f.logo)||null,score:0}})},ref:t.ref,computed:t.computed,onMounted:t.onMounted,watch:t.watch,get TBD(){return p},get PERMISSIONS(){return g}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}},W={key:0,class:"flex items-center gap-2"},j=["src","alt"],v=["value","disabled"],F={key:1,class:"flex items-center gap-2"},H=["src","alt"],z={class:"text-gray-900 dark:text-white"};function J(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":a.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":a.isLoser,"bg-green-500/20 dark:bg-green-500/20":a.shouldHighlight&&a.isWinner,"bg-red-500/20 dark:bg-red-500/20":a.shouldHighlight&&a.isLoser}]),onMouseenter:e.highlightTeam,onMouseleave:e.unhighlightTeam},[a.canEdit&&a.permissions[e.PERMISSIONS.CAN_SELECT_TEAM]?(t.openBlock(),t.createElementBlock("div",W,[e.selectedTeamLogo?(t.openBlock(),t.createElementBlock("img",{key:0,src:e.selectedTeamLogo,alt:e.selectedTeam,class:"w-6 h-6 rounded-full"},null,8,j)):t.createCommentVNode("v-if",!0),t.withDirectives(t.createElementVNode("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>e.selectedTeam=o),class:"fi-select-input p-0 w-full border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900 hover:cursor-pointer",onChange:e.updateTeam},[i[1]||(i[1]=t.createElementVNode("option",{value:"TBD"},"TBD",-1)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.availableTeamsForSelection,o=>(t.openBlock(),t.createElementBlock("option",{key:o.id,value:o.name,disabled:e.isTeamSelected(o.name)},t.toDisplayString(o.name),9,v))),128))],544),[[t.vModelSelect,e.selectedTeam]])])):(t.openBlock(),t.createElementBlock("div",F,[a.team.logo?(t.openBlock(),t.createElementBlock("img",{key:0,src:a.team.logo,alt:a.team.name,class:"w-6 h-6 rounded-full"},null,8,H)):t.createCommentVNode("v-if",!0),t.createElementVNode("span",z,t.toDisplayString(a.team.name),1)]))],34)}const G=x(q,[["render",J],["__file","/app/src/components/team/TeamSelect.vue"]]),Z={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(l,{expose:i,emit:a}){i();const e=l,r=a,n=t.ref(!1),o=t.ref(e.team.score??0),h=()=>{e.canEditScore&&(n.value=!0)},c=()=>{const T=parseInt(o.value)||0;r("update:score",{position:e.teamPosition,score:T})};t.watch(()=>e.team,T=>{o.value=T.score??0},{deep:!0});const N={props:e,emit:r,isEditing:n,score:o,selectScore:h,updateScore:c,ref:t.ref,watch:t.watch};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},K={key:1,class:"text-white"};function Q(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":a.isFirstTeam}]),onClick:e.selectScore},[e.isEditing?t.withDirectives((t.openBlock(),t.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":i[0]||(i[0]=o=>e.score=o),class:"w-12 border-none bg-orange-500 dark:bg-orange-600 text-center text-white text-base transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",min:"0",onChange:e.updateScore,onBlur:i[1]||(i[1]=o=>e.isEditing=!1)},null,544)),[[t.vModelText,e.score]]):(t.openBlock(),t.createElementBlock("span",K,t.toDisplayString(a.team.score),1))],2)}const X=x(Z,[["render",Q],["__file","/app/src/components/team/TeamScoreInput.vue"]]),Y={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0,[g.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(l,{expose:i}){i();const e={props:l,TeamSelect:G,TeamScoreInput:X,get PERMISSIONS(){return g}};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},$={class:"flex"};function ee(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",$,[t.createVNode(e.TeamSelect,{team:a.team,"team-position":a.teamPosition,"available-teams":a.availableTeams,"selected-teams":a.selectedTeams,"highlighted-team":a.highlightedTeam,permissions:a.permissions,"can-edit":a.canEdit,"is-winner":a.isWinner,"is-loser":a.isLoser,"should-highlight":a.shouldHighlight,"is-first-team":a.isFirstTeam,"onUpdate:team":i[0]||(i[0]=o=>l.$emit("update:team",o)),onHighlightTeam:i[1]||(i[1]=o=>l.$emit("highlight-team",o)),onUnhighlightTeam:i[2]||(i[2]=o=>l.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),t.createVNode(e.TeamScoreInput,{team:a.team,"team-position":a.teamPosition,"can-edit-score":a.canEditScore,"is-first-team":a.isFirstTeam,"onUpdate:score":i[3]||(i[3]=o=>l.$emit("update:score",o))},null,8,["team","team-position","can-edit-score","is-first-team"])])}const te=x(Y,[["render",ee],["__file","/app/src/components/team/TeamRow.vue"]]),ae={__name:"BracketMatch",props:{match:{type:Object,required:!0,default:()=>({teamOne:{name:p,score:0},teamTwo:{name:p,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0,[g.CAN_EDIT_DATE]:!0,[g.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(l,{expose:i,emit:a}){i();const e=l,r=a,n=t.computed(()=>e.roundIndex===0&&e.permissions[g.CAN_SELECT_TEAM]),o=t.computed(()=>e.match[d.ONE].name!==p&&e.match[d.TWO].name!==p&&e.permissions[g.CAN_EDIT_SCOPE]),u={props:e,emit:r,canEdit:n,canEditScore:o,isWinner:s=>e.match.winner===s,isLoser:s=>e.match.winner&&e.match.winner!==s,shouldHighlight:s=>{const m=e.match[s].name;return e.highlightedTeam===m},highlightTeam:s=>{r("highlight-team",s)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:({position:s,team:m})=>{const _={...e.match,[s]:m};r("update:match",_)},updateScore:({position:s,score:m})=>{const _={...e.match,[s]:{...e.match[s],score:m}};_[d.ONE].score>_[d.TWO].score?_.winner=d.ONE:_[d.TWO].score>_[d.ONE].score?_.winner=d.TWO:_.winner=null,r("update:match",_)},formatDateTimeForInput:s=>s?new Date(s).toISOString().slice(0,16):"",updateDate:s=>{const m={...e.match,date:s.target.value};r("update:match",m)},formatDate:s=>s?new Date(s).toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}):"",onMatchClick:s=>{const m=s.target.tagName.toLowerCase();m==="input"||m==="select"||m==="option"||m==="button"||s.target.closest("input,select,option,button")||!(!e.permissions[g.CAN_SELECT_TEAM]&&!e.permissions[g.CAN_EDIT_DATE]&&!e.permissions[g.CAN_EDIT_SCOPE])||r("click-match",{match:e.match,roundIndex:e.roundIndex,matchIndex:e.index,id:e.match.id??null})},computed:t.computed,TeamRow:te,get TBD(){return p},get TEAM_POSITION(){return d},get PERMISSIONS(){return g}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}},ne={class:"flex flex-col w-full"},oe={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},re=["value","disabled"],ie={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"};function le(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["relative text-[0.8em] flex items-center",{group:a.index%2==0&&a.totalMatches>1}])},[t.createElementVNode("div",ne,[t.createElementVNode("div",oe,[t.createElementVNode("input",{type:"datetime-local",value:e.formatDateTimeForInput(a.match.date),onInput:e.updateDate,class:"bg-transparent border-none focus:ring-0 p-0 text-xs",disabled:!a.permissions[e.PERMISSIONS.CAN_EDIT_DATE]},null,40,re)]),t.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:e.onMatchClick},[t.createVNode(e.TeamRow,{team:a.match.teamOne,"team-position":e.TEAM_POSITION.ONE,"available-teams":a.availableTeams,"selected-teams":a.selectedTeams,"can-edit":e.canEdit,"can-edit-score":e.canEditScore,"is-winner":e.isWinner(e.TEAM_POSITION.ONE),"is-loser":e.isLoser(e.TEAM_POSITION.ONE),"should-highlight":e.shouldHighlight(e.TEAM_POSITION.ONE),"is-first-team":!0,"can-select-team":l.canSelectTeam,"highlighted-team":a.highlightedTeam,permissions:a.permissions,"onUpdate:team":e.updateTeam,"onUpdate:score":e.updateScore,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),t.createVNode(e.TeamRow,{team:a.match.teamTwo,"team-position":e.TEAM_POSITION.TWO,"available-teams":a.availableTeams,"selected-teams":a.selectedTeams,"can-edit":e.canEdit,"can-edit-score":e.canEditScore,"is-winner":e.isWinner(e.TEAM_POSITION.TWO),"is-loser":e.isLoser(e.TEAM_POSITION.TWO),"should-highlight":e.shouldHighlight(e.TEAM_POSITION.TWO),"can-select-team":l.canSelectTeam,"highlighted-team":a.highlightedTeam,permissions:a.permissions,"onUpdate:team":e.updateTeam,"onUpdate:score":e.updateScore,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),a.index%2==0&&a.totalMatches>1?(t.openBlock(),t.createElementBlock("div",ie,i[0]||(i[0]=[t.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):t.createCommentVNode("v-if",!0)],2)}const se=x(ae,[["render",le],["__file","/app/src/components/bracket/BracketMatch.vue"]]),ce={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(l,{expose:i,emit:a}){i();const e=l,r=a,h={props:e,emit:r,updateMatch:(c,N)=>{r("update:match",e.columnIndex,c,N)},onClickMatch:(c,N)=>{r("click-match",{...N,roundIndex:e.columnIndex,matchIndex:c})},BracketMatch:se,get PERMISSIONS(){return g}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},me={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},de={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"};function he(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",me,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(a.column.matches,(o,h)=>(t.openBlock(),t.createElementBlock(t.Fragment,{key:o.id},[t.createElementVNode("div",de,t.toDisplayString(o.number),1),t.createVNode(e.BracketMatch,{match:o,index:h,"total-matches":a.column.matches.length,"round-index":a.columnIndex,"available-teams":a.availableTeams,"selected-teams":a.selectedTeams,"highlighted-team":a.highlightedTeam,permissions:a.permissions,"onUpdate:match":c=>e.updateMatch(h,c),onHighlightTeam:i[0]||(i[0]=c=>l.$emit("highlight-team",c)),onUnhighlightTeam:i[1]||(i[1]=c=>l.$emit("unhighlight-team")),onClickMatch:c=>e.onClickMatch(h,c)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))])}const L=x(ce,[["render",he],["__file","/app/src/components/bracket/BracketColumn.vue"]]),ue={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(l,{expose:i,emit:a}){i();const e=l,r=a,n=[1,3,5,7,9],o=t.ref(e.columns.map(T=>T.name));t.watch(()=>e.columns,T=>{o.value=T.map(k=>k.name)},{deep:!0});const N={props:e,emit:r,bestOfValues:n,localColumnNames:o,updateColumnName:(T,k)=>{o.value[T]=k;const b=[...e.columns];b[T]={...b[T],name:k},r("update:columns",b)},updateColumnBestOf:(T,k)=>{const b=[...e.columns];b[T]={...b[T],bestOf:Number(k)},r("update:columns",b)},ref:t.ref,watch:t.watch,get PERMISSIONS(){return g}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},ge={class:"flex justify-between px-5"},fe={class:"flex flex-col items-center gap-2"},_e={class:"mt-2"},pe={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},Te=["onUpdate:modelValue","onBlur","disabled"],Ee={class:"grid shrink-0 grid-cols-1 focus-within:relative"},be=["value","onChange","disabled"],Ne=["value"];function Se(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",ge,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(a.columns,(o,h)=>(t.openBlock(),t.createElementBlock("div",{key:o.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[t.createElementVNode("div",fe,[t.createElementVNode("div",_e,[t.createElementVNode("div",pe,[t.withDirectives(t.createElementVNode("input",{type:"text","onUpdate:modelValue":c=>e.localColumnNames[h]=c,onBlur:c=>e.updateColumnName(h,c.target.value),disabled:!a.permissions[e.PERMISSIONS.CAN_EDIT_ROUND_NAME],class:"block min-w-0 grow py-1.5 pr-3 text-gray-800 dark:text-white border-none pl-1 text-base text-gray-900 bg-white dark:bg-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6"},null,40,Te),[[t.vModelText,e.localColumnNames[h]]]),t.createElementVNode("div",Ee,[t.createElementVNode("select",{value:o.bestOf,onChange:c=>e.updateColumnBestOf(h,c.target.value),disabled:!a.permissions[e.PERMISSIONS.CAN_EDIT_BEST_OF],class:"col-start-1 row-start-1 w-full text-gray-800 dark:text-white border-none appearance-none py-1.5 bg-white dark:bg-gray-900 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"},[(t.openBlock(),t.createElementBlock(t.Fragment,null,t.renderList(e.bestOfValues,c=>t.createElementVNode("option",{key:c,value:c}," Best of "+t.toDisplayString(c),9,Ne)),64))],40,be),t.createCommentVNode(` <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
          <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg> `)])])])])]))),128))])}const P=x(ue,[["render",Se],["__file","/app/src/components/bracket/BracketRoundHeaders.vue"]]),Oe={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:l=>[1,3,5,7,9].includes(l)},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0,[g.CAN_EDIT_DATE]:!0,[g.CAN_EDIT_SCOPE]:!0,[g.CAN_EDIT_ROUND_NAME]:!0,[g.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state"],setup(l,{expose:i,emit:a}){i();const e=a,r=l,n=t.ref([]),o=t.ref(null),h=t.computed(()=>{const E=new Set;return n.value.forEach(B=>{B.matches.forEach(S=>{S[d.ONE].name!==p&&E.add(S[d.ONE].name),S[d.TWO].name!==p&&E.add(S[d.TWO].name)})}),Array.from(E)}),c=E=>{o.value=E},N=()=>{o.value=null},T=(E,B,S)=>{if(console.log("Updating lower match:",{roundIndex:E,matchIndex:B,updatedMatch:S}),n.value[E]&&n.value[E].matches){if(n.value[E].matches[B]=S,S.winner&&E<n.value.length-1){const u=E+1,s=Math.floor(B/2);if(n.value[u]&&n.value[u].matches[s]){const m=n.value[u].matches[s],_=B%2===0?d.ONE:d.TWO,y=S[S.winner];n.value[u].matches[s]={...m,[_]:{id:y.id,name:y.name,logo:y.logo,score:0}}}}b()}},k=E=>{console.log("Updating lower columns:",E),n.value=E,b()},b=()=>{console.log("Emitting lower tournament state:",n.value),e("update:state",n.value)},f=()=>{console.log("Initializing lower tournament with state:",r.initialState),r.initialState&&r.initialState.length>0&&(n.value=JSON.parse(JSON.stringify(r.initialState)))};t.watch(()=>r.initialState,()=>{f()},{deep:!0}),t.onMounted(()=>{f()});const O={emit:e,props:r,columns:n,highlightedTeam:o,selectedTeams:h,highlightTeam:c,unhighlightTeam:N,updateMatch:T,updateColumns:k,emitTournamentState:b,initializeTournament:f,ref:t.ref,onMounted:t.onMounted,watch:t.watch,computed:t.computed,BracketColumn:L,BracketRoundHeaders:P,get TBD(){return p},get TEAM_POSITION(){return d},get PERMISSIONS(){return g}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}},ke={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},ye={class:"flex flex-col"},we={class:"overflow-x-auto"},Be={class:"min-w-max"},xe={class:"flex flex-1 p-5"};function Ie(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",ke,[i[0]||(i[0]=t.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Lower Bracket",-1)),t.createElementVNode("div",ye,[t.createElementVNode("div",we,[t.createElementVNode("div",Be,[t.createVNode(e.BracketRoundHeaders,{columns:e.columns,"onUpdate:columns":e.updateColumns,permissions:a.permissions},null,8,["columns","permissions"]),t.createElementVNode("div",xe,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.columns,(o,h)=>(t.openBlock(),t.createBlock(e.BracketColumn,{key:o.id,column:o,"column-index":h,"available-teams":a.availableTeams,"selected-teams":e.selectedTeams,"highlighted-team":e.highlightedTeam,permissions:a.permissions,"onUpdate:match":e.updateMatch,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])])])}const Me=x(Oe,[["render",Ie],["__file","/app/src/components/bracket/BracketLower.vue"]]),U=()=>({id:null,name:p,logo:null,score:0}),V=l=>({id:`match-${l}`,number:l,[d.ONE]:U(),[d.TWO]:U(),winner:null,date:null}),Ce=(l,i=3)=>{const a=[],e=Math.log2(l);let r=1;for(let n=0;n<e;n++){const o=Math.pow(2,e-n-1),h=[];for(let c=0;c<o;c++)h.push(V(r++));a.push({id:`upper-round-${n+1}`,name:`Round ${n+1}`,matches:h,bestOf:i})}return a},A=(l,i)=>{const a=[];let e=1;const r=l-1;for(let n=0;n<r;n++){const o=Math.pow(2,l-n-2),h=[];for(let c=0;c<o;c++)h.push(V(e++));a.push({id:`lower-round-${n+1}`,name:`Lower Round ${n+1}`,matches:h,bestOf:i})}return a},Ae={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,required:!0,default:()=>({[g.CAN_SELECT_TEAM]:!0,[g.CAN_EDIT_ROUND_NAME]:!0,[g.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(l,{expose:i,emit:a}){i();const e=a,r=l,n=t.ref([]),o=t.ref([]),h=t.ref(null),c=t.computed(()=>{const u=new Set;return n.value.forEach(s=>{s.matches.forEach(m=>{m[d.ONE].name!==p&&u.add(m[d.ONE].name),m[d.TWO].name!==p&&u.add(m[d.TWO].name)})}),r.format===I.DOUBLE_ELIMINATION&&o.value.forEach(s=>{s.matches.forEach(m=>{m[d.ONE].name!==p&&u.add(m[d.ONE].name),m[d.TWO].name!==p&&u.add(m[d.TWO].name)})}),Array.from(u)}),N=u=>{h.value=u},T=()=>{h.value=null},k=(u,s,m)=>{if(console.log("Updating upper match:",{roundIndex:u,matchIndex:s,updatedMatch:m}),n.value[u]&&n.value[u].matches){if(n.value[u].matches[s]=m,m.winner&&u<n.value.length-1){const _=u+1,y=Math.floor(s/2);if(n.value[_]&&n.value[_].matches[y]){const M=n.value[_].matches[y],D=s%2===0?d.ONE:d.TWO,C=m[m.winner];n.value[_].matches[y]={...M,[D]:{id:C.id,name:C.name,logo:C.logo,score:0}}}}if(r.format===I.DOUBLE_ELIMINATION&&m.winner){const _=m[m.winner===d.ONE?d.TWO:d.ONE];if(_.name!==p){const y=Math.floor(u/2),M=Math.floor(s/2);if(o.value[y]&&o.value[y].matches[M]){const D=o.value[y].matches[M],C=s%2===0?d.ONE:d.TWO;o.value[y].matches[M]={...D,[C]:{id:_.id,name:_.name,logo:_.logo,score:0}}}}}O()}},b=u=>{console.log("Updating upper columns:",u),n.value=u,O()},f=u=>{console.log("Updating lower state:",u),o.value=u,O()},O=()=>{console.log("Emitting tournament state:",{upper:n.value,lower:r.format===I.DOUBLE_ELIMINATION?o.value:null}),e("update:state",{upper:n.value,lower:r.format===I.DOUBLE_ELIMINATION?o.value:null})},E=()=>{console.log("Initializing tournament with state:",r.initialState),r.initialState&&(Array.isArray(r.initialState)?(n.value=JSON.parse(JSON.stringify(r.initialState)),r.format===I.DOUBLE_ELIMINATION&&(o.value=A(n.value.length,r.defaultBestOf))):(n.value=JSON.parse(JSON.stringify(r.initialState.upper||[])),o.value=JSON.parse(JSON.stringify(r.initialState.lower||[]))))};t.watch(()=>r.initialState,()=>{E()},{deep:!0}),t.watch(()=>r.format,u=>{u===I.DOUBLE_ELIMINATION&&(!o.value||o.value.length===0)&&(o.value=A(n.value.length,r.defaultBestOf),O())});const B=u=>{e("click-match",u)};t.onMounted(()=>{E()});const S={emit:e,props:r,upperColumns:n,lowerColumns:o,highlightedTeam:h,selectedTeams:c,highlightTeam:N,unhighlightTeam:T,updateUpperMatch:k,updateUpperColumns:b,updateLowerState:f,emitTournamentState:O,initializeTournament:E,onMatchClick:B,ref:t.ref,onMounted:t.onMounted,watch:t.watch,computed:t.computed,BracketColumn:L,BracketRoundHeaders:P,BracketLower:Me,get createLowerBracketStructure(){return A},get TOURNAMENT_FORMAT(){return I},get TBD(){return p},get TEAM_POSITION(){return d},get PERMISSIONS(){return g}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},De={class:"flex flex-col"},Le={class:"flex flex-col"},Pe={class:"overflow-x-auto"},Ue={class:"min-w-max"},Ve={class:"flex flex-1 p-5"};function Re(l,i,a,e,r,n){return t.openBlock(),t.createElementBlock("div",De,[i[0]||(i[0]=t.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Upper Bracket",-1)),t.createElementVNode("div",Le,[t.createElementVNode("div",Pe,[t.createElementVNode("div",Ue,[t.createVNode(e.BracketRoundHeaders,{columns:e.upperColumns,"onUpdate:columns":e.updateUpperColumns,permissions:a.permissions},null,8,["columns","permissions"]),t.createElementVNode("div",Ve,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.upperColumns,(o,h)=>(t.openBlock(),t.createBlock(e.BracketColumn,{key:o.id,column:o,"column-index":h,"available-teams":a.availableTeams,"selected-teams":e.selectedTeams,"highlighted-team":e.highlightedTeam,permissions:a.permissions,"onUpdate:match":e.updateUpperMatch,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam,onClickMatch:e.onMatchClick},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])]),a.format===e.TOURNAMENT_FORMAT.DOUBLE_ELIMINATION?(t.openBlock(),t.createBlock(e.BracketLower,{key:0,"initial-state":e.lowerColumns,"available-teams":a.availableTeams,"default-best-of":a.defaultBestOf,permissions:a.permissions,"onUpdate:state":e.updateLowerState},null,8,["initial-state","available-teams","default-best-of","permissions"])):t.createCommentVNode("v-if",!0)])}const R=x(Ae,[["render",Re],["__file","/app/src/components/TournamentBracket.vue"]]),qe=l=>{l.component("TournamentBracket",R)};w.PERMISSIONS=g,w.TournamentBracket=R,w.createLowerBracketStructure=A,w.createTournamentState=Ce,w.install=qe,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
