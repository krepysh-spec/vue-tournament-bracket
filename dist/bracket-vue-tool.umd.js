(function(w,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(w=typeof globalThis<"u"?globalThis:w||self,e(w.BracketVueTool={},w.Vue))})(this,function(w,e){"use strict";const N={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination"},T="TBD",c={ONE:"teamOne",TWO:"teamTwo"},I={key:0,class:"relative"},q=["value","disabled"],W=["src","alt"],C={key:1,class:"flex items-center gap-2"},D=["src","alt"],R={class:"text-gray-900 dark:text-white"},F={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=e.ref(a.team.name),i=e.computed(()=>{var s;return n.value===T?null:((s=a.availableTeams.find(y=>y.name===n.value))==null?void 0:s.logo)||null});e.watch(()=>a.team,s=>{n.value=s.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const d=s=>s===T?!1:a.selectedTeams.includes(s)&&s!==a.team.name||s===a.team.name&&a.team.name!==T,u=e.computed(()=>a.availableTeams?a.availableTeams.filter(s=>s.name===T||s.name===a.team.name?!0:!d(s.name)):[]),h=()=>{a.team.name!==T&&l("highlight-team",a.team.name)},m=()=>{l("unhighlight-team")},k=()=>{const s=a.availableTeams.find(y=>y.name===n.value);console.log("Updating team:",{selectedTeam:n.value,selectedTeamData:s}),l("update:team",{position:a.teamPosition,team:{id:(s==null?void 0:s.id)||null,name:n.value,logo:(s==null?void 0:s.logo)||null,score:0}})};return(s,y)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200 dark:hover:bg-gray-700",{"hover:bg-green-900/30 dark:hover:bg-green-900/30":t.isWinner,"hover:bg-red-900/30 dark:hover:bg-red-900/30":t.isLoser,"bg-green-900/30 dark:bg-green-900/30":t.shouldHighlight&&t.isWinner,"bg-red-900/30 dark:bg-red-900/30":t.shouldHighlight&&t.isLoser}]),onMouseenter:h,onMouseleave:m},[t.canEdit?(e.openBlock(),e.createElementBlock("div",I,[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":y[0]||(y[0]=r=>n.value=r),class:"fi-select-input pl-8 w-full border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",onChange:k},[y[1]||(y[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,r=>(e.openBlock(),e.createElementBlock("option",{key:r.id,value:r.name,disabled:d(r.name)},e.toDisplayString(r.name),9,q))),128))],544),[[e.vModelSelect,n.value]]),i.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:i.value,alt:n.value,class:"absolute left-1 top-1/2 -translate-y-1/2 w-5 h-5 rounded-full"},null,8,W)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("div",C,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,D)):e.createCommentVNode("",!0),e.createElementVNode("span",R,e.toDisplayString(t.team.name),1)]))],34))}},H={key:1,class:"text-white"},P={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:f}){const a=t,l=f,n=e.ref(!1),i=e.ref(a.team.score??0),d=()=>{a.canEditScore&&(n.value=!0)},u=()=>{const h=parseInt(i.value)||0;l("update:score",{position:a.teamPosition,score:h})};return e.watch(()=>a.team,h=>{i.value=h.score??0},{deep:!0}),(h,m)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:d},[n.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":m[0]||(m[0]=k=>i.value=k),class:"w-12 bg-orange-500 dark:bg-orange-600 text-center text-white",min:"0",onChange:u,onBlur:m[1]||(m[1]=k=>n.value=!1)},null,544)),[[e.vModelText,i.value]]):(e.openBlock(),e.createElementBlock("span",H,e.toDisplayString(t.team.score),1))],2))}},j={class:"flex"},M={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(f,a)=>(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(F,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"onUpdate:team":a[0]||(a[0]=l=>f.$emit("update:team",l)),onHighlightTeam:a[1]||(a[1]=l=>f.$emit("highlight-team",l)),onUnhighlightTeam:a[2]||(a[2]=l=>f.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","can-edit","is-winner","is-loser","should-highlight"]),e.createVNode(P,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=l=>f.$emit("update:score",l))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},z={class:"my-1.5 ml-2.5 bg-white dark:bg-gray-800 rounded overflow-hidden w-full min-w-[200px] shadow"},J={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[1px] mx-2 transition-colors duration-200"},G={__name:"BracketMatch",props:{match:{type:Object,required:!0},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=e.computed(()=>a.roundIndex===0),i=e.computed(()=>a.match[c.ONE].name!==T&&a.match[c.TWO].name!==T),d=r=>a.match.winner===r,u=r=>a.match.winner&&a.match.winner!==r,h=r=>{const p=a.match[r].name;return a.highlightedTeam===p},m=r=>{l("highlight-team",r)},k=()=>{l("unhighlight-team")},s=({position:r,team:p})=>{const o={...a.match,[r]:p};l("update:match",o)},y=({position:r,score:p})=>{const o={...a.match,[r]:{...a.match[r],score:p}};o.teamOne.score>0||o.teamTwo.score>0?o.winner=o.teamOne.score>o.teamTwo.score?c.ONE:c.TWO:o.winner=null,l("update:match",o)};return(r,p)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",z,[e.createVNode(M,{team:t.match.teamOne,"team-position":e.unref(c).ONE,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":d(e.unref(c).ONE),"is-loser":u(e.unref(c).ONE),"should-highlight":h(e.unref(c).ONE),"is-first-team":!0,"onUpdate:team":s,"onUpdate:score":y,onHighlightTeam:m,onUnhighlightTeam:k},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"]),e.createVNode(M,{team:t.match.teamTwo,"team-position":e.unref(c).TWO,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":d(e.unref(c).TWO),"is-loser":u(e.unref(c).TWO),"should-highlight":h(e.unref(c).TWO),"onUpdate:team":s,"onUpdate:score":y,onHighlightTeam:m,onUnhighlightTeam:k},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",J,p[0]||(p[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},_={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},K={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50"},$={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=(i,d)=>{l("update:match",a.columnIndex,i,d)};return(i,d)=>(e.openBlock(),e.createElementBlock("div",_,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.items,(u,h)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:u.number},[e.createElementVNode("div",K,e.toDisplayString(u.number),1),e.createVNode(G,{match:u,index:h,"total-matches":t.column.items.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,"onUpdate:match":m=>n(h,m),onHighlightTeam:d[0]||(d[0]=m=>i.$emit("highlight-team",m)),onUnhighlightTeam:d[1]||(d[1]=m=>i.$emit("unhighlight-team"))},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","onUpdate:match"])],64))),128))]))}},Q={class:"flex justify-between px-5"},X={class:"flex flex-col items-center gap-2"},Y=["value","onInput"],Z=["value","onChange"],ee=["value"],V={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0}},emits:["update:columns"],setup(t,{emit:f}){const a=t,l=f,n=[1,3,5,7,9],i=(u,h)=>{const m=[...a.columns];m[u]={...m[u],name:h},l("update:columns",m)},d=(u,h)=>{const m=[...a.columns];m[u]={...m[u],bestOf:Number(h)},l("update:columns",m)};return(u,h)=>(e.openBlock(),e.createElementBlock("div",Q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(m,k)=>(e.openBlock(),e.createElementBlock("div",{key:m.name,class:"flex-1 text-center text-sm text-gray-400 py-2 bg-white dark:bg-gray-800 rounded overflow-hidden shadow"},[e.createElementVNode("div",X,[e.createElementVNode("input",{value:m.name,onInput:s=>i(k,s.target.value),class:"bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded text-center w-32 text-gray-900 dark:text-white"},null,40,Y),e.createElementVNode("select",{value:m.bestOf,onChange:s=>d(k,s.target.value),class:"fi-select-input w-32border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(n,s=>e.createElementVNode("option",{key:s,value:s}," Best of "+e.toDisplayString(s),9,ee)),64))],40,Z)])]))),128))]))}},te={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},ae={class:"flex flex-col"},ne={class:"overflow-x-auto"},le={class:"min-w-max"},oe={class:"flex flex-1 p-5"},ie={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)}},emits:["update:state"],setup(t,{emit:f}){const a=f,l=t,n=e.ref([]),i=e.ref(null),d=e.computed(()=>{const r=new Set;return n.value.forEach(p=>{p.items.forEach(o=>{o[c.ONE].name!==T&&r.add(o[c.ONE].name),o[c.TWO].name!==T&&r.add(o[c.TWO].name)})}),Array.from(r)}),u=r=>{i.value=r},h=()=>{i.value=null},m=(r,p,o)=>{if(console.log("Updating lower match:",{roundIndex:r,matchIndex:p,updatedMatch:o}),n.value[r]&&n.value[r].items){if(n.value[r].items[p]=o,o.winner&&r<n.value.length-1){const b=r+1,g=Math.floor(p/2);if(n.value[b]&&n.value[b].items[g]){const E=n.value[b].items[g],B=p%2===0?c.ONE:c.TWO,O=o[o.winner];n.value[b].items[g]={...E,[B]:{id:O.id,name:O.name,logo:O.logo,score:0}}}}s()}},k=r=>{console.log("Updating lower columns:",r),n.value=r,s()},s=()=>{console.log("Emitting lower tournament state:",n.value),a("update:state",n.value)},y=()=>{console.log("Initializing lower tournament with state:",l.initialState),l.initialState&&l.initialState.length>0&&(n.value=JSON.parse(JSON.stringify(l.initialState)))};return e.watch(()=>l.initialState,()=>{y()},{deep:!0}),e.onMounted(()=>{y()}),(r,p)=>(e.openBlock(),e.createElementBlock("div",te,[p[0]||(p[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Lower Bracket",-1)),e.createElementVNode("div",ae,[e.createElementVNode("div",ne,[e.createElementVNode("div",le,[e.createVNode(V,{columns:n.value,"onUpdate:columns":k},null,8,["columns"]),e.createElementVNode("div",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(o,b)=>(e.openBlock(),e.createBlock($,{key:o.name,column:o,"column-index":b,"available-teams":t.availableTeams,"selected-teams":d.value,"highlighted-team":i.value,"onUpdate:match":m,onHighlightTeam:u,onUnhighlightTeam:h},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])])]))}},v=()=>({id:null,name:T,logo:null,score:0}),S=t=>({number:t,[c.ONE]:v(),[c.TWO]:v(),winner:null}),re=(t,f=3)=>{const a=[],l=Math.log2(t);let n=1;for(let i=0;i<l;i++){const d=Math.pow(2,l-i-1),u=[];for(let h=0;h<d;h++)u.push(S(n++));a.push({name:`Round ${i+1}`,items:u,bestOf:f})}return a},L=(t,f)=>{const a=[];let l=1;const n=Math.pow(2,t-2),i={name:"Lower Round 1",bestOf:f,items:Array(n).fill(null).map(()=>S(l++))};a.push(i);const d=Math.pow(2,t-3),u={name:"Lower Round 2",bestOf:f,items:Array(d).fill(null).map(()=>S(l++))};if(a.push(u),t>3){const h=Math.pow(2,t-4),m={name:"Lower Round 3",bestOf:f,items:Array(h).fill(null).map(()=>S(l++))};a.push(m)}return a},se={class:"flex flex-col"},ce={class:"flex flex-col"},me={class:"overflow-x-auto"},de={class:"min-w-max"},ue={class:"flex flex-1 p-5"},A={__name:"TournamentBracket",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)},format:{type:String,default:N.SINGLE_ELIMINATION,validator:t=>Object.values(N).includes(t)}},emits:["update:state"],setup(t,{emit:f}){const a=f,l=t,n=e.ref([]),i=e.ref([]),d=e.ref(null),u=e.computed(()=>{const o=new Set;return n.value.forEach(b=>{b.items.forEach(g=>{g[c.ONE].name!==T&&o.add(g[c.ONE].name),g[c.TWO].name!==T&&o.add(g[c.TWO].name)})}),l.format===N.DOUBLE_ELIMINATION&&i.value.forEach(b=>{b.items.forEach(g=>{g[c.ONE].name!==T&&o.add(g[c.ONE].name),g[c.TWO].name!==T&&o.add(g[c.TWO].name)})}),Array.from(o)}),h=o=>{d.value=o},m=()=>{d.value=null},k=(o,b,g)=>{if(console.log("Updating upper match:",{roundIndex:o,matchIndex:b,updatedMatch:g}),n.value[o]&&n.value[o].items){if(n.value[o].items[b]=g,g.winner&&o<n.value.length-1){const E=o+1,B=Math.floor(b/2);if(n.value[E]&&n.value[E].items[B]){const O=n.value[E].items[B],U=b%2===0?c.ONE:c.TWO,x=g[g.winner];n.value[E].items[B]={...O,[U]:{id:x.id,name:x.name,logo:x.logo,score:0}}}}if(l.format===N.DOUBLE_ELIMINATION&&g.winner){const E=g[g.winner===c.ONE?c.TWO:c.ONE];if(E.name!==T){const B=Math.floor(o/2),O=Math.floor(b/2);if(i.value[B]&&i.value[B].items[O]){const U=i.value[B].items[O],x=b%2===0?c.ONE:c.TWO;i.value[B].items[O]={...U,[x]:{id:E.id,name:E.name,logo:E.logo,score:0}}}}}r()}},s=o=>{console.log("Updating upper columns:",o),n.value=o,r()},y=o=>{console.log("Updating lower state:",o),i.value=o,r()},r=()=>{console.log("Emitting tournament state:",{upper:n.value,lower:l.format===N.DOUBLE_ELIMINATION?i.value:null}),a("update:state",{upper:n.value,lower:l.format===N.DOUBLE_ELIMINATION?i.value:null})},p=()=>{console.log("Initializing tournament with state:",l.initialState),l.initialState&&(Array.isArray(l.initialState)?(n.value=JSON.parse(JSON.stringify(l.initialState)),l.format===N.DOUBLE_ELIMINATION&&(i.value=L(n.value.length,l.defaultBestOf))):(n.value=JSON.parse(JSON.stringify(l.initialState.upper||[])),i.value=JSON.parse(JSON.stringify(l.initialState.lower||[]))))};return e.watch(()=>l.initialState,()=>{p()},{deep:!0}),e.watch(()=>l.format,o=>{o===N.DOUBLE_ELIMINATION&&(!i.value||i.value.length===0)&&(i.value=L(n.value.length,l.defaultBestOf),r())}),e.onMounted(()=>{p()}),(o,b)=>(e.openBlock(),e.createElementBlock("div",se,[b[0]||(b[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Upper Bracket",-1)),e.createElementVNode("div",ce,[e.createElementVNode("div",me,[e.createElementVNode("div",de,[e.createVNode(V,{columns:n.value,"onUpdate:columns":s},null,8,["columns"]),e.createElementVNode("div",ue,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(g,E)=>(e.openBlock(),e.createBlock($,{key:g.name,column:g,"column-index":E,"available-teams":t.availableTeams,"selected-teams":u.value,"highlighted-team":d.value,"onUpdate:match":k,onHighlightTeam:h,onUnhighlightTeam:m},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])]),t.format===e.unref(N).DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(ie,{key:0,"initial-state":i.value,"available-teams":t.availableTeams,"default-best-of":t.defaultBestOf,"onUpdate:state":y},null,8,["initial-state","available-teams","default-best-of"])):e.createCommentVNode("",!0)]))}},he=t=>{t.component("TournamentBracket",A)};w.TournamentBracket=A,w.createLowerBracketStructure=L,w.createTournamentState=re,w.install=he,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
