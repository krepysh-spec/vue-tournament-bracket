(function(w,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(w=typeof globalThis<"u"?globalThis:w||self,e(w.BracketVueTool={},w.Vue))})(this,function(w,e){"use strict";const N={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination"},k="TBD",s={ONE:"teamOne",TWO:"teamTwo"},I={key:0,class:"flex items-center gap-2"},q=["src","alt"],W=["value","disabled"],C={key:1,class:"flex items-center gap-2"},D=["src","alt"],R={class:"text-gray-900 dark:text-white"},F={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=e.ref(a.team.name),i=e.computed(()=>{var m;return n.value===k?null:((m=a.availableTeams.find(g=>g.name===n.value))==null?void 0:m.logo)||null});e.watch(()=>a.team,m=>{n.value=m.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const u=m=>m===k?!1:a.selectedTeams.includes(m)&&m!==a.team.name||m===a.team.name&&a.team.name!==k,b=e.computed(()=>a.availableTeams?a.availableTeams.filter(m=>m.name===k||m.name===a.team.name?!0:!u(m.name)):[]),c=()=>{a.team.name!==k&&l("highlight-team",a.team.name)},d=()=>{l("unhighlight-team")},p=()=>{const m=a.availableTeams.find(g=>g.name===n.value);console.log("Updating team:",{selectedTeam:n.value,selectedTeamData:m}),l("update:team",{position:a.teamPosition,team:{id:(m==null?void 0:m.id)||null,name:n.value,logo:(m==null?void 0:m.logo)||null,score:0}})};return(m,g)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200 dark:hover:bg-gray-700",{"hover:bg-green-900/30 dark:hover:bg-green-900/30":t.isWinner,"hover:bg-red-900/30 dark:hover:bg-red-900/30":t.isLoser,"bg-green-900/30 dark:bg-green-900/30":t.shouldHighlight&&t.isWinner,"bg-red-900/30 dark:bg-red-900/30":t.shouldHighlight&&t.isLoser}]),onMouseenter:c,onMouseleave:d},[t.canEdit?(e.openBlock(),e.createElementBlock("div",I,[i.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:i.value,alt:n.value,class:"w-6 h-6 rounded-full"},null,8,q)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":g[0]||(g[0]=r=>n.value=r),class:"fi-select-input p-0 w-full border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",onChange:p},[g[1]||(g[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.value,r=>(e.openBlock(),e.createElementBlock("option",{key:r.id,value:r.name,disabled:u(r.name)},e.toDisplayString(r.name),9,W))),128))],544),[[e.vModelSelect,n.value]])])):(e.openBlock(),e.createElementBlock("div",C,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,D)):e.createCommentVNode("",!0),e.createElementVNode("span",R,e.toDisplayString(t.team.name),1)]))],34))}},H={key:1,class:"text-white"},P={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:f}){const a=t,l=f,n=e.ref(!1),i=e.ref(a.team.score??0),u=()=>{a.canEditScore&&(n.value=!0)},b=()=>{const c=parseInt(i.value)||0;l("update:score",{position:a.teamPosition,score:c})};return e.watch(()=>a.team,c=>{i.value=c.score??0},{deep:!0}),(c,d)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:u},[n.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":d[0]||(d[0]=p=>i.value=p),class:"w-12 border-none bg-orange-500 dark:bg-orange-600 text-center text-white text-base transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",min:"0",onChange:b,onBlur:d[1]||(d[1]=p=>n.value=!1)},null,544)),[[e.vModelText,i.value]]):(e.openBlock(),e.createElementBlock("span",H,e.toDisplayString(t.team.score),1))],2))}},j={class:"flex"},M={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(f,a)=>(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(F,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"onUpdate:team":a[0]||(a[0]=l=>f.$emit("update:team",l)),onHighlightTeam:a[1]||(a[1]=l=>f.$emit("highlight-team",l)),onUnhighlightTeam:a[2]||(a[2]=l=>f.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","can-edit","is-winner","is-loser","should-highlight"]),e.createVNode(P,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=l=>f.$emit("update:score",l))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},z={class:"my-1.5 ml-2.5 bg-white dark:bg-gray-800 rounded overflow-hidden w-full min-w-[200px] shadow"},J={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[1px] mx-2 transition-colors duration-200"},_={__name:"BracketMatch",props:{match:{type:Object,required:!0},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=e.computed(()=>a.roundIndex===0),i=e.computed(()=>a.match[s.ONE].name!==k&&a.match[s.TWO].name!==k),u=r=>a.match.winner===r,b=r=>a.match.winner&&a.match.winner!==r,c=r=>{const y=a.match[r].name;return a.highlightedTeam===y},d=r=>{l("highlight-team",r)},p=()=>{l("unhighlight-team")},m=({position:r,team:y})=>{const o={...a.match,[r]:y};l("update:match",o)},g=({position:r,score:y})=>{const o={...a.match,[r]:{...a.match[r],score:y}};o.teamOne.score>0||o.teamTwo.score>0?o.winner=o.teamOne.score>o.teamTwo.score?s.ONE:s.TWO:o.winner=null,l("update:match",o)};return(r,y)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",z,[e.createVNode(M,{team:t.match.teamOne,"team-position":e.unref(s).ONE,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":u(e.unref(s).ONE),"is-loser":b(e.unref(s).ONE),"should-highlight":c(e.unref(s).ONE),"is-first-team":!0,"onUpdate:team":m,"onUpdate:score":g,onHighlightTeam:d,onUnhighlightTeam:p},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"]),e.createVNode(M,{team:t.match.teamTwo,"team-position":e.unref(s).TWO,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":u(e.unref(s).TWO),"is-loser":b(e.unref(s).TWO),"should-highlight":c(e.unref(s).TWO),"onUpdate:team":m,"onUpdate:score":g,onHighlightTeam:d,onUnhighlightTeam:p},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",J,y[0]||(y[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},G={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},K={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50"},V={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:f}){const a=t,l=f,n=(i,u)=>{l("update:match",a.columnIndex,i,u)};return(i,u)=>(e.openBlock(),e.createElementBlock("div",G,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.items,(b,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:b.number},[e.createElementVNode("div",K,e.toDisplayString(b.number),1),e.createVNode(_,{match:b,index:c,"total-matches":t.column.items.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,"onUpdate:match":d=>n(c,d),onHighlightTeam:u[0]||(u[0]=d=>i.$emit("highlight-team",d)),onUnhighlightTeam:u[1]||(u[1]=d=>i.$emit("unhighlight-team"))},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","onUpdate:match"])],64))),128))]))}},Q={class:"flex justify-between px-5"},X={class:"flex flex-col items-center gap-2"},Y=["onUpdate:modelValue","onBlur"],Z=["value","onChange"],ee=["value"],$={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0}},emits:["update:columns"],setup(t,{emit:f}){const a=t,l=f,n=[1,3,5,7,9],i=e.ref(a.columns.map(c=>c.name));e.watch(()=>a.columns,c=>{i.value=c.map(d=>d.name)},{deep:!0});const u=(c,d)=>{i.value[c]=d;const p=[...a.columns];p[c]={...p[c],name:d},l("update:columns",p)},b=(c,d)=>{const p=[...a.columns];p[c]={...p[c],bestOf:Number(d)},l("update:columns",p)};return(c,d)=>(e.openBlock(),e.createElementBlock("div",Q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(p,m)=>(e.openBlock(),e.createElementBlock("div",{key:p.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[e.createElementVNode("div",X,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":g=>i.value[m]=g,onBlur:g=>u(m,g.target.value),class:"bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded text-center w-32 text-gray-900 dark:text-white"},null,40,Y),[[e.vModelText,i.value[m]]]),e.createElementVNode("select",{value:p.bestOf,onChange:g=>b(m,g.target.value),class:"fi-select-input w-32border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(n,g=>e.createElementVNode("option",{key:g,value:g}," Best of "+e.toDisplayString(g),9,ee)),64))],40,Z)])]))),128))]))}},te={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},ae={class:"flex flex-col"},ne={class:"overflow-x-auto"},le={class:"min-w-max"},oe={class:"flex flex-1 p-5"},ie={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)}},emits:["update:state"],setup(t,{emit:f}){const a=f,l=t,n=e.ref([]),i=e.ref(null),u=e.computed(()=>{const r=new Set;return n.value.forEach(y=>{y.items.forEach(o=>{o[s.ONE].name!==k&&r.add(o[s.ONE].name),o[s.TWO].name!==k&&r.add(o[s.TWO].name)})}),Array.from(r)}),b=r=>{i.value=r},c=()=>{i.value=null},d=(r,y,o)=>{if(console.log("Updating lower match:",{roundIndex:r,matchIndex:y,updatedMatch:o}),n.value[r]&&n.value[r].items){if(n.value[r].items[y]=o,o.winner&&r<n.value.length-1){const T=r+1,h=Math.floor(y/2);if(n.value[T]&&n.value[T].items[h]){const E=n.value[T].items[h],B=y%2===0?s.ONE:s.TWO,x=o[o.winner];n.value[T].items[h]={...E,[B]:{id:x.id,name:x.name,logo:x.logo,score:0}}}}m()}},p=r=>{console.log("Updating lower columns:",r),n.value=r,m()},m=()=>{console.log("Emitting lower tournament state:",n.value),a("update:state",n.value)},g=()=>{console.log("Initializing lower tournament with state:",l.initialState),l.initialState&&l.initialState.length>0&&(n.value=JSON.parse(JSON.stringify(l.initialState)))};return e.watch(()=>l.initialState,()=>{g()},{deep:!0}),e.onMounted(()=>{g()}),(r,y)=>(e.openBlock(),e.createElementBlock("div",te,[y[0]||(y[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Lower Bracket",-1)),e.createElementVNode("div",ae,[e.createElementVNode("div",ne,[e.createElementVNode("div",le,[e.createVNode($,{columns:n.value,"onUpdate:columns":p},null,8,["columns"]),e.createElementVNode("div",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(o,T)=>(e.openBlock(),e.createBlock(V,{key:o.name,column:o,"column-index":T,"available-teams":t.availableTeams,"selected-teams":u.value,"highlighted-team":i.value,"onUpdate:match":d,onHighlightTeam:b,onUnhighlightTeam:c},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])])]))}},A=()=>({id:null,name:k,logo:null,score:0}),S=t=>({number:t,[s.ONE]:A(),[s.TWO]:A(),winner:null}),re=(t,f=3)=>{const a=[],l=Math.log2(t);let n=1;for(let i=0;i<l;i++){const u=Math.pow(2,l-i-1),b=[];for(let c=0;c<u;c++)b.push(S(n++));a.push({name:`Round ${i+1}`,items:b,bestOf:f})}return a},L=(t,f)=>{const a=[];let l=1;const n=Math.pow(2,t-2),i={name:"Lower Round 1",bestOf:f,items:Array(n).fill(null).map(()=>S(l++))};a.push(i);const u=Math.pow(2,t-3),b={name:"Lower Round 2",bestOf:f,items:Array(u).fill(null).map(()=>S(l++))};if(a.push(b),t>3){const c=Math.pow(2,t-4),d={name:"Lower Round 3",bestOf:f,items:Array(c).fill(null).map(()=>S(l++))};a.push(d)}return a},se={class:"flex flex-col"},me={class:"flex flex-col"},ce={class:"overflow-x-auto"},de={class:"min-w-max"},ue={class:"flex flex-1 p-5"},v={__name:"TournamentBracket",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)},format:{type:String,default:N.SINGLE_ELIMINATION,validator:t=>Object.values(N).includes(t)}},emits:["update:state"],setup(t,{emit:f}){const a=f,l=t,n=e.ref([]),i=e.ref([]),u=e.ref(null),b=e.computed(()=>{const o=new Set;return n.value.forEach(T=>{T.items.forEach(h=>{h[s.ONE].name!==k&&o.add(h[s.ONE].name),h[s.TWO].name!==k&&o.add(h[s.TWO].name)})}),l.format===N.DOUBLE_ELIMINATION&&i.value.forEach(T=>{T.items.forEach(h=>{h[s.ONE].name!==k&&o.add(h[s.ONE].name),h[s.TWO].name!==k&&o.add(h[s.TWO].name)})}),Array.from(o)}),c=o=>{u.value=o},d=()=>{u.value=null},p=(o,T,h)=>{if(console.log("Updating upper match:",{roundIndex:o,matchIndex:T,updatedMatch:h}),n.value[o]&&n.value[o].items){if(n.value[o].items[T]=h,h.winner&&o<n.value.length-1){const E=o+1,B=Math.floor(T/2);if(n.value[E]&&n.value[E].items[B]){const x=n.value[E].items[B],U=T%2===0?s.ONE:s.TWO,O=h[h.winner];n.value[E].items[B]={...x,[U]:{id:O.id,name:O.name,logo:O.logo,score:0}}}}if(l.format===N.DOUBLE_ELIMINATION&&h.winner){const E=h[h.winner===s.ONE?s.TWO:s.ONE];if(E.name!==k){const B=Math.floor(o/2),x=Math.floor(T/2);if(i.value[B]&&i.value[B].items[x]){const U=i.value[B].items[x],O=T%2===0?s.ONE:s.TWO;i.value[B].items[x]={...U,[O]:{id:E.id,name:E.name,logo:E.logo,score:0}}}}}r()}},m=o=>{console.log("Updating upper columns:",o),n.value=o,r()},g=o=>{console.log("Updating lower state:",o),i.value=o,r()},r=()=>{console.log("Emitting tournament state:",{upper:n.value,lower:l.format===N.DOUBLE_ELIMINATION?i.value:null}),a("update:state",{upper:n.value,lower:l.format===N.DOUBLE_ELIMINATION?i.value:null})},y=()=>{console.log("Initializing tournament with state:",l.initialState),l.initialState&&(Array.isArray(l.initialState)?(n.value=JSON.parse(JSON.stringify(l.initialState)),l.format===N.DOUBLE_ELIMINATION&&(i.value=L(n.value.length,l.defaultBestOf))):(n.value=JSON.parse(JSON.stringify(l.initialState.upper||[])),i.value=JSON.parse(JSON.stringify(l.initialState.lower||[]))))};return e.watch(()=>l.initialState,()=>{y()},{deep:!0}),e.watch(()=>l.format,o=>{o===N.DOUBLE_ELIMINATION&&(!i.value||i.value.length===0)&&(i.value=L(n.value.length,l.defaultBestOf),r())}),e.onMounted(()=>{y()}),(o,T)=>(e.openBlock(),e.createElementBlock("div",se,[T[0]||(T[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Upper Bracket",-1)),e.createElementVNode("div",me,[e.createElementVNode("div",ce,[e.createElementVNode("div",de,[e.createVNode($,{columns:n.value,"onUpdate:columns":m},null,8,["columns"]),e.createElementVNode("div",ue,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(h,E)=>(e.openBlock(),e.createBlock(V,{key:h.name,column:h,"column-index":E,"available-teams":t.availableTeams,"selected-teams":b.value,"highlighted-team":u.value,"onUpdate:match":p,onHighlightTeam:c,onUnhighlightTeam:d},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])]),t.format===e.unref(N).DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(ie,{key:0,"initial-state":i.value,"available-teams":t.availableTeams,"default-best-of":t.defaultBestOf,"onUpdate:state":g},null,8,["initial-state","available-teams","default-best-of"])):e.createCommentVNode("",!0)]))}},ge=t=>{t.component("TournamentBracket",v)};w.TournamentBracket=v,w.createLowerBracketStructure=L,w.createTournamentState=re,w.install=ge,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
