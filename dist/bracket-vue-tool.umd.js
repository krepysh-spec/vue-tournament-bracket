(function(C,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(C=typeof globalThis<"u"?globalThis:C||self,e(C.BracketVueTool={},C.Vue))})(this,function(C,e){"use strict";const D={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination",SWISS:"swiss",ROUND_ROBIN:"round_robin"},O="TBD",u={ONE:"teamOne",TWO:"teamTwo"},_={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},L=(d,i)=>{const n=d.__vccOpts||d;for(const[t,r]of i)n[t]=r;return n},G={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(d,{expose:i,emit:n}){i();const t=d,r=n,a=e.ref(t.team.name),o=e.computed(()=>{var m;return a.value===O?null:((m=t.availableTeams.find(k=>k.name===a.value))==null?void 0:m.logo)||null});e.watch(()=>t.team,m=>{a.value=m.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:t.team,availableTeams:t.availableTeams})});const l=m=>m===O?!1:t.selectedTeams.includes(m)&&m!==t.team.name||m===t.team.name&&t.team.name!==O,h=e.computed(()=>t.availableTeams?t.availableTeams.filter(m=>m.name===O||m.name===t.team.name?!0:!l(m.name)):[]),T={props:t,emit:r,selectedTeam:a,selectedTeamLogo:o,isTeamSelected:l,availableTeamsForSelection:h,highlightTeam:()=>{t.team.name!==O&&r("highlight-team",t.team.name)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:()=>{const m=t.availableTeams.find(k=>k.name===a.value);console.log("Updating team:",{selectedTeam:a.value,selectedTeamData:m}),r("update:team",{position:t.teamPosition,team:{id:(m==null?void 0:m.id)||null,name:a.value,logo:(m==null?void 0:m.logo)||null,score:0}})},ref:e.ref,computed:e.computed,onMounted:e.onMounted,watch:e.watch,get TBD(){return O},get PERMISSIONS(){return _}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},Z={key:0,class:"flex items-center gap-2"},K=["src","alt"],Q=["value","disabled"],X={key:1,class:"flex items-center gap-2"},Y=["src","alt"],v={class:"text-gray-900 dark:text-white"};function $(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":n.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":n.isLoser,"bg-green-500/20 dark:bg-green-500/20":n.shouldHighlight&&n.isWinner,"bg-red-500/20 dark:bg-red-500/20":n.shouldHighlight&&n.isLoser}]),onMouseenter:t.highlightTeam,onMouseleave:t.unhighlightTeam},[n.canEdit&&n.permissions[t.PERMISSIONS.CAN_SELECT_TEAM]?(e.openBlock(),e.createElementBlock("div",Z,[t.selectedTeamLogo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.selectedTeamLogo,alt:t.selectedTeam,class:"w-6 h-6 rounded-full"},null,8,K)):e.createCommentVNode("v-if",!0),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>t.selectedTeam=o),class:"fi-select-input p-0 w-full border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900 hover:cursor-pointer",onChange:t.updateTeam},[i[1]||(i[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.availableTeamsForSelection,o=>(e.openBlock(),e.createElementBlock("option",{key:o.id,value:o.name,disabled:t.isTeamSelected(o.name)},e.toDisplayString(o.name),9,Q))),128))],544),[[e.vModelSelect,t.selectedTeam]])])):(e.openBlock(),e.createElementBlock("div",X,[n.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:n.team.logo,alt:n.team.name,class:"w-6 h-6 rounded-full"},null,8,Y)):e.createCommentVNode("v-if",!0),e.createElementVNode("span",v,e.toDisplayString(n.team.name),1)]))],34)}const ee=L(G,[["render",$],["__file","/app/src/components/team/TeamSelect.vue"]]),te={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(d,{expose:i,emit:n}){i();const t=d,r=n,a=e.ref(!1),o=e.ref(t.team.score??0),l=()=>{t.canEditScore&&(a.value=!0)},h=()=>{const c=parseInt(o.value)||0;r("update:score",{position:t.teamPosition,score:c})};e.watch(()=>t.team,c=>{o.value=c.score??0},{deep:!0});const w={props:t,emit:r,isEditing:a,score:o,selectScore:l,updateScore:h,ref:e.ref,watch:e.watch};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},ae={key:1,class:"text-white"};function ne(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":n.isFirstTeam}]),onClick:t.selectScore},[t.isEditing?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":i[0]||(i[0]=o=>t.score=o),class:"w-12 border-none bg-orange-500 dark:bg-orange-600 text-center text-white text-base transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",min:"0",onChange:t.updateScore,onBlur:i[1]||(i[1]=o=>t.isEditing=!1)},null,544)),[[e.vModelText,t.score]]):(e.openBlock(),e.createElementBlock("span",ae,e.toDisplayString(n.team.score),1))],2)}const oe=L(te,[["render",ne],["__file","/app/src/components/team/TeamScoreInput.vue"]]),ie={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0,[_.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(d,{expose:i}){i();const t={props:d,TeamSelect:ee,TeamScoreInput:oe,get PERMISSIONS(){return _}};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}},re={class:"flex"};function se(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",re,[e.createVNode(t.TeamSelect,{team:n.team,"team-position":n.teamPosition,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"can-edit":n.canEdit,"is-winner":n.isWinner,"is-loser":n.isLoser,"should-highlight":n.shouldHighlight,"is-first-team":n.isFirstTeam,"onUpdate:team":i[0]||(i[0]=o=>d.$emit("update:team",o)),onHighlightTeam:i[1]||(i[1]=o=>d.$emit("highlight-team",o)),onUnhighlightTeam:i[2]||(i[2]=o=>d.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),e.createVNode(t.TeamScoreInput,{team:n.team,"team-position":n.teamPosition,"can-edit-score":n.canEditScore,"is-first-team":n.isFirstTeam,"onUpdate:score":i[3]||(i[3]=o=>d.$emit("update:score",o))},null,8,["team","team-position","can-edit-score","is-first-team"])])}const le=L(ie,[["render",se],["__file","/app/src/components/team/TeamRow.vue"]]),ce={__name:"BracketMatch",props:{match:{type:Object,required:!0,default:()=>({teamOne:{name:O,score:0},teamTwo:{name:O,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0,[_.CAN_EDIT_DATE]:!0,[_.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(d,{expose:i,emit:n}){i();const t=d,r=n,a=e.computed(()=>t.roundIndex===0&&t.permissions[_.CAN_SELECT_TEAM]),o=e.computed(()=>t.match[u.ONE].name!==O&&t.match[u.TWO].name!==O&&t.permissions[_.CAN_EDIT_SCOPE]),P={props:t,emit:r,canEdit:a,canEditScore:o,isWinner:f=>t.match.winner===f,isLoser:f=>t.match.winner&&t.match.winner!==f,shouldHighlight:f=>{const s=t.match[f].name;return t.highlightedTeam===s},highlightTeam:f=>{r("highlight-team",f)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:({position:f,team:s})=>{const E={...t.match,[f]:s};r("update:match",E)},updateScore:({position:f,score:s})=>{const E={...t.match,[f]:{...t.match[f],score:s}};E[u.ONE].score>E[u.TWO].score?E.winner=u.ONE:E[u.TWO].score>E[u.ONE].score?E.winner=u.TWO:E.winner=null,r("update:match",E)},formatDateTimeForInput:f=>f?new Date(f).toISOString().slice(0,16):"",updateDate:f=>{const s={...t.match,date:f.target.value};r("update:match",s)},formatDate:f=>f?new Date(f).toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}):"",onMatchClick:f=>{const s=f.target.tagName.toLowerCase();s==="input"||s==="select"||s==="option"||s==="button"||f.target.closest("input,select,option,button")||!(!t.permissions[_.CAN_SELECT_TEAM]&&!t.permissions[_.CAN_EDIT_DATE]&&!t.permissions[_.CAN_EDIT_SCOPE])||r("click-match",{match:t.match,roundIndex:t.roundIndex,matchIndex:t.index,id:t.match.id??null})},computed:e.computed,TeamRow:le,get TBD(){return O},get TEAM_POSITION(){return u},get PERMISSIONS(){return _}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}},de={class:"flex flex-col w-full"},me={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},he=["value","disabled"],ue={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"};function ge(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:n.index%2==0&&n.totalMatches>1}])},[e.createElementVNode("div",de,[e.createElementVNode("div",me,[e.createElementVNode("input",{type:"datetime-local",value:t.formatDateTimeForInput(n.match.date),onInput:t.updateDate,class:"bg-transparent border-none focus:ring-0 p-0 text-xs",disabled:!n.permissions[t.PERMISSIONS.CAN_EDIT_DATE]},null,40,he)]),e.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:t.onMatchClick},[e.createVNode(t.TeamRow,{team:n.match.teamOne,"team-position":t.TEAM_POSITION.ONE,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"can-edit":t.canEdit,"can-edit-score":t.canEditScore,"is-winner":t.isWinner(t.TEAM_POSITION.ONE),"is-loser":t.isLoser(t.TEAM_POSITION.ONE),"should-highlight":t.shouldHighlight(t.TEAM_POSITION.ONE),"is-first-team":!0,"can-select-team":d.canSelectTeam,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:team":t.updateTeam,"onUpdate:score":t.updateScore,onHighlightTeam:t.highlightTeam,onUnhighlightTeam:t.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),e.createVNode(t.TeamRow,{team:n.match.teamTwo,"team-position":t.TEAM_POSITION.TWO,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"can-edit":t.canEdit,"can-edit-score":t.canEditScore,"is-winner":t.isWinner(t.TEAM_POSITION.TWO),"is-loser":t.isLoser(t.TEAM_POSITION.TWO),"should-highlight":t.shouldHighlight(t.TEAM_POSITION.TWO),"can-select-team":d.canSelectTeam,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:team":t.updateTeam,"onUpdate:score":t.updateScore,onHighlightTeam:t.highlightTeam,onUnhighlightTeam:t.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),n.index%2==0&&n.totalMatches>1?(e.openBlock(),e.createElementBlock("div",ue,i[0]||(i[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("v-if",!0)],2)}const fe=L(ce,[["render",ge],["__file","/app/src/components/bracket/BracketMatch.vue"]]),pe={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(d,{expose:i,emit:n}){i();const t=d,r=n,l={props:t,emit:r,updateMatch:(h,w)=>{r("update:match",t.columnIndex,h,w)},onClickMatch:(h,w)=>{r("click-match",{...w,roundIndex:t.columnIndex,matchIndex:h})},BracketMatch:fe,get PERMISSIONS(){return _}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},_e={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},Te={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"};function Ee(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",_e,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.column.matches,(o,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o.id},[e.createElementVNode("div",Te,e.toDisplayString(o.number),1),e.createVNode(t.BracketMatch,{match:o,index:l,"total-matches":n.column.matches.length,"round-index":n.columnIndex,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:match":h=>t.updateMatch(l,h),onHighlightTeam:i[0]||(i[0]=h=>d.$emit("highlight-team",h)),onUnhighlightTeam:i[1]||(i[1]=h=>d.$emit("unhighlight-team")),onClickMatch:h=>t.onClickMatch(l,h)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))])}const q=L(pe,[["render",Ee],["__file","/app/src/components/bracket/BracketColumn.vue"]]),be={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(d,{expose:i,emit:n}){i();const t=d,r=n,a=[1,3,5,7,9],o=e.ref(t.columns.map(c=>c.name));e.watch(()=>t.columns,c=>{o.value=c.map(b=>b.name)},{deep:!0});const w={props:t,emit:r,bestOfValues:a,localColumnNames:o,updateColumnName:(c,b)=>{o.value[c]=b;const T=[...t.columns];T[c]={...T[c],name:b},r("update:columns",T)},updateColumnBestOf:(c,b)=>{const T=[...t.columns];T[c]={...T[c],bestOf:Number(b)},r("update:columns",T)},ref:e.ref,watch:e.watch,get PERMISSIONS(){return _}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},ye={class:"flex justify-between px-5"},Ne={class:"flex flex-col items-center gap-2"},Se={class:"mt-2"},Oe={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},we=["onUpdate:modelValue","onBlur","disabled"],ke={class:"grid shrink-0 grid-cols-1 focus-within:relative"},Be=["value","onChange","disabled"],xe=["value"];function Ie(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",ye,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.columns,(o,l)=>(e.openBlock(),e.createElementBlock("div",{key:o.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[e.createElementVNode("div",Ne,[e.createElementVNode("div",Se,[e.createElementVNode("div",Oe,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":h=>t.localColumnNames[l]=h,onBlur:h=>t.updateColumnName(l,h.target.value),disabled:!n.permissions[t.PERMISSIONS.CAN_EDIT_ROUND_NAME],class:"block min-w-0 grow py-1.5 pr-3 text-gray-800 dark:text-white border-none pl-1 text-base text-gray-900 bg-white dark:bg-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6"},null,40,we),[[e.vModelText,t.localColumnNames[l]]]),e.createElementVNode("div",ke,[e.createElementVNode("select",{value:o.bestOf,onChange:h=>t.updateColumnBestOf(l,h.target.value),disabled:!n.permissions[t.PERMISSIONS.CAN_EDIT_BEST_OF],class:"col-start-1 row-start-1 w-full text-gray-800 dark:text-white border-none appearance-none py-1.5 bg-white dark:bg-gray-900 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(t.bestOfValues,h=>e.createElementVNode("option",{key:h,value:h}," Best of "+e.toDisplayString(h),9,xe)),64))],40,Be),e.createCommentVNode(` <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
          <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg> `)])])])])]))),128))])}const W=L(be,[["render",Ie],["__file","/app/src/components/bracket/BracketRoundHeaders.vue"]]),Me={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:d=>[1,3,5,7,9].includes(d)},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0,[_.CAN_EDIT_DATE]:!0,[_.CAN_EDIT_SCOPE]:!0,[_.CAN_EDIT_ROUND_NAME]:!0,[_.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state"],setup(d,{expose:i,emit:n}){i();const t=n,r=d,a=e.ref([]),o=e.ref(null),l=e.computed(()=>{const g=new Set;return a.value.forEach(y=>{y.matches.forEach(M=>{M[u.ONE].name!==O&&g.add(M[u.ONE].name),M[u.TWO].name!==O&&g.add(M[u.TWO].name)})}),Array.from(g)}),h=g=>{o.value=g},w=()=>{o.value=null},c=(g,y,M)=>{if(console.log("Updating lower match:",{roundIndex:g,matchIndex:y,updatedMatch:M}),a.value[g]&&a.value[g].matches){if(a.value[g].matches[y]=M,M.winner&&g<a.value.length-1){const P=g+1,f=Math.floor(y/2);if(a.value[P]&&a.value[P].matches[f]){const s=a.value[P].matches[f],E=y%2===0?u.ONE:u.TWO,p=M[M.winner];a.value[P].matches[f]={...s,[E]:{id:p.id,name:p.name,logo:p.logo,score:0}}}}T()}},b=g=>{console.log("Updating lower columns:",g),a.value=g,T()},T=()=>{console.log("Emitting lower tournament state:",a.value),t("update:state",a.value)},m=()=>{console.log("Initializing lower tournament with state:",r.initialState),r.initialState&&r.initialState.length>0&&(a.value=JSON.parse(JSON.stringify(r.initialState)))};e.watch(()=>r.initialState,()=>{m()},{deep:!0}),e.onMounted(()=>{m()});const k={emit:t,props:r,columns:a,highlightedTeam:o,selectedTeams:l,highlightTeam:h,unhighlightTeam:w,updateMatch:c,updateColumns:b,emitTournamentState:T,initializeTournament:m,ref:e.ref,onMounted:e.onMounted,watch:e.watch,computed:e.computed,BracketColumn:q,BracketRoundHeaders:W,get TBD(){return O},get TEAM_POSITION(){return u},get PERMISSIONS(){return _}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}},Ae={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},Ce={class:"flex flex-col"},De={class:"overflow-x-auto"},Ve={class:"min-w-max"},Pe={class:"flex flex-1 p-5"};function Le(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",Ae,[i[0]||(i[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Lower Bracket",-1)),e.createElementVNode("div",Ce,[e.createElementVNode("div",De,[e.createElementVNode("div",Ve,[e.createVNode(t.BracketRoundHeaders,{columns:t.columns,"onUpdate:columns":t.updateColumns,permissions:n.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",Pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(o,l)=>(e.openBlock(),e.createBlock(t.BracketColumn,{key:o.id,column:o,"column-index":l,"available-teams":n.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:n.permissions,"onUpdate:match":t.updateMatch,onHighlightTeam:t.highlightTeam,onUnhighlightTeam:t.unhighlightTeam},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])])])}const Ue=L(Me,[["render",Le],["__file","/app/src/components/bracket/BracketLower.vue"]]),j=()=>({id:null,name:O,logo:null,score:0}),F=d=>({id:`match-${d}`,number:d,[u.ONE]:j(),[u.TWO]:j(),winner:null,date:null}),Re=(d,i=3)=>{const n=[],t=Math.log2(d);let r=1;for(let a=0;a<t;a++){const o=Math.pow(2,t-a-1),l=[];for(let h=0;h<o;h++)l.push(F(r++));n.push({id:`upper-round-${a+1}`,name:`Round ${a+1}`,matches:l,bestOf:i})}return n},U=(d,i)=>{const n=[];let t=1;const r=d-1;for(let a=0;a<r;a++){const o=Math.pow(2,d-a-2),l=[];for(let h=0;h<o;h++)l.push(F(t++));n.push({id:`lower-round-${a+1}`,name:`Lower Round ${a+1}`,matches:l,bestOf:i})}return n};function H(d,i=[]){const n={};d.forEach(c=>{n[c.score]||(n[c.score]=[]),n[c.score].push(c)});const t=Object.keys(n).map(Number).sort((c,b)=>b-c),r=[],a=new Set,o=d.map(c=>c.id),l=new Set(i.map(([c,b])=>`${c}-${b}`));function h(c){const b=[],T=new Set;for(let m=0;m<c.length;m++){if(T.has(c[m].id))continue;let k=!1;for(let g=m+1;g<c.length;g++)if(!T.has(c[g].id)&&!l.has(`${c[m].id}-${c[g].id}`)&&!l.has(`${c[g].id}-${c[m].id}`)){b.push([c[m],c[g]]),T.add(c[m].id),T.add(c[g].id),a.add(c[m].id),a.add(c[g].id),k=!0;break}if(!k){for(let g of t)if(g!==c[m].score){for(let y of n[g]||[])if(!a.has(y.id)&&!l.has(`${c[m].id}-${y.id}`)&&!l.has(`${y.id}-${c[m].id}`))return b.push([c[m],y]),T.add(c[m].id),T.add(y.id),a.add(c[m].id),a.add(y.id),b}}}return b}for(let c of t){const b=n[c].filter(k=>!a.has(k.id)),T=h(b);r.push(...T);const m=b.filter(k=>!a.has(k.id));if(m.length===1){let k=!1;for(let g of t)if(g!==c){for(let y of n[g]||[])if(!a.has(y.id)&&!l.has(`${m[0].id}-${y.id}`)&&!l.has(`${y.id}-${m[0].id}`)){r.push([m[0],y]),a.add(m[0].id),a.add(y.id),k=!0;break}if(k)break}k||(r.push([m[0],null]),a.add(m[0].id))}}const w=o.filter(c=>!a.has(c));for(let c of w){const b=d.find(T=>T.id===c);r.push([b,null])}return r}function z(d){const i={},n={};d.forEach(r=>{r.matches.forEach(a=>{if(["teamOne","teamTwo"].forEach(o=>{const l=a[o];l&&(i[l.id]||(i[l.id]={...l,wins:0,losses:0,ties:0,score:0,ptsDiff:0,buchholz:0}),n[l.id]||(n[l.id]=[]))}),a.teamOne&&a.teamTwo){const o=a.teamOne,l=a.teamTwo,h=o.score||0,w=l.score||0;a.winner==="teamOne"?(i[o.id].wins++,i[o.id].score+=1,i[l.id].losses++):a.winner==="teamTwo"?(i[l.id].wins++,i[l.id].score+=1,i[o.id].losses++):a.winner===null&&(h>0||w>0)&&(i[o.id].ties++,i[l.id].ties++,i[o.id].score+=.5,i[l.id].score+=.5),i[o.id].ptsDiff+=h-w,i[l.id].ptsDiff+=w-h,n[o.id].push(l.id),n[l.id].push(o.id)}else a.teamOne&&!a.teamTwo?(i[a.teamOne.id].wins++,i[a.teamOne.id].score+=1):!a.teamOne&&a.teamTwo&&(i[a.teamTwo.id].wins++,i[a.teamTwo.id].score+=1)})}),Object.values(i).forEach(r=>{r.buchholz=(n[r.id]||[]).reduce((a,o)=>{var l;return a+(((l=i[o])==null?void 0:l.score)||0)},0)});const t=Object.values(i).sort((r,a)=>a.score-r.score||a.wins-r.wins||a.buchholz-r.buchholz||a.ptsDiff-r.ptsDiff);return t.forEach((r,a)=>{r.place=a+1}),t}const qe={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,required:!0,default:()=>({[_.CAN_SELECT_TEAM]:!0,[_.CAN_EDIT_ROUND_NAME]:!0,[_.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(d,{expose:i,emit:n}){i();const t=n,r=d,a=e.ref([]),o=e.ref([]),l=e.ref(null),h=e.computed(()=>{const s=new Set;return a.value.forEach(E=>{E.matches.forEach(p=>{p[u.ONE].name!==O&&s.add(p[u.ONE].name),p[u.TWO].name!==O&&s.add(p[u.TWO].name)})}),r.format===D.DOUBLE_ELIMINATION&&o.value.forEach(E=>{E.matches.forEach(p=>{p[u.ONE].name!==O&&s.add(p[u.ONE].name),p[u.TWO].name!==O&&s.add(p[u.TWO].name)})}),Array.from(s)}),w=e.computed(()=>r.format!==D.SWISS?[]:z(a.value)),c=e.computed(()=>{if(r.format!==D.ROUND_ROBIN)return[];const s={};a.value.forEach(p=>{p.matches.forEach(N=>{[u.ONE,u.TWO].forEach(A=>{const x=N[A];!x||!x.id||s[x.id]||(s[x.id]={...x,wins:0,losses:0,ties:0,score:0,ptsDiff:0})});const B=N[u.ONE],S=N[u.TWO];if(B&&S&&B.id&&S.id){const A=B.score||0,x=S.score||0;N.winner===u.ONE?(s[B.id].wins++,s[B.id].score+=1,s[S.id].losses++):N.winner===u.TWO?(s[S.id].wins++,s[S.id].score+=1,s[B.id].losses++):N.winner===null&&(A>0||x>0)&&(s[B.id].ties++,s[S.id].ties++,s[B.id].score+=.5,s[S.id].score+=.5),s[B.id].ptsDiff+=A-x,s[S.id].ptsDiff+=x-A}})});const E=Object.values(s).sort((p,N)=>N.score-p.score||N.wins-p.wins||N.ptsDiff-p.ptsDiff);return E.forEach((p,N)=>{p.place=N+1}),E}),b=s=>{l.value=s},T=()=>{l.value=null},m=(s,E,p)=>{if(console.log("Updating upper match:",{roundIndex:s,matchIndex:E,updatedMatch:p}),a.value[s]&&a.value[s].matches){if(a.value[s].matches[E]=p,p.winner&&s<a.value.length-1){const N=s+1,B=Math.floor(E/2);if(a.value[N]&&a.value[N].matches[B]){const S=a.value[N].matches[B],A=E%2===0?u.ONE:u.TWO,x=p[p.winner];a.value[N].matches[B]={...S,[A]:{id:x.id,name:x.name,logo:x.logo,score:0}}}}if(r.format===D.DOUBLE_ELIMINATION&&p.winner){const N=p[p.winner===u.ONE?u.TWO:u.ONE];if(N.name!==O){const B=Math.floor(s/2),S=Math.floor(E/2);if(o.value[B]&&o.value[B].matches[S]){const A=o.value[B].matches[S],x=E%2===0?u.ONE:u.TWO;o.value[B].matches[S]={...A,[x]:{id:N.id,name:N.name,logo:N.logo,score:0}}}}}y()}if(r.format===D.SWISS&&a.value[s].matches.every(S=>S.winner)&&s<a.value.length-1){const S={};for(let V=0;V<=s;V++)a.value[V].matches.forEach(I=>{["teamOne","teamTwo"].forEach(dt=>{const R=I[dt];R&&(S[R.id]||(S[R.id]={...R,score:0}))}),I.winner&&I.teamOne&&I.teamTwo&&(I.winner==="teamOne"&&(S[I.teamOne.id].score+=1),I.winner==="teamTwo"&&(S[I.teamTwo.id].score+=1))});const A=[];for(let V=0;V<=s;V++)a.value[V].matches.forEach(I=>{I.teamOne&&I.teamTwo&&A.push([I.teamOne.id,I.teamTwo.id])});const x=Object.values(S),lt=H(x,A),ct=a.value[s+1];ct.matches=lt.map((V,I)=>({id:`swiss-match-${s+2}-${I+1}`,number:I+1,teamOne:V[0],teamTwo:V[1],winner:null,date:null}))}},k=s=>{console.log("Updating upper columns:",s),a.value=s,y()},g=s=>{console.log("Updating lower state:",s),o.value=s,y()},y=()=>{console.log("Emitting tournament state:",{upper:a.value,lower:r.format===D.DOUBLE_ELIMINATION?o.value:null}),t("update:state",{upper:a.value,lower:r.format===D.DOUBLE_ELIMINATION?o.value:null})},M=()=>{console.log("Initializing tournament with state:",r.initialState),r.initialState&&(Array.isArray(r.initialState)?(a.value=JSON.parse(JSON.stringify(r.initialState)),r.format===D.DOUBLE_ELIMINATION?o.value=U(a.value.length,r.defaultBestOf):r.format===D.SWISS&&(o.value=[])):(a.value=JSON.parse(JSON.stringify(r.initialState.upper||[])),o.value=JSON.parse(JSON.stringify(r.initialState.lower||[]))))};e.watch(()=>r.initialState,()=>{M()},{deep:!0}),e.watch(()=>r.format,s=>{s===D.DOUBLE_ELIMINATION&&(!o.value||o.value.length===0)&&(o.value=U(a.value.length,r.defaultBestOf),y())});const P=s=>{t("click-match",s)};e.onMounted(()=>{M()});const f={emit:t,props:r,upperColumns:a,lowerColumns:o,highlightedTeam:l,selectedTeams:h,swissStandings:w,roundRobinStandings:c,highlightTeam:b,unhighlightTeam:T,updateUpperMatch:m,updateUpperColumns:k,updateLowerState:g,emitTournamentState:y,initializeTournament:M,onMatchClick:P,ref:e.ref,onMounted:e.onMounted,watch:e.watch,computed:e.computed,BracketColumn:q,BracketRoundHeaders:W,BracketLower:Ue,get createLowerBracketStructure(){return U},get shuffleSwissPairs(){return H},get getSwissStandings(){return z},get TOURNAMENT_FORMAT(){return D},get TBD(){return O},get TEAM_POSITION(){return u},get PERMISSIONS(){return _}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},We={class:"flex flex-col"},je={class:"flex flex-col"},Fe={class:"overflow-x-auto"},He={class:"min-w-max"},ze={class:"flex flex-1 p-5"},Je={key:1,class:"mt-8"},Ge={class:"min-w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-xs"},Ze={class:"border px-2 py-1"},Ke={class:"border px-2 py-1"},Qe={class:"border px-2 py-1"},Xe={class:"border px-2 py-1"},Ye={class:"border px-2 py-1"},ve={class:"border px-2 py-1"},$e={key:2,class:"mt-8"},et={class:"min-w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-xs"},tt={class:"border px-2 py-1"},at={class:"border px-2 py-1"},nt={class:"border px-2 py-1"},ot={class:"border px-2 py-1"},it={class:"border px-2 py-1"};function rt(d,i,n,t,r,a){return e.openBlock(),e.createElementBlock("div",We,[i[4]||(i[4]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Upper Bracket",-1)),e.createElementVNode("div",je,[e.createElementVNode("div",Fe,[e.createElementVNode("div",He,[e.createVNode(t.BracketRoundHeaders,{columns:t.upperColumns,"onUpdate:columns":t.updateUpperColumns,permissions:n.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",ze,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.upperColumns,(o,l)=>(e.openBlock(),e.createBlock(t.BracketColumn,{key:o.id,column:o,"column-index":l,"available-teams":n.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:n.permissions,"onUpdate:match":t.updateUpperMatch,onHighlightTeam:t.highlightTeam,onUnhighlightTeam:t.unhighlightTeam,onClickMatch:t.onMatchClick},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])]),n.format===t.TOURNAMENT_FORMAT.DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(t.BracketLower,{key:0,"initial-state":t.lowerColumns,"available-teams":n.availableTeams,"default-best-of":n.defaultBestOf,permissions:n.permissions,"onUpdate:state":t.updateLowerState},null,8,["initial-state","available-teams","default-best-of","permissions"])):e.createCommentVNode("v-if",!0),n.format===t.TOURNAMENT_FORMAT.SWISS?(e.openBlock(),e.createElementBlock("div",Je,[i[1]||(i[1]=e.createElementVNode("h2",{class:"text-lg font-bold mb-2"},"Standings",-1)),e.createElementVNode("table",Ge,[i[0]||(i[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"border px-2 py-1"},"Place"),e.createElementVNode("th",{class:"border px-2 py-1"},"Player"),e.createElementVNode("th",{class:"border px-2 py-1"},"W-L-T"),e.createElementVNode("th",{class:"border px-2 py-1"},"Points"),e.createElementVNode("th",{class:"border px-2 py-1"},"Buchholz"),e.createElementVNode("th",{class:"border px-2 py-1"},"Pts Diff")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.swissStandings,o=>(e.openBlock(),e.createElementBlock("tr",{key:o.id},[e.createElementVNode("td",Ze,e.toDisplayString(o.place),1),e.createElementVNode("td",Ke,e.toDisplayString(o.name),1),e.createElementVNode("td",Qe,e.toDisplayString(o.wins)+"-"+e.toDisplayString(o.losses)+"-"+e.toDisplayString(o.ties),1),e.createElementVNode("td",Xe,e.toDisplayString(o.score),1),e.createElementVNode("td",Ye,e.toDisplayString(o.buchholz),1),e.createElementVNode("td",ve,e.toDisplayString(o.ptsDiff),1)]))),128))])])])):e.createCommentVNode("v-if",!0),n.format===t.TOURNAMENT_FORMAT.ROUND_ROBIN?(e.openBlock(),e.createElementBlock("div",$e,[i[3]||(i[3]=e.createElementVNode("h2",{class:"text-lg font-bold mb-2"},"Standings",-1)),e.createElementVNode("table",et,[i[2]||(i[2]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"border px-2 py-1"},"Place"),e.createElementVNode("th",{class:"border px-2 py-1"},"Player"),e.createElementVNode("th",{class:"border px-2 py-1"},"W-L-T"),e.createElementVNode("th",{class:"border px-2 py-1"},"Points"),e.createElementVNode("th",{class:"border px-2 py-1"},"Pts Diff")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.roundRobinStandings,o=>(e.openBlock(),e.createElementBlock("tr",{key:o.id},[e.createElementVNode("td",tt,e.toDisplayString(o.place),1),e.createElementVNode("td",at,e.toDisplayString(o.name),1),e.createElementVNode("td",nt,e.toDisplayString(o.wins)+"-"+e.toDisplayString(o.losses)+"-"+e.toDisplayString(o.ties),1),e.createElementVNode("td",ot,e.toDisplayString(o.score),1),e.createElementVNode("td",it,e.toDisplayString(o.ptsDiff),1)]))),128))])])])):e.createCommentVNode("v-if",!0)])}const J=L(qe,[["render",rt],["__file","/app/src/components/TournamentBracket.vue"]]),st=d=>{d.component("TournamentBracket",J)};C.PERMISSIONS=_,C.TournamentBracket=J,C.createLowerBracketStructure=U,C.createTournamentState=Re,C.install=st,Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});
