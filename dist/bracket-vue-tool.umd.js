(function(S,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(S=typeof globalThis<"u"?globalThis:S||self,e(S.BracketVueTool={},S.Vue))})(this,function(S,e){"use strict";const O={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination",SWISS:"swiss",ROUND_ROBIN:"round_robin"},N="TBD",E={ONE:"teamOne",TWO:"teamTwo"},w={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},F={key:0,class:"flex items-center gap-2"},H=["src","alt"],z=["value","disabled"],R={key:1,class:"flex items-center gap-2"},J=["src","alt"],P={class:"text-gray-900 dark:text-white"},G={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,default:()=>({[w.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:i}){const a=t,s=i,o=e.ref(a.team.name),n=e.computed(()=>{var c;return o.value===N?null:((c=a.availableTeams.find(m=>m.name===o.value))==null?void 0:c.logo)||null});e.watch(()=>a.team,c=>{o.value=c.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const d=c=>c===N?!1:a.selectedTeams.includes(c)&&c!==a.team.name||c===a.team.name&&a.team.name!==N,r=e.computed(()=>a.availableTeams?a.availableTeams.filter(c=>c.name===N||c.name===a.team.name?!0:!d(c.name)):[]),u=()=>{a.team.name!==N&&s("highlight-team",a.team.name)},g=()=>{s("unhighlight-team")},l=()=>{const c=a.availableTeams.find(m=>m.name===o.value);console.log("Updating team:",{selectedTeam:o.value,selectedTeamData:c}),s("update:team",{position:a.teamPosition,team:{id:(c==null?void 0:c.id)||null,name:o.value,logo:(c==null?void 0:c.logo)||null,score:0}})};return(c,m)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":t.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":t.isLoser,"bg-green-500/20 dark:bg-green-500/20":t.shouldHighlight&&t.isWinner,"bg-red-500/20 dark:bg-red-500/20":t.shouldHighlight&&t.isLoser}]),onMouseenter:u,onMouseleave:g},[t.canEdit&&t.permissions[e.unref(w).CAN_SELECT_TEAM]?(e.openBlock(),e.createElementBlock("div",F,[n.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:n.value,alt:o.value,class:"w-6 h-6 rounded-full"},null,8,H)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":m[0]||(m[0]=p=>o.value=p),class:"select select-ghost w-full select-xs",onChange:l},[m[1]||(m[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,p=>(e.openBlock(),e.createElementBlock("option",{key:p.id,value:p.name,disabled:d(p.name)},e.toDisplayString(p.name),9,z))),128))],544),[[e.vModelSelect,o.value]])])):(e.openBlock(),e.createElementBlock("div",R,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,J)):e.createCommentVNode("",!0),e.createElementVNode("span",P,e.toDisplayString(t.team.name),1)]))],34))}},K={key:1,class:"text-white"},Q={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:i}){const a=t,s=i,o=e.ref(!1),n=e.ref(a.team.score??0),d=()=>{a.canEditScore&&(o.value=!0)},r=()=>{const u=parseInt(n.value)||0;s("update:score",{position:a.teamPosition,score:u})};return e.watch(()=>a.team,u=>{n.value=u.score??0},{deep:!0}),(u,g)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:d},[o.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":g[0]||(g[0]=l=>n.value=l),type:"number",class:"input input-xs",required:"",min:"0",onChange:r,onBlur:g[1]||(g[1]=l=>o.value=!1)},null,544)),[[e.vModelText,n.value]]):(e.openBlock(),e.createElementBlock("span",K,e.toDisplayString(t.team.score),1))],2))}},X={class:"flex"},q={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,default:()=>({[w.CAN_SELECT_TEAM]:!0,[w.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(i,a)=>(e.openBlock(),e.createElementBlock("div",X,[e.createVNode(G,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"is-first-team":t.isFirstTeam,"onUpdate:team":a[0]||(a[0]=s=>i.$emit("update:team",s)),onHighlightTeam:a[1]||(a[1]=s=>i.$emit("highlight-team",s)),onUnhighlightTeam:a[2]||(a[2]=s=>i.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),e.createVNode(Q,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=s=>i.$emit("update:score",s))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},Y={class:"flex flex-col w-full"},Z={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},_=["value","disabled"],v={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+10px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"},ee={__name:"BracketMatch",props:{match:{type:Object,default:()=>({teamOne:{name:N,score:0},teamTwo:{name:N,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,default:()=>({[w.CAN_SELECT_TEAM]:!0,[w.CAN_EDIT_DATE]:!0,[w.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:i}){const a=t,s=i,o=e.computed(()=>a.roundIndex===0&&a.permissions[w.CAN_SELECT_TEAM]),n=e.computed(()=>a.match[E.ONE].name!==N&&a.match[E.TWO].name!==N&&a.permissions[w.CAN_EDIT_SCOPE]),d=h=>a.match.winner===h,r=h=>a.match.winner&&a.match.winner!==h,u=h=>{const f=a.match[h].name;return a.highlightedTeam===f},g=h=>{s("highlight-team",h)},l=()=>{s("unhighlight-team")},c=({position:h,team:f})=>{const k={...a.match,[h]:f};s("update:match",k)},m=({position:h,score:f})=>{const k={...a.match,[h]:{...a.match[h],score:f}},T=k[E.ONE].score,D=k[E.TWO].score;T>D&&(k.winner=E.ONE),D>T&&(k.winner=E.TWO),T===D&&(k.winner=null),s("update:match",k)},p=h=>h?new Date(h).toISOString().slice(0,16):"",b=h=>{const f={...a.match,date:h.target.value};s("update:match",f)},y=h=>{const f=h.target.tagName.toLowerCase();f==="input"||f==="select"||f==="option"||f==="button"||h.target.closest("input,select,option,button")||!(!a.permissions[w.CAN_SELECT_TEAM]&&!a.permissions[w.CAN_EDIT_DATE]&&!a.permissions[w.CAN_EDIT_SCOPE])||s("click-match",{match:a.match,roundIndex:a.roundIndex,matchIndex:a.index,id:a.match.id??null})};return(h,f)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",Y,[e.createElementVNode("div",Z,[e.createElementVNode("input",{type:"datetime-local",value:p(t.match.date),class:"input input-ghost input-sm",disabled:!t.permissions[e.unref(w).CAN_EDIT_DATE],onInput:b},null,40,_)]),e.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:y},[e.createVNode(q,{team:t.match.teamOne,"team-position":e.unref(E).ONE,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":o.value,"can-edit-score":n.value,"is-winner":d(e.unref(E).ONE),"is-loser":r(e.unref(E).ONE),"should-highlight":u(e.unref(E).ONE),"is-first-team":!0,"can-select-team":h.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":c,"onUpdate:score":m,onHighlightTeam:g,onUnhighlightTeam:l},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),e.createVNode(q,{team:t.match.teamTwo,"team-position":e.unref(E).TWO,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":o.value,"can-edit-score":n.value,"is-winner":d(e.unref(E).TWO),"is-loser":r(e.unref(E).TWO),"should-highlight":u(e.unref(E).TWO),"can-select-team":h.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":c,"onUpdate:score":m,onHighlightTeam:g,onUnhighlightTeam:l},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",v,f[0]||(f[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},te={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},ae={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"},ne={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,default:()=>({[w.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:i}){const a=t,s=i,o=(d,r)=>{s("update:match",a.columnIndex,d,r)},n=(d,r)=>{s("click-match",{...r,roundIndex:a.columnIndex,matchIndex:d})};return(d,r)=>(e.openBlock(),e.createElementBlock("div",te,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.matches,(u,g)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:u.id},[e.createElementVNode("div",ae,e.toDisplayString(u.number),1),e.createVNode(ee,{match:u,index:g,"total-matches":t.column.matches.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:match":l=>o(g,l),onHighlightTeam:r[0]||(r[0]=l=>d.$emit("highlight-team",l)),onUnhighlightTeam:r[1]||(r[1]=l=>d.$emit("unhighlight-team")),onClickMatch:l=>n(g,l)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))]))}},ie={class:"flex justify-between px-5"},oe={class:"flex flex-col items-center gap-2"},se={class:"mt-2"},le={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},re={class:"join"},ce=["onUpdate:modelValue","disabled","onBlur"],de=["value","disabled","onChange"],me=["value"],ue={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(t,{emit:i}){const a=t,s=i,o=[1,3,5,7,9],n=e.ref(a.columns.map(u=>u.name));e.watch(()=>a.columns,u=>{n.value=u.map(g=>g.name)},{deep:!0});const d=(u,g)=>{n.value[u]=g;const l=[...a.columns];l[u]={...l[u],name:g},s("update:columns",l)},r=(u,g)=>{const l=[...a.columns];l[u]={...l[u],bestOf:Number(g)},s("update:columns",l)};return(u,g)=>(e.openBlock(),e.createElementBlock("div",ie,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(l,c)=>(e.openBlock(),e.createElementBlock("div",{key:l.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[e.createElementVNode("div",oe,[e.createElementVNode("div",se,[e.createElementVNode("div",le,[e.createElementVNode("div",re,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":m=>n.value[c]=m,disabled:!t.permissions[e.unref(w).CAN_EDIT_ROUND_NAME],type:"text",class:"input input-bordered join-item",onBlur:m=>d(c,m.target.value)},null,40,ce),[[e.vModelText,n.value[c]]]),e.createElementVNode("select",{value:l.bestOf,disabled:!t.permissions[e.unref(w).CAN_EDIT_BEST_OF],class:"select select-bordered join-item",onChange:m=>r(c,m.target.value)},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(o,m=>e.createElementVNode("option",{key:m,value:m}," Best of "+e.toDisplayString(m),9,me)),64))],40,de)])])])])]))),128))]))}},he={class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},fe={class:"flex flex-col"},ge={class:"overflow-x-auto"},pe={class:"min-w-max"},ye={class:"flex flex-1 p-5"},U={__name:"BracketSection",props:{title:{type:String,required:!0},columns:{type:Array,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0},bordered:{type:Boolean,default:!1},onMatchUpdate:{type:Function,required:!0},onColumnsUpdate:{type:Function,required:!0},onHighlight:{type:Function,required:!0},onUnhighlight:{type:Function,required:!0},onClickMatch:{type:Function,required:!1,default:()=>{}}},setup(t){return(i,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex flex-col mt-8",{"border-t-2 border-gray-300 dark:border-gray-600 pt-8":t.bordered}])},[e.createElementVNode("div",he,e.toDisplayString(t.title),1),e.createElementVNode("div",fe,[e.createElementVNode("div",ge,[e.createElementVNode("div",pe,[e.createVNode(ue,{columns:t.columns,permissions:t.permissions,"onUpdate:columns":t.onColumnsUpdate},null,8,["columns","permissions","onUpdate:columns"]),e.createElementVNode("div",ye,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(s,o)=>(e.openBlock(),e.createBlock(ne,{key:s.id,column:s,"column-index":o,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:match":t.onMatchUpdate,onHighlightTeam:t.onHighlight,onUnhighlightTeam:t.onUnhighlight,onClickMatch:t.onClickMatch},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onHighlightTeam","onUnhighlightTeam","onClickMatch"]))),128))])])])])],2))}},W=()=>({id:null,name:N,logo:null,score:0}),A=t=>({id:`match-${t}`,number:t,[E.ONE]:W(),[E.TWO]:W(),winner:null,date:null});function j(t,i){return Array.from({length:t},(a,s)=>i(s))}const Ee=(t,i=3)=>{const a=Math.log2(t);let s=1;return Array.from({length:a},(o,n)=>{const d=Math.pow(2,a-n-1),r=j(d,()=>A(s++));return{id:`upper-round-${n+1}`,name:`Round ${n+1}`,matches:r,bestOf:i}})},V=(t,i)=>{const a=t-1;let s=1;return Array.from({length:a},(o,n)=>{const d=Math.pow(2,t-n-2),r=j(d,()=>A(s++));return{id:`lower-round-${n+1}`,name:`Lower Round ${n+1}`,matches:r,bestOf:i}})},be={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},ke={class:"relative overflow-x-auto shadow-md sm:rounded-lg mt-8"},Te={class:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},we={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},Ne={key:0,scope:"col",class:"px-6 py-3"},Be={scope:"row",class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"},Se={class:"px-6 py-4"},xe={class:"px-6 py-4"},Oe={class:"px-6 py-4"},De={key:0,class:"px-6 py-4"},$e={class:"px-6 py-4"},Ve={__name:"StandingsTable",props:{standings:{type:Array,required:!0},format:{type:String,required:!0},tournamentFormat:{type:Object,required:!0}},setup(t){return(i,a)=>(e.openBlock(),e.createElementBlock("div",be,[a[5]||(a[5]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"}," Standings ",-1)),e.createElementVNode("div",ke,[e.createElementVNode("table",Te,[e.createElementVNode("thead",we,[e.createElementVNode("tr",null,[a[0]||(a[0]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Place",-1)),a[1]||(a[1]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Team",-1)),a[2]||(a[2]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"W-L-T",-1)),a[3]||(a[3]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Points",-1)),t.format===t.tournamentFormat.SWISS?(e.openBlock(),e.createElementBlock("th",Ne," Buchholz ")):e.createCommentVNode("",!0),a[4]||(a[4]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Pts Diff",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.standings,s=>(e.openBlock(),e.createElementBlock("tr",{key:s.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600"},[e.createElementVNode("th",Be,e.toDisplayString(s.place),1),e.createElementVNode("td",Se,e.toDisplayString(s.name),1),e.createElementVNode("td",xe,e.toDisplayString(s.wins)+"-"+e.toDisplayString(s.losses)+"-"+e.toDisplayString(s.ties),1),e.createElementVNode("td",Oe,e.toDisplayString(s.score),1),t.format===t.tournamentFormat.SWISS?(e.openBlock(),e.createElementBlock("td",De,e.toDisplayString(s.buchholz),1)):e.createCommentVNode("",!0),e.createElementVNode("td",$e,e.toDisplayString(s.ptsDiff),1)]))),128))])])])]))}};function Le(t){const i={},a={};t.forEach(o=>{o.matches.forEach(n=>{if(["teamOne","teamTwo"].forEach(d=>{const r=n[d];r&&(i[r.id]||(i[r.id]={...r,wins:0,losses:0,ties:0,score:0,ptsDiff:0,buchholz:0}),a[r.id]||(a[r.id]=[]))}),n.teamOne&&n.teamTwo){const d=n.teamOne,r=n.teamTwo,u=d.score||0,g=r.score||0;n.winner==="teamOne"?(i[d.id].wins++,i[d.id].score+=1,i[r.id].losses++):n.winner==="teamTwo"?(i[r.id].wins++,i[r.id].score+=1,i[d.id].losses++):n.winner===null&&(u>0||g>0)&&(i[d.id].ties++,i[r.id].ties++,i[d.id].score+=.5,i[r.id].score+=.5),i[d.id].ptsDiff+=u-g,i[r.id].ptsDiff+=g-u,a[d.id].push(r.id),a[r.id].push(d.id)}else n.teamOne&&!n.teamTwo?(i[n.teamOne.id].wins++,i[n.teamOne.id].score+=1):!n.teamOne&&n.teamTwo&&(i[n.teamTwo.id].wins++,i[n.teamTwo.id].score+=1)})}),Object.values(i).forEach(o=>{o.buchholz=(a[o.id]||[]).reduce((n,d)=>{var r;return n+(((r=i[d])==null?void 0:r.score)||0)},0)});const s=Object.values(i).sort((o,n)=>n.score-o.score||n.wins-o.wins||n.buchholz-o.buchholz||n.ptsDiff-o.ptsDiff);return s.forEach((o,n)=>{o.place=n+1}),s}function L(t,i){return t.filter(a=>!!a.id&&a.name!==i)}function C(t,i,a,s,o,n){const d=i.score||0,r=a.score||0;s===o?(t[i.id].wins++,t[i.id].score+=1,t[a.id].losses++):s===n?(t[a.id].wins++,t[a.id].score+=1,t[i.id].losses++):s===null&&(d>0||r>0)&&(t[i.id].ties++,t[a.id].ties++,t[i.id].score+=.5,t[a.id].score+=.5),t[i.id].ptsDiff+=d-r,t[a.id].ptsDiff+=r-d}function Ce({upperColumns:t,lowerColumns:i,format:a,TOURNAMENT_FORMAT:s,TEAM_POSITION:o,TBD:n}){switch(a){case s.SWISS:return L(qe(t),n);case s.ROUND_ROBIN:return L(Ue(t,o),n);case s.SINGLE_ELIMINATION:case s.DOUBLE_ELIMINATION:default:return L(We(t,i,a,s,o),n)}}function qe(t){return Le(t)}function Ue(t,i){const a={};for(const s of t)for(const o of s.matches){for(const r of[i.ONE,i.TWO]){const u=o[r];!u||!u.id||a[u.id]||(a[u.id]={...u,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const n=o[i.ONE],d=o[i.TWO];n&&d&&n.id&&d.id&&C(a,n,d,o.winner,i.ONE,i.TWO)}return I(a,["score","wins","ptsDiff"])}function We(t,i,a,s,o){const n={};for(const d of t)for(const r of d.matches){for(const l of[o.ONE,o.TWO]){const c=r[l];!c||!c.id||n[c.id]||(n[c.id]={...c,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const u=r[o.ONE],g=r[o.TWO];u&&g&&u.id&&g.id&&C(n,u,g,r.winner,o.ONE,o.TWO)}if(a===s.DOUBLE_ELIMINATION&&i)for(const d of i)for(const r of d.matches){for(const l of[o.ONE,o.TWO]){const c=r[l];!c||!c.id||n[c.id]||(n[c.id]={...c,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const u=r[o.ONE],g=r[o.TWO];u&&g&&u.id&&g.id&&C(n,u,g,r.winner,o.ONE,o.TWO)}return I(n,["score","wins","ptsDiff"])}function I(t,i){const a=Object.values(t).sort((s,o)=>{for(const n of i)if(o[n]!==s[n])return o[n]-s[n];return 0});return a.forEach((s,o)=>{s.place=o+1}),a}function Ae(t,i=[]){const a={};t.forEach(l=>{a[l.score]||(a[l.score]=[]),a[l.score].push(l)});const s=Object.keys(a).map(Number).sort((l,c)=>c-l),o=[],n=new Set,d=t.map(l=>l.id),r=new Set(i.map(([l,c])=>`${l}-${c}`));function u(l){const c=[],m=new Set;for(let p=0;p<l.length;p++){if(m.has(l[p].id))continue;let b=!1;for(let y=p+1;y<l.length;y++)if(!m.has(l[y].id)&&!r.has(`${l[p].id}-${l[y].id}`)&&!r.has(`${l[y].id}-${l[p].id}`)){c.push([l[p],l[y]]),m.add(l[p].id),m.add(l[y].id),n.add(l[p].id),n.add(l[y].id),b=!0;break}if(!b){for(let y of s)if(y!==l[p].score){for(let h of a[y]||[])if(!n.has(h.id)&&!r.has(`${l[p].id}-${h.id}`)&&!r.has(`${h.id}-${l[p].id}`))return c.push([l[p],h]),m.add(l[p].id),m.add(h.id),n.add(l[p].id),n.add(h.id),c}}}return c}for(let l of s){const c=a[l].filter(b=>!n.has(b.id)),m=u(c);o.push(...m);const p=c.filter(b=>!n.has(b.id));if(p.length===1){let b=!1;for(let y of s)if(y!==l){for(let h of a[y]||[])if(!n.has(h.id)&&!r.has(`${p[0].id}-${h.id}`)&&!r.has(`${h.id}-${p[0].id}`)){o.push([p[0],h]),n.add(p[0].id),n.add(h.id),b=!0;break}if(b)break}b||(o.push([p[0],null]),n.add(p[0].id))}}const g=d.filter(l=>!n.has(l));for(let l of g){const c=t.find(m=>m.id===l);o.push([c,null])}return o}function je({upperColumns:t,lowerColumns:i,props:a,emit:s,TOURNAMENT_FORMAT:o,TEAM_POSITION:n,TBD:d}){function r(m,p,b){if(t.value[m]&&t.value[m].matches){if(t.value[m].matches[p]=b,b.winner&&m<t.value.length-1){const y=m+1,h=Math.floor(p/2);if(t.value[y]&&t.value[y].matches[h]){const f=t.value[y].matches[h],k=p%2===0?n.ONE:n.TWO,T=b[b.winner];t.value[y].matches[h]={...f,[k]:{id:T.id,name:T.name,logo:T.logo,score:0}}}}if(a.format===o.DOUBLE_ELIMINATION&&b.winner){const y=b[b.winner===n.ONE?n.TWO:n.ONE];if(y.name!==d){const h=Math.floor(m/2),f=Math.floor(p/2);if(i.value[h]&&i.value[h].matches[f]){const k=i.value[h].matches[f],T=p%2===0?n.ONE:n.TWO;i.value[h].matches[f]={...k,[T]:{id:y.id,name:y.name,logo:y.logo,score:0}}}}}l()}if(a.format===o.SWISS&&t.value[m].matches.every(f=>f.winner)&&m<t.value.length-1){const f={};for(let x=0;x<=m;x++)t.value[x].matches.forEach(B=>{["teamOne","teamTwo"].forEach(He=>{const $=B[He];$&&(f[$.id]||(f[$.id]={...$,score:0}))}),B.winner&&B.teamOne&&B.teamTwo&&(B.winner==="teamOne"&&(f[B.teamOne.id].score+=1),B.winner==="teamTwo"&&(f[B.teamTwo.id].score+=1))});const k=[];for(let x=0;x<=m;x++)t.value[x].matches.forEach(B=>{B.teamOne&&B.teamTwo&&k.push([B.teamOne.id,B.teamTwo.id])});const T=Object.values(f),D=Ae(T,k),Fe=t.value[m+1];Fe.matches=D.map((x,B)=>({id:`swiss-match-${m+2}-${B+1}`,number:B+1,teamOne:x[0],teamTwo:x[1],winner:null,date:null}))}}function u(m){t.value=m,l()}function g(m){i.value=m,l()}function l(){s("update:state",{upper:t.value,lower:a.format===o.DOUBLE_ELIMINATION?i.value:null})}function c(){if(a.initialState){if(Array.isArray(a.initialState)){if(t.value=JSON.parse(JSON.stringify(a.initialState)),a.format===o.DOUBLE_ELIMINATION){i.value=V(t.value.length,a.defaultBestOf);return}if(a.format===o.SWISS){i.value=[];return}return}t.value=JSON.parse(JSON.stringify(a.initialState.upper||[])),i.value=JSON.parse(JSON.stringify(a.initialState.lower||[]))}}return{updateUpperMatch:r,updateUpperColumns:u,updateLowerState:g,emitTournamentState:l,initializeTournament:c}}const Ie={class:"flex flex-col"},M={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,default:()=>({[w.CAN_SELECT_TEAM]:!0,[w.CAN_EDIT_ROUND_NAME]:!0,[w.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(t,{emit:i}){const a=i,s=t,o=e.ref([]),n=e.ref([]),d=e.ref(null),r=e.computed(()=>{const f=new Set;return o.value.forEach(k=>{k.matches.forEach(T=>{T[E.ONE].name!==N&&f.add(T[E.ONE].name),T[E.TWO].name!==N&&f.add(T[E.TWO].name)})}),s.format===O.DOUBLE_ELIMINATION&&n.value.forEach(k=>{k.matches.forEach(T=>{T[E.ONE].name!==N&&f.add(T[E.ONE].name),T[E.TWO].name!==N&&f.add(T[E.TWO].name)})}),Array.from(f)}),u=e.computed(()=>Ce({upperColumns:o.value,lowerColumns:n.value,format:s.format,TOURNAMENT_FORMAT:O,TEAM_POSITION:E,TBD:N})),g=f=>{d.value=f},l=()=>{d.value=null},c=f=>{a("click-match",f)},{updateUpperMatch:m,updateUpperColumns:p,updateLowerState:b,emitTournamentState:y,initializeTournament:h}=je({upperColumns:o,lowerColumns:n,props:s,emit:a,TOURNAMENT_FORMAT:O,TEAM_POSITION:E,TBD:N});return e.watch(()=>s.initialState,()=>{h()},{deep:!0}),e.watch(()=>s.format,f=>{f===O.DOUBLE_ELIMINATION&&(!n.value||n.value.length===0)&&(n.value=V(o.value.length,s.defaultBestOf),y())}),e.onMounted(()=>{h()}),(f,k)=>(e.openBlock(),e.createElementBlock("div",Ie,[e.createVNode(U,{title:"Upper Bracket",columns:o.value,"available-teams":t.availableTeams,"selected-teams":r.value,"highlighted-team":d.value,permissions:t.permissions,"on-match-update":e.unref(m),"on-columns-update":e.unref(p),"on-highlight":g,"on-unhighlight":l,"on-click-match":c},null,8,["columns","available-teams","selected-teams","highlighted-team","permissions","on-match-update","on-columns-update"]),t.format===e.unref(O).DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(U,{key:0,title:"Lower Bracket",columns:n.value,"available-teams":t.availableTeams,"selected-teams":r.value,"highlighted-team":d.value,permissions:t.permissions,bordered:"","on-match-update":e.unref(b),"on-columns-update":e.unref(b),"on-highlight":g,"on-unhighlight":l},null,8,["columns","available-teams","selected-teams","highlighted-team","permissions","on-match-update","on-columns-update"])):e.createCommentVNode("",!0),e.createVNode(Ve,{standings:u.value,format:t.format,"tournament-format":e.unref(O)},null,8,["standings","format","tournament-format"])]))}},Me=t=>{t.component("TournamentBracket",M)};S.PERMISSIONS=w,S.TournamentBracket=M,S.createLowerBracketStructure=V,S.createTournamentState=Ee,S.install=Me,Object.defineProperty(S,Symbol.toStringTag,{value:"Module"})});
