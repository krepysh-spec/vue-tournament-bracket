(function(w,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(w=typeof globalThis<"u"?globalThis:w||self,e(w.BracketVueTool={},w.Vue))})(this,function(w,e){"use strict";const U={key:0,class:"relative"},D=["value","disabled"],M=["src","alt"],L={key:1,class:"flex items-center gap-2"},A=["src","alt"],C={class:"text-gray-900 dark:text-white"},R={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:g}){const a=t,l=g,n=e.ref(a.team.name),i=e.computed(()=>{var s;return n.value==="TBD"?null:((s=a.availableTeams.find(T=>T.name===n.value))==null?void 0:s.logo)||null});e.watch(()=>a.team,s=>{n.value=s.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const c=s=>s==="TBD"?!1:a.selectedTeams.includes(s)&&s!==a.team.name||s===a.team.name&&a.team.name!=="TBD",d=e.computed(()=>a.availableTeams?a.availableTeams.filter(s=>s.name==="TBD"||s.name===a.team.name?!0:!c(s.name)):[]),u=()=>{a.team.name!=="TBD"&&l("highlight-team",a.team.name)},m=()=>{l("unhighlight-team")},y=()=>{const s=a.availableTeams.find(T=>T.name===n.value);console.log("Updating team:",{selectedTeam:n.value,selectedTeamData:s}),l("update:team",{position:a.teamPosition,team:{id:(s==null?void 0:s.id)||null,name:n.value,logo:(s==null?void 0:s.logo)||null,score:0}})};return(s,T)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200 dark:hover:bg-gray-700",{"hover:bg-green-900/30 dark:hover:bg-green-900/30":t.isWinner,"hover:bg-red-900/30 dark:hover:bg-red-900/30":t.isLoser,"bg-green-900/30 dark:bg-green-900/30":t.shouldHighlight&&t.isWinner,"bg-red-900/30 dark:bg-red-900/30":t.shouldHighlight&&t.isLoser}]),onMouseenter:u,onMouseleave:m},[t.canEdit?(e.openBlock(),e.createElementBlock("div",U,[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":T[0]||(T[0]=r=>n.value=r),class:"w-full cursor-pointer bg-transparent text-gray-900 dark:text-white pl-8",onChange:y},[T[1]||(T[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,r=>(e.openBlock(),e.createElementBlock("option",{key:r.id,value:r.name,disabled:c(r.name)},e.toDisplayString(r.name),9,D))),128))],544),[[e.vModelSelect,n.value]]),i.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:i.value,alt:n.value,class:"absolute left-1 top-1/2 -translate-y-1/2 w-5 h-5 rounded-full"},null,8,M)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("div",L,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,A)):e.createCommentVNode("",!0),e.createElementVNode("span",C,e.toDisplayString(t.team.name),1)]))],34))}},H={key:1,class:"text-white"},F={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:g}){const a=t,l=g,n=e.ref(!1),i=e.ref(a.team.score??0),c=()=>{a.canEditScore&&(n.value=!0)},d=()=>{const u=parseInt(i.value)||0;l("update:score",{position:a.teamPosition,score:u})};return e.watch(()=>a.team,u=>{i.value=u.score??0},{deep:!0}),(u,m)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:c},[n.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":m[0]||(m[0]=y=>i.value=y),class:"w-12 bg-orange-500 dark:bg-orange-600 text-center text-white",min:"0",onChange:d,onBlur:m[1]||(m[1]=y=>n.value=!1)},null,544)),[[e.vModelText,i.value]]):(e.openBlock(),e.createElementBlock("span",H,e.toDisplayString(t.team.score),1))],2))}},P={class:"flex"},O={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(g,a)=>(e.openBlock(),e.createElementBlock("div",P,[e.createVNode(R,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"onUpdate:team":a[0]||(a[0]=l=>g.$emit("update:team",l)),onHighlightTeam:a[1]||(a[1]=l=>g.$emit("highlight-team",l)),onUnhighlightTeam:a[2]||(a[2]=l=>g.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","can-edit","is-winner","is-loser","should-highlight"]),e.createVNode(F,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=l=>g.$emit("update:score",l))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},j={class:"my-1.5 ml-2.5 bg-white dark:bg-gray-800 rounded overflow-hidden w-full min-w-[200px] shadow"},z={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[1px] mx-2 transition-colors duration-200"},J={__name:"BracketMatch",props:{match:{type:Object,required:!0},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:g}){const a=t,l=g,n=e.computed(()=>a.roundIndex===0),i=e.computed(()=>a.match.teamOne.name!=="TBD"&&a.match.teamTwo.name!=="TBD"),c=r=>a.match.winner===r,d=r=>a.match.winner&&a.match.winner!==r,u=r=>{const f=a.match[r].name;return a.highlightedTeam===f},m=r=>{l("highlight-team",r)},y=()=>{l("unhighlight-team")},s=({position:r,team:f})=>{const o={...a.match,[r]:f};l("update:match",o)},T=({position:r,score:f})=>{const o={...a.match,[r]:{...a.match[r],score:f}};o.teamOne.score>0||o.teamTwo.score>0?o.winner=o.teamOne.score>o.teamTwo.score?"teamOne":"teamTwo":o.winner=null,l("update:match",o)};return(r,f)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",j,[e.createVNode(O,{team:t.match.teamOne,"team-position":"teamOne","available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":c("teamOne"),"is-loser":d("teamOne"),"should-highlight":u("teamOne"),"is-first-team":!0,"onUpdate:team":s,"onUpdate:score":T,onHighlightTeam:m,onUnhighlightTeam:y},null,8,["team","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"]),e.createVNode(O,{team:t.match.teamTwo,"team-position":"teamTwo","available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":i.value,"is-winner":c("teamTwo"),"is-loser":d("teamTwo"),"should-highlight":u("teamTwo"),"onUpdate:team":s,"onUpdate:score":T,onHighlightTeam:m,onUnhighlightTeam:y},null,8,["team","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight"])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",z,f[0]||(f[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},W={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},G={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50"},v={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null}},emits:["update:match","highlight-team","unhighlight-team"],setup(t,{emit:g}){const a=t,l=g,n=(i,c)=>{l("update:match",a.columnIndex,i,c)};return(i,c)=>(e.openBlock(),e.createElementBlock("div",W,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.items,(d,u)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:d.number},[e.createElementVNode("div",G,e.toDisplayString(d.number),1),e.createVNode(J,{match:d,index:u,"total-matches":t.column.items.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,"onUpdate:match":m=>n(u,m),onHighlightTeam:c[0]||(c[0]=m=>i.$emit("highlight-team",m)),onUnhighlightTeam:c[1]||(c[1]=m=>i.$emit("unhighlight-team"))},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","onUpdate:match"])],64))),128))]))}},K={class:"flex justify-between px-5"},Q={class:"flex flex-col items-center gap-2"},X=["value","onInput"],Y=["value","onChange"],Z=["value"],$={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0}},emits:["update:columns"],setup(t,{emit:g}){const a=t,l=g,n=[1,3,5,7,9],i=(d,u)=>{const m=[...a.columns];m[d]={...m[d],name:u},l("update:columns",m)},c=(d,u)=>{const m=[...a.columns];m[d]={...m[d],bestOf:Number(u)},l("update:columns",m)};return(d,u)=>(e.openBlock(),e.createElementBlock("div",K,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(m,y)=>(e.openBlock(),e.createElementBlock("div",{key:m.name,class:"flex-1 text-center text-sm text-gray-400"},[e.createElementVNode("div",Q,[e.createElementVNode("input",{value:m.name,onInput:s=>i(y,s.target.value),class:"bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded text-center w-32 text-gray-900 dark:text-white"},null,40,X),e.createElementVNode("select",{value:m.bestOf,onChange:s=>c(y,s.target.value),class:"bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded text-center w-32 text-gray-900 dark:text-white"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(n,s=>e.createElementVNode("option",{key:s,value:s}," Best of "+e.toDisplayString(s),9,Z)),64))],40,Y)])]))),128))]))}},I={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},_={class:"flex flex-col"},ee={class:"overflow-x-auto"},te={class:"min-w-max"},ae={class:"flex flex-1 p-5"},ne={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)}},emits:["update:state"],setup(t,{emit:g}){const a=g,l=t,n=e.ref([]),i=e.ref(null),c=e.computed(()=>{const r=new Set;return n.value.forEach(f=>{f.items.forEach(o=>{o.teamOne.name!=="TBD"&&r.add(o.teamOne.name),o.teamTwo.name!=="TBD"&&r.add(o.teamTwo.name)})}),Array.from(r)}),d=r=>{i.value=r},u=()=>{i.value=null},m=(r,f,o)=>{if(console.log("Updating lower match:",{roundIndex:r,matchIndex:f,updatedMatch:o}),n.value[r]&&n.value[r].items){if(n.value[r].items[f]=o,o.winner&&r<n.value.length-1){const p=r+1,h=Math.floor(f/2);if(n.value[p]&&n.value[p].items[h]){const b=n.value[p].items[h],k=f%2===0?"teamOne":"teamTwo",B=o[o.winner];n.value[p].items[h]={...b,[k]:{id:B.id,name:B.name,logo:B.logo,score:0}}}}s()}},y=r=>{console.log("Updating lower columns:",r),n.value=r,s()},s=()=>{console.log("Emitting lower tournament state:",n.value),a("update:state",n.value)},T=()=>{console.log("Initializing lower tournament with state:",l.initialState),l.initialState&&l.initialState.length>0&&(n.value=JSON.parse(JSON.stringify(l.initialState)))};return e.watch(()=>l.initialState,()=>{T()},{deep:!0}),e.onMounted(()=>{T()}),(r,f)=>(e.openBlock(),e.createElementBlock("div",I,[f[0]||(f[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Lower Bracket",-1)),e.createElementVNode("div",_,[e.createElementVNode("div",ee,[e.createElementVNode("div",te,[e.createVNode($,{columns:n.value,"onUpdate:columns":y},null,8,["columns"]),e.createElementVNode("div",ae,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(o,p)=>(e.openBlock(),e.createBlock(v,{key:o.name,column:o,"column-index":p,"available-teams":t.availableTeams,"selected-teams":c.value,"highlighted-team":i.value,"onUpdate:match":m,onHighlightTeam:d,onUnhighlightTeam:u},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])])]))}},V=()=>({id:null,name:"TBD",logo:null,score:0}),E=t=>({number:t,teamOne:V(),teamTwo:V(),winner:null}),le=(t,g=3)=>{const a=[],l=Math.log2(t);let n=1;for(let i=0;i<l;i++){const c=Math.pow(2,l-i-1),d=[];for(let u=0;u<c;u++)d.push(E(n++));a.push({name:`Round ${i+1}`,items:d,bestOf:g})}return a},S=(t,g)=>{const a=[];let l=1;const n=Math.pow(2,t-2),i={name:"Lower Round 1",bestOf:g,items:Array(n).fill(null).map(()=>E(l++))};a.push(i);const c=Math.pow(2,t-3),d={name:"Lower Round 2",bestOf:g,items:Array(c).fill(null).map(()=>E(l++))};if(a.push(d),t>3){const u=Math.pow(2,t-4),m={name:"Lower Round 3",bestOf:g,items:Array(u).fill(null).map(()=>E(l++))};a.push(m)}return a},oe={class:"flex flex-col"},ie={class:"flex flex-col"},re={class:"overflow-x-auto"},se={class:"min-w-max"},me={class:"flex flex-1 p-5"},q={__name:"TournamentBracket",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)},isDoubleElimination:{type:Boolean,default:!1}},emits:["update:state"],setup(t,{emit:g}){const a=g,l=t,n=e.ref([]),i=e.ref([]),c=e.ref(null),d=e.computed(()=>{const o=new Set;return n.value.forEach(p=>{p.items.forEach(h=>{h.teamOne.name!=="TBD"&&o.add(h.teamOne.name),h.teamTwo.name!=="TBD"&&o.add(h.teamTwo.name)})}),l.isDoubleElimination&&i.value.forEach(p=>{p.items.forEach(h=>{h.teamOne.name!=="TBD"&&o.add(h.teamOne.name),h.teamTwo.name!=="TBD"&&o.add(h.teamTwo.name)})}),Array.from(o)}),u=o=>{c.value=o},m=()=>{c.value=null},y=(o,p,h)=>{if(console.log("Updating upper match:",{roundIndex:o,matchIndex:p,updatedMatch:h}),n.value[o]&&n.value[o].items){if(n.value[o].items[p]=h,h.winner&&o<n.value.length-1){const b=o+1,k=Math.floor(p/2);if(n.value[b]&&n.value[b].items[k]){const B=n.value[b].items[k],N=p%2===0?"teamOne":"teamTwo",x=h[h.winner];n.value[b].items[k]={...B,[N]:{id:x.id,name:x.name,logo:x.logo,score:0}}}}if(l.isDoubleElimination&&h.winner){const b=h[h.winner==="teamOne"?"teamTwo":"teamOne"];if(b.name!=="TBD"){const k=Math.floor(o/2),B=Math.floor(p/2);if(i.value[k]&&i.value[k].items[B]){const N=i.value[k].items[B],x=p%2===0?"teamOne":"teamTwo";i.value[k].items[B]={...N,[x]:{id:b.id,name:b.name,logo:b.logo,score:0}}}}}r()}},s=o=>{console.log("Updating upper columns:",o),n.value=o,r()},T=o=>{console.log("Updating lower state:",o),i.value=o,r()},r=()=>{console.log("Emitting tournament state:",{upper:n.value,lower:l.isDoubleElimination?i.value:null}),a("update:state",{upper:n.value,lower:l.isDoubleElimination?i.value:null})},f=()=>{console.log("Initializing tournament with state:",l.initialState),l.initialState&&(Array.isArray(l.initialState)?(n.value=JSON.parse(JSON.stringify(l.initialState)),l.isDoubleElimination&&(i.value=S(n.value.length,l.defaultBestOf))):(n.value=JSON.parse(JSON.stringify(l.initialState.upper||[])),i.value=JSON.parse(JSON.stringify(l.initialState.lower||[]))))};return e.watch(()=>l.initialState,()=>{f()},{deep:!0}),e.watch(()=>l.isDoubleElimination,o=>{o&&(!i.value||i.value.length===0)&&(i.value=S(n.value.length,l.defaultBestOf),r())}),e.onMounted(()=>{f()}),(o,p)=>(e.openBlock(),e.createElementBlock("div",oe,[p[0]||(p[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4 px-5"},"Upper Bracket",-1)),e.createElementVNode("div",ie,[e.createElementVNode("div",re,[e.createElementVNode("div",se,[e.createVNode($,{columns:n.value,"onUpdate:columns":s},null,8,["columns"]),e.createElementVNode("div",me,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(h,b)=>(e.openBlock(),e.createBlock(v,{key:h.name,column:h,"column-index":b,"available-teams":t.availableTeams,"selected-teams":d.value,"highlighted-team":c.value,"onUpdate:match":y,onHighlightTeam:u,onUnhighlightTeam:m},null,8,["column","column-index","available-teams","selected-teams","highlighted-team"]))),128))])])])]),t.isDoubleElimination?(e.openBlock(),e.createBlock(ne,{key:0,"initial-state":i.value,"available-teams":t.availableTeams,"default-best-of":t.defaultBestOf,"onUpdate:state":T},null,8,["initial-state","available-teams","default-best-of"])):e.createCommentVNode("",!0)]))}},ce=t=>{t.component("TournamentBracket",q)};w.TournamentBracket=q,w.createLowerBracketStructure=S,w.createTournamentState=le,w.install=ce,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
