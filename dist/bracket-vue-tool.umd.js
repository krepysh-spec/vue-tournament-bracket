(function(x,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(x=typeof globalThis<"u"?globalThis:x||self,t(x.BracketVueTool={},x.Vue))})(this,function(x,t){"use strict";const I={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination",SWISS:"swiss",ROUND_ROBIN:"round_robin"},w="TBD",b={ONE:"teamOne",TWO:"teamTwo"},S={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},D=(o,a)=>{const n=o.__vccOpts||o;for(const[e,r]of a)n[e]=r;return n},G={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,default:()=>({[S.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(o,{expose:a,emit:n}){a();const e=o,r=n,i=t.ref(e.team.name),s=t.computed(()=>{var m;return i.value===w?null:((m=e.availableTeams.find(T=>T.name===i.value))==null?void 0:m.logo)||null});t.watch(()=>e.team,m=>{i.value=m.name},{immediate:!0}),t.onMounted(()=>{console.log("TeamSelect mounted:",{team:e.team,availableTeams:e.availableTeams})});const l=m=>m===w?!1:e.selectedTeams.includes(m)&&m!==e.team.name||m===e.team.name&&e.team.name!==w,d=t.computed(()=>e.availableTeams?e.availableTeams.filter(m=>m.name===w||m.name===e.team.name?!0:!l(m.name)):[]),h={props:e,emit:r,selectedTeam:i,selectedTeamLogo:s,isTeamSelected:l,availableTeamsForSelection:d,highlightTeam:()=>{e.team.name!==w&&r("highlight-team",e.team.name)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:()=>{const m=e.availableTeams.find(T=>T.name===i.value);console.log("Updating team:",{selectedTeam:i.value,selectedTeamData:m}),r("update:team",{position:e.teamPosition,team:{id:(m==null?void 0:m.id)||null,name:i.value,logo:(m==null?void 0:m.logo)||null,score:0}})},ref:t.ref,computed:t.computed,onMounted:t.onMounted,watch:t.watch,get TBD(){return w},get PERMISSIONS(){return S}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},v={key:0,class:"flex items-center gap-2"},K=["src","alt"],Y=["value","disabled"],Q={key:1,class:"flex items-center gap-2"},X=["src","alt"],Z={class:"text-gray-900 dark:text-white"};function $(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":n.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":n.isLoser,"bg-green-500/20 dark:bg-green-500/20":n.shouldHighlight&&n.isWinner,"bg-red-500/20 dark:bg-red-500/20":n.shouldHighlight&&n.isLoser}]),onMouseenter:e.highlightTeam,onMouseleave:e.unhighlightTeam},[n.canEdit&&n.permissions[e.PERMISSIONS.CAN_SELECT_TEAM]?(t.openBlock(),t.createElementBlock("div",v,[e.selectedTeamLogo?(t.openBlock(),t.createElementBlock("img",{key:0,src:e.selectedTeamLogo,alt:e.selectedTeam,class:"w-6 h-6 rounded-full"},null,8,K)):t.createCommentVNode("v-if",!0),t.withDirectives(t.createElementVNode("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>e.selectedTeam=s),class:"select select-ghost w-full select-xs",onChange:e.updateTeam},[a[1]||(a[1]=t.createElementVNode("option",{value:"TBD"},"TBD",-1)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.availableTeamsForSelection,s=>(t.openBlock(),t.createElementBlock("option",{key:s.id,value:s.name,disabled:e.isTeamSelected(s.name)},t.toDisplayString(s.name),9,Y))),128))],544),[[t.vModelSelect,e.selectedTeam]])])):(t.openBlock(),t.createElementBlock("div",Q,[n.team.logo?(t.openBlock(),t.createElementBlock("img",{key:0,src:n.team.logo,alt:n.team.name,class:"w-6 h-6 rounded-full"},null,8,X)):t.createCommentVNode("v-if",!0),t.createElementVNode("span",Z,t.toDisplayString(n.team.name),1)]))],34)}const ee=D(G,[["render",$],["__file","/app/src/components/team/TeamSelect.vue"]]),te={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(o,{expose:a,emit:n}){a();const e=o,r=n,i=t.ref(!1),s=t.ref(e.team.score??0),l=()=>{e.canEditScore&&(i.value=!0)},d=()=>{const c=parseInt(s.value)||0;r("update:score",{position:e.teamPosition,score:c})};t.watch(()=>e.team,c=>{s.value=c.score??0},{deep:!0});const f={props:e,emit:r,isEditing:i,score:s,selectScore:l,updateScore:d,ref:t.ref,watch:t.watch};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},ne={key:1,class:"text-white"};function ae(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":n.isFirstTeam}]),onClick:e.selectScore},[e.isEditing?t.withDirectives((t.openBlock(),t.createElementBlock("input",{key:0,"onUpdate:modelValue":a[0]||(a[0]=s=>e.score=s),type:"number",class:"input input-xs",required:"",min:"0",onChange:e.updateScore,onBlur:a[1]||(a[1]=s=>e.isEditing=!1)},null,544)),[[t.vModelText,e.score]]):(t.openBlock(),t.createElementBlock("span",ne,t.toDisplayString(n.team.score),1))],2)}const ie=D(te,[["render",ae],["__file","/app/src/components/team/TeamScoreInput.vue"]]),oe={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,default:()=>({[S.CAN_SELECT_TEAM]:!0,[S.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(o,{expose:a}){a();const e={props:o,TeamSelect:ee,TeamScoreInput:ie,get PERMISSIONS(){return S}};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},re={class:"flex"};function se(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",re,[t.createVNode(e.TeamSelect,{team:n.team,"team-position":n.teamPosition,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"can-edit":n.canEdit,"is-winner":n.isWinner,"is-loser":n.isLoser,"should-highlight":n.shouldHighlight,"is-first-team":n.isFirstTeam,"onUpdate:team":a[0]||(a[0]=s=>o.$emit("update:team",s)),onHighlightTeam:a[1]||(a[1]=s=>o.$emit("highlight-team",s)),onUnhighlightTeam:a[2]||(a[2]=s=>o.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),t.createVNode(e.TeamScoreInput,{team:n.team,"team-position":n.teamPosition,"can-edit-score":n.canEditScore,"is-first-team":n.isFirstTeam,"onUpdate:score":a[3]||(a[3]=s=>o.$emit("update:score",s))},null,8,["team","team-position","can-edit-score","is-first-team"])])}const le=D(oe,[["render",se],["__file","/app/src/components/team/TeamRow.vue"]]),ce={__name:"BracketMatch",props:{match:{type:Object,default:()=>({teamOne:{name:w,score:0},teamTwo:{name:w,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,default:()=>({[S.CAN_SELECT_TEAM]:!0,[S.CAN_EDIT_DATE]:!0,[S.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(o,{expose:a,emit:n}){a();const e=o,r=n,i=t.computed(()=>e.roundIndex===0&&e.permissions[S.CAN_SELECT_TEAM]),s=t.computed(()=>e.match[b.ONE].name!==w&&e.match[b.TWO].name!==w&&e.permissions[S.CAN_EDIT_SCOPE]),B={props:e,emit:r,canEdit:i,canEditScore:s,isWinner:g=>e.match.winner===g,isLoser:g=>e.match.winner&&e.match.winner!==g,shouldHighlight:g=>{const p=e.match[g].name;return e.highlightedTeam===p},highlightTeam:g=>{r("highlight-team",g)},unhighlightTeam:()=>{r("unhighlight-team")},updateTeam:({position:g,team:p})=>{const O={...e.match,[g]:p};r("update:match",O)},updateScore:({position:g,score:p})=>{const O={...e.match,[g]:{...e.match[g],score:p}},y=O[b.ONE].score,k=O[b.TWO].score;y>k&&(O.winner=b.ONE),k>y&&(O.winner=b.TWO),y===k&&(O.winner=null),r("update:match",O)},formatDateTimeForInput:g=>g?new Date(g).toISOString().slice(0,16):"",updateDate:g=>{const p={...e.match,date:g.target.value};r("update:match",p)},formatDate:g=>g?new Date(g).toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}):"",onMatchClick:g=>{const p=g.target.tagName.toLowerCase();p==="input"||p==="select"||p==="option"||p==="button"||g.target.closest("input,select,option,button")||!(!e.permissions[S.CAN_SELECT_TEAM]&&!e.permissions[S.CAN_EDIT_DATE]&&!e.permissions[S.CAN_EDIT_SCOPE])||r("click-match",{match:e.match,roundIndex:e.roundIndex,matchIndex:e.index,id:e.match.id??null})},computed:t.computed,TeamRow:le,get TBD(){return w},get TEAM_POSITION(){return b},get PERMISSIONS(){return S}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}},de={class:"flex flex-col w-full"},me={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},he=["value","disabled"],ue={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+10px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"};function ge(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["relative text-[0.8em] flex items-center",{group:n.index%2==0&&n.totalMatches>1}])},[t.createElementVNode("div",de,[t.createElementVNode("div",me,[t.createElementVNode("input",{type:"datetime-local",value:e.formatDateTimeForInput(n.match.date),class:"input input-ghost input-sm",disabled:!n.permissions[e.PERMISSIONS.CAN_EDIT_DATE],onInput:e.updateDate},null,40,he)]),t.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:e.onMatchClick},[t.createVNode(e.TeamRow,{team:n.match.teamOne,"team-position":e.TEAM_POSITION.ONE,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"can-edit":e.canEdit,"can-edit-score":e.canEditScore,"is-winner":e.isWinner(e.TEAM_POSITION.ONE),"is-loser":e.isLoser(e.TEAM_POSITION.ONE),"should-highlight":e.shouldHighlight(e.TEAM_POSITION.ONE),"is-first-team":!0,"can-select-team":o.canSelectTeam,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:team":e.updateTeam,"onUpdate:score":e.updateScore,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),t.createVNode(e.TeamRow,{team:n.match.teamTwo,"team-position":e.TEAM_POSITION.TWO,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"can-edit":e.canEdit,"can-edit-score":e.canEditScore,"is-winner":e.isWinner(e.TEAM_POSITION.TWO),"is-loser":e.isLoser(e.TEAM_POSITION.TWO),"should-highlight":e.shouldHighlight(e.TEAM_POSITION.TWO),"can-select-team":o.canSelectTeam,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:team":e.updateTeam,"onUpdate:score":e.updateScore,onHighlightTeam:e.highlightTeam,onUnhighlightTeam:e.unhighlightTeam},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),n.index%2==0&&n.totalMatches>1?(t.openBlock(),t.createElementBlock("div",ue,a[0]||(a[0]=[t.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):t.createCommentVNode("v-if",!0)],2)}const fe=D(ce,[["render",ge],["__file","/app/src/components/bracket/BracketMatch.vue"]]),_e={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,default:()=>({[S.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(o,{expose:a,emit:n}){a();const e=o,r=n,l={props:e,emit:r,updateMatch:(d,f)=>{r("update:match",e.columnIndex,d,f)},onClickMatch:(d,f)=>{r("click-match",{...f,roundIndex:e.columnIndex,matchIndex:d})},BracketMatch:fe,get PERMISSIONS(){return S}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},pe={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},Te={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"};function Ee(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",pe,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.column.matches,(s,l)=>(t.openBlock(),t.createElementBlock(t.Fragment,{key:s.id},[t.createElementVNode("div",Te,t.toDisplayString(s.number),1),t.createVNode(e.BracketMatch,{match:s,index:l,"total-matches":n.column.matches.length,"round-index":n.columnIndex,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:match":d=>e.updateMatch(l,d),onHighlightTeam:a[0]||(a[0]=d=>o.$emit("highlight-team",d)),onUnhighlightTeam:a[1]||(a[1]=d=>o.$emit("unhighlight-team")),onClickMatch:d=>e.onClickMatch(l,d)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))])}const V=D(_e,[["render",Ee],["__file","/app/src/components/bracket/BracketColumn.vue"]]),ye={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(o,{expose:a,emit:n}){a();const e=o,r=n,i=[1,3,5,7,9],s=t.ref(e.columns.map(c=>c.name));t.watch(()=>e.columns,c=>{s.value=c.map(u=>u.name)},{deep:!0});const f={props:e,emit:r,bestOfValues:i,localColumnNames:s,updateColumnName:(c,u)=>{s.value[c]=u;const h=[...e.columns];h[c]={...h[c],name:u},r("update:columns",h)},updateColumnBestOf:(c,u)=>{const h=[...e.columns];h[c]={...h[c],bestOf:Number(u)},r("update:columns",h)},ref:t.ref,watch:t.watch,get PERMISSIONS(){return S}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},Se={class:"flex justify-between px-5"},be={class:"flex flex-col items-center gap-2"},ke={class:"mt-2"},we={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},Ne={class:"join"},Oe=["onUpdate:modelValue","disabled","onBlur"],Be=["value","disabled","onChange"],xe=["value"];function De(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",Se,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.columns,(s,l)=>(t.openBlock(),t.createElementBlock("div",{key:s.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[t.createElementVNode("div",be,[t.createElementVNode("div",ke,[t.createElementVNode("div",we,[t.createElementVNode("div",Ne,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":d=>e.localColumnNames[l]=d,disabled:!n.permissions[e.PERMISSIONS.CAN_EDIT_ROUND_NAME],type:"text",class:"input input-bordered join-item",onBlur:d=>e.updateColumnName(l,d.target.value)},null,40,Oe),[[t.vModelText,e.localColumnNames[l]]]),t.createElementVNode("select",{value:s.bestOf,disabled:!n.permissions[e.PERMISSIONS.CAN_EDIT_BEST_OF],class:"select select-bordered join-item",onChange:d=>e.updateColumnBestOf(l,d.target.value)},[(t.openBlock(),t.createElementBlock(t.Fragment,null,t.renderList(e.bestOfValues,d=>t.createElementVNode("option",{key:d,value:d}," Best of "+t.toDisplayString(d),9,xe)),64))],40,Be)])])])])]))),128))])}const U=D(ye,[["render",De],["__file","/app/src/components/bracket/BracketRoundHeaders.vue"]]),Ie={__name:"BracketSection",props:{title:{type:String,required:!0},columns:{type:Array,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0},bordered:{type:Boolean,default:!1},onMatchUpdate:{type:Function,required:!0},onColumnsUpdate:{type:Function,required:!0},onHighlight:{type:Function,required:!0},onUnhighlight:{type:Function,required:!0},onClickMatch:{type:Function,required:!1,default:()=>{}}},setup(o,{expose:a}){a();const e={props:o,BracketColumn:V,BracketRoundHeaders:U};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},Me={class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},Ce={class:"flex flex-col"},Ae={class:"overflow-x-auto"},Le={class:"min-w-max"},Ve={class:"flex flex-1 p-5"};function Ue(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["flex flex-col mt-8",{"border-t-2 border-gray-300 dark:border-gray-600 pt-8":n.bordered}])},[t.createElementVNode("div",Me,t.toDisplayString(n.title),1),t.createElementVNode("div",Ce,[t.createElementVNode("div",Ae,[t.createElementVNode("div",Le,[t.createVNode(e.BracketRoundHeaders,{columns:n.columns,permissions:n.permissions,"onUpdate:columns":n.onColumnsUpdate},null,8,["columns","permissions","onUpdate:columns"]),t.createElementVNode("div",Ve,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.columns,(s,l)=>(t.openBlock(),t.createBlock(e.BracketColumn,{key:s.id,column:s,"column-index":l,"available-teams":n.availableTeams,"selected-teams":n.selectedTeams,"highlighted-team":n.highlightedTeam,permissions:n.permissions,"onUpdate:match":n.onMatchUpdate,onHighlightTeam:n.onHighlight,onUnhighlightTeam:n.onUnhighlight,onClickMatch:n.onClickMatch},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onHighlightTeam","onUnhighlightTeam","onClickMatch"]))),128))])])])])],2)}const qe=D(Ie,[["render",Ue],["__file","/app/src/components/bracket/BracketSection.vue"]]),q=()=>({id:null,name:w,logo:null,score:0}),W=o=>({id:`match-${o}`,number:o,[b.ONE]:q(),[b.TWO]:q(),winner:null,date:null});function j(o,a){return Array.from({length:o},(n,e)=>a(e))}const We=(o,a=3)=>{const n=Math.log2(o);let e=1;return Array.from({length:n},(r,i)=>{const s=Math.pow(2,n-i-1),l=j(s,()=>W(e++));return{id:`upper-round-${i+1}`,name:`Round ${i+1}`,matches:l,bestOf:a}})},M=(o,a)=>{const n=o-1;let e=1;return Array.from({length:n},(r,i)=>{const s=Math.pow(2,o-i-2),l=j(s,()=>W(e++));return{id:`lower-round-${i+1}`,name:`Lower Round ${i+1}`,matches:l,bestOf:a}})},je={__name:"StandingsTable",props:{standings:{type:Array,required:!0},format:{type:String,required:!0},tournamentFormat:{type:Object,required:!0}},setup(o,{expose:a}){a();const n={};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}},Pe={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},Re={class:"relative overflow-x-auto shadow-md sm:rounded-lg mt-8"},Fe={class:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},He={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},ze={key:0,scope:"col",class:"px-6 py-3"},Je={scope:"row",class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"},Ge={class:"px-6 py-4"},ve={class:"px-6 py-4"},Ke={class:"px-6 py-4"},Ye={key:0,class:"px-6 py-4"},Qe={class:"px-6 py-4"};function Xe(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",Pe,[a[5]||(a[5]=t.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"}," Standings ",-1)),t.createElementVNode("div",Re,[t.createElementVNode("table",Fe,[t.createElementVNode("thead",He,[t.createElementVNode("tr",null,[a[0]||(a[0]=t.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Place",-1)),a[1]||(a[1]=t.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Team",-1)),a[2]||(a[2]=t.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"W-L-T",-1)),a[3]||(a[3]=t.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Points",-1)),n.format===n.tournamentFormat.SWISS?(t.openBlock(),t.createElementBlock("th",ze," Buchholz ")):t.createCommentVNode("v-if",!0),a[4]||(a[4]=t.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Pts Diff",-1))])]),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.standings,s=>(t.openBlock(),t.createElementBlock("tr",{key:s.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600"},[t.createElementVNode("th",Je,t.toDisplayString(s.place),1),t.createElementVNode("td",Ge,t.toDisplayString(s.name),1),t.createElementVNode("td",ve,t.toDisplayString(s.wins)+"-"+t.toDisplayString(s.losses)+"-"+t.toDisplayString(s.ties),1),t.createElementVNode("td",Ke,t.toDisplayString(s.score),1),n.format===n.tournamentFormat.SWISS?(t.openBlock(),t.createElementBlock("td",Ye,t.toDisplayString(s.buchholz),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("td",Qe,t.toDisplayString(s.ptsDiff),1)]))),128))])])])])}const Ze=D(je,[["render",Xe],["__file","/app/src/components/StandingsTable.vue"]]);function $e(o){const a={},n={};o.forEach(r=>{r.matches.forEach(i=>{if(["teamOne","teamTwo"].forEach(s=>{const l=i[s];l&&(a[l.id]||(a[l.id]={...l,wins:0,losses:0,ties:0,score:0,ptsDiff:0,buchholz:0}),n[l.id]||(n[l.id]=[]))}),i.teamOne&&i.teamTwo){const s=i.teamOne,l=i.teamTwo,d=s.score||0,f=l.score||0;i.winner==="teamOne"?(a[s.id].wins++,a[s.id].score+=1,a[l.id].losses++):i.winner==="teamTwo"?(a[l.id].wins++,a[l.id].score+=1,a[s.id].losses++):i.winner===null&&(d>0||f>0)&&(a[s.id].ties++,a[l.id].ties++,a[s.id].score+=.5,a[l.id].score+=.5),a[s.id].ptsDiff+=d-f,a[l.id].ptsDiff+=f-d,n[s.id].push(l.id),n[l.id].push(s.id)}else i.teamOne&&!i.teamTwo?(a[i.teamOne.id].wins++,a[i.teamOne.id].score+=1):!i.teamOne&&i.teamTwo&&(a[i.teamTwo.id].wins++,a[i.teamTwo.id].score+=1)})}),Object.values(a).forEach(r=>{r.buchholz=(n[r.id]||[]).reduce((i,s)=>{var l;return i+(((l=a[s])==null?void 0:l.score)||0)},0)});const e=Object.values(a).sort((r,i)=>i.score-r.score||i.wins-r.wins||i.buchholz-r.buchholz||i.ptsDiff-r.ptsDiff);return e.forEach((r,i)=>{r.place=i+1}),e}function A(o,a){return o.filter(n=>!!n.id&&n.name!==a)}function L(o,a,n,e,r,i){const s=a.score||0,l=n.score||0;e===r?(o[a.id].wins++,o[a.id].score+=1,o[n.id].losses++):e===i?(o[n.id].wins++,o[n.id].score+=1,o[a.id].losses++):e===null&&(s>0||l>0)&&(o[a.id].ties++,o[n.id].ties++,o[a.id].score+=.5,o[n.id].score+=.5),o[a.id].ptsDiff+=s-l,o[n.id].ptsDiff+=l-s}function P({upperColumns:o,lowerColumns:a,format:n,TOURNAMENT_FORMAT:e,TEAM_POSITION:r,TBD:i}){switch(n){case e.SWISS:return A(et(o),i);case e.ROUND_ROBIN:return A(tt(o,r),i);case e.SINGLE_ELIMINATION:case e.DOUBLE_ELIMINATION:default:return A(nt(o,a,n,e,r),i)}}function et(o){return $e(o)}function tt(o,a){const n={};for(const e of o)for(const r of e.matches){for(const l of[a.ONE,a.TWO]){const d=r[l];!d||!d.id||n[d.id]||(n[d.id]={...d,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const i=r[a.ONE],s=r[a.TWO];i&&s&&i.id&&s.id&&L(n,i,s,r.winner,a.ONE,a.TWO)}return R(n,["score","wins","ptsDiff"])}function nt(o,a,n,e,r){const i={};for(const s of o)for(const l of s.matches){for(const c of[r.ONE,r.TWO]){const u=l[c];!u||!u.id||i[u.id]||(i[u.id]={...u,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const d=l[r.ONE],f=l[r.TWO];d&&f&&d.id&&f.id&&L(i,d,f,l.winner,r.ONE,r.TWO)}if(n===e.DOUBLE_ELIMINATION&&a)for(const s of a)for(const l of s.matches){for(const c of[r.ONE,r.TWO]){const u=l[c];!u||!u.id||i[u.id]||(i[u.id]={...u,wins:0,losses:0,ties:0,score:0,ptsDiff:0})}const d=l[r.ONE],f=l[r.TWO];d&&f&&d.id&&f.id&&L(i,d,f,l.winner,r.ONE,r.TWO)}return R(i,["score","wins","ptsDiff"])}function R(o,a){const n=Object.values(o).sort((e,r)=>{for(const i of a)if(r[i]!==e[i])return r[i]-e[i];return 0});return n.forEach((e,r)=>{e.place=r+1}),n}function at(o,a=[]){const n={};o.forEach(c=>{n[c.score]||(n[c.score]=[]),n[c.score].push(c)});const e=Object.keys(n).map(Number).sort((c,u)=>u-c),r=[],i=new Set,s=o.map(c=>c.id),l=new Set(a.map(([c,u])=>`${c}-${u}`));function d(c){const u=[],h=new Set;for(let m=0;m<c.length;m++){if(h.has(c[m].id))continue;let T=!1;for(let _=m+1;_<c.length;_++)if(!h.has(c[_].id)&&!l.has(`${c[m].id}-${c[_].id}`)&&!l.has(`${c[_].id}-${c[m].id}`)){u.push([c[m],c[_]]),h.add(c[m].id),h.add(c[_].id),i.add(c[m].id),i.add(c[_].id),T=!0;break}if(!T){for(let _ of e)if(_!==c[m].score){for(let E of n[_]||[])if(!i.has(E.id)&&!l.has(`${c[m].id}-${E.id}`)&&!l.has(`${E.id}-${c[m].id}`))return u.push([c[m],E]),h.add(c[m].id),h.add(E.id),i.add(c[m].id),i.add(E.id),u}}}return u}for(let c of e){const u=n[c].filter(T=>!i.has(T.id)),h=d(u);r.push(...h);const m=u.filter(T=>!i.has(T.id));if(m.length===1){let T=!1;for(let _ of e)if(_!==c){for(let E of n[_]||[])if(!i.has(E.id)&&!l.has(`${m[0].id}-${E.id}`)&&!l.has(`${E.id}-${m[0].id}`)){r.push([m[0],E]),i.add(m[0].id),i.add(E.id),T=!0;break}if(T)break}T||(r.push([m[0],null]),i.add(m[0].id))}}const f=s.filter(c=>!i.has(c));for(let c of f){const u=o.find(h=>h.id===c);r.push([u,null])}return r}function F({upperColumns:o,lowerColumns:a,props:n,emit:e,TOURNAMENT_FORMAT:r,TEAM_POSITION:i,TBD:s}){function l(h,m,T){if(o.value[h]&&o.value[h].matches){if(o.value[h].matches[m]=T,T.winner&&h<o.value.length-1){const _=h+1,E=Math.floor(m/2);if(o.value[_]&&o.value[_].matches[E]){const N=o.value[_].matches[E],B=m%2===0?i.ONE:i.TWO,g=T[T.winner];o.value[_].matches[E]={...N,[B]:{id:g.id,name:g.name,logo:g.logo,score:0}}}}if(n.format===r.DOUBLE_ELIMINATION&&T.winner){const _=T[T.winner===i.ONE?i.TWO:i.ONE];if(_.name!==s){const E=Math.floor(h/2),N=Math.floor(m/2);if(a.value[E]&&a.value[E].matches[N]){const B=a.value[E].matches[N],g=m%2===0?i.ONE:i.TWO;a.value[E].matches[N]={...B,[g]:{id:_.id,name:_.name,logo:_.logo,score:0}}}}}c()}if(n.format===r.SWISS&&o.value[h].matches.every(N=>N.winner)&&h<o.value.length-1){const N={};for(let y=0;y<=h;y++)o.value[y].matches.forEach(k=>{["teamOne","teamTwo"].forEach(ct=>{const C=k[ct];C&&(N[C.id]||(N[C.id]={...C,score:0}))}),k.winner&&k.teamOne&&k.teamTwo&&(k.winner==="teamOne"&&(N[k.teamOne.id].score+=1),k.winner==="teamTwo"&&(N[k.teamTwo.id].score+=1))});const B=[];for(let y=0;y<=h;y++)o.value[y].matches.forEach(k=>{k.teamOne&&k.teamTwo&&B.push([k.teamOne.id,k.teamTwo.id])});const g=Object.values(N),p=at(g,B),O=o.value[h+1];O.matches=p.map((y,k)=>({id:`swiss-match-${h+2}-${k+1}`,number:k+1,teamOne:y[0],teamTwo:y[1],winner:null,date:null}))}}function d(h){o.value=h,c()}function f(h){a.value=h,c()}function c(){e("update:state",{upper:o.value,lower:n.format===r.DOUBLE_ELIMINATION?a.value:null})}function u(){if(n.initialState){if(Array.isArray(n.initialState)){if(o.value=JSON.parse(JSON.stringify(n.initialState)),n.format===r.DOUBLE_ELIMINATION){a.value=M(o.value.length,n.defaultBestOf);return}if(n.format===r.SWISS){a.value=[];return}return}o.value=JSON.parse(JSON.stringify(n.initialState.upper||[])),a.value=JSON.parse(JSON.stringify(n.initialState.lower||[]))}}return{updateUpperMatch:l,updateUpperColumns:d,updateLowerState:f,emitTournamentState:c,initializeTournament:u}}class it{async getTournament(a){throw new Error("Not implemented")}async saveTournament(a){throw new Error("Not implemented")}async updateMatch(a,n,e){throw new Error("Not implemented")}async listTournaments(){throw new Error("Not implemented")}async deleteTournament(a){throw new Error("Not implemented")}}const H="tournaments";class z extends it{_getAll(){return JSON.parse(localStorage.getItem(H)||"{}")}_setAll(a){localStorage.setItem(H,JSON.stringify(a))}async getTournament(a){return this._getAll()[a]||null}async saveTournament(a){const n=this._getAll();n[a.id]=a,this._setAll(n)}async updateMatch(a,n,e){const r=this._getAll(),i=r[a];if(!i)throw new Error("Tournament not found");let s=!1;for(const l of i.rounds)for(let d=0;d<l.matches.length;d++)l.matches[d].id===n&&(l.matches[d]={...l.matches[d],...e},s=!0);if(!s)throw new Error("Match not found");r[a]=i,this._setAll(r)}async listTournaments(){const a=this._getAll();return Object.values(a).map(n=>({id:n.id,name:n.name}))}async deleteTournament(a){const n=this._getAll();delete n[a],this._setAll(n)}}const ot={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,default:()=>({[S.CAN_SELECT_TEAM]:!0,[S.CAN_EDIT_ROUND_NAME]:!0,[S.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(o,{expose:a,emit:n}){a();const e=n,r=o,i=t.ref([]),s=t.ref([]),l=t.ref(null),d=t.computed(()=>{const p=new Set;return i.value.forEach(O=>{O.matches.forEach(y=>{y[b.ONE].name!==w&&p.add(y[b.ONE].name),y[b.TWO].name!==w&&p.add(y[b.TWO].name)})}),r.format===I.DOUBLE_ELIMINATION&&s.value.forEach(O=>{O.matches.forEach(y=>{y[b.ONE].name!==w&&p.add(y[b.ONE].name),y[b.TWO].name!==w&&p.add(y[b.TWO].name)})}),Array.from(p)}),f=t.computed(()=>P({upperColumns:i.value,lowerColumns:s.value,format:r.format,TOURNAMENT_FORMAT:I,TEAM_POSITION:b,TBD:w})),c=p=>{l.value=p},u=()=>{l.value=null},h=p=>{e("click-match",p)},m=new z,{updateUpperMatch:T,updateUpperColumns:_,updateLowerState:E,emitTournamentState:N,initializeTournament:B}=F({upperColumns:i,lowerColumns:s,props:r,emit:e,TOURNAMENT_FORMAT:I,TEAM_POSITION:b,TBD:w});t.watch(()=>r.initialState,()=>{B()},{deep:!0}),t.watch(()=>r.format,p=>{p===I.DOUBLE_ELIMINATION&&(!s.value||s.value.length===0)&&(s.value=M(i.value.length,r.defaultBestOf),N())}),t.onMounted(()=>{B()});const g={emit:e,props:r,upperColumns:i,lowerColumns:s,highlightedTeam:l,selectedTeams:d,standingsData:f,highlightTeam:c,unhighlightTeam:u,onMatchClick:h,storage:m,updateUpperMatch:T,updateUpperColumns:_,updateLowerState:E,emitTournamentState:N,initializeTournament:B,ref:t.ref,onMounted:t.onMounted,watch:t.watch,computed:t.computed,BracketColumn:V,BracketRoundHeaders:U,BracketSection:qe,get createLowerBracketStructure(){return M},get TOURNAMENT_FORMAT(){return I},get TBD(){return w},get TEAM_POSITION(){return b},get PERMISSIONS(){return S},StandingsTable:Ze,get useStandings(){return P},get useBracket(){return F},get LocalStorageTournament(){return z}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},rt={class:"flex flex-col"};function st(o,a,n,e,r,i){return t.openBlock(),t.createElementBlock("div",rt,[t.createVNode(e.BracketSection,{title:"Upper Bracket",columns:e.upperColumns,"available-teams":n.availableTeams,"selected-teams":e.selectedTeams,"highlighted-team":e.highlightedTeam,permissions:n.permissions,"on-match-update":e.updateUpperMatch,"on-columns-update":e.updateUpperColumns,"on-highlight":e.highlightTeam,"on-unhighlight":e.unhighlightTeam,"on-click-match":e.onMatchClick},null,8,["columns","available-teams","selected-teams","highlighted-team","permissions","on-match-update","on-columns-update"]),n.format===e.TOURNAMENT_FORMAT.DOUBLE_ELIMINATION?(t.openBlock(),t.createBlock(e.BracketSection,{key:0,title:"Lower Bracket",columns:e.lowerColumns,"available-teams":n.availableTeams,"selected-teams":e.selectedTeams,"highlighted-team":e.highlightedTeam,permissions:n.permissions,bordered:"","on-match-update":e.updateLowerState,"on-columns-update":e.updateLowerState,"on-highlight":e.highlightTeam,"on-unhighlight":e.unhighlightTeam},null,8,["columns","available-teams","selected-teams","highlighted-team","permissions","on-match-update","on-columns-update"])):t.createCommentVNode("v-if",!0),t.createVNode(e.StandingsTable,{standings:e.standingsData,format:n.format,"tournament-format":e.TOURNAMENT_FORMAT},null,8,["standings","format","tournament-format"])])}const J=D(ot,[["render",st],["__file","/app/src/components/TournamentBracket.vue"]]),lt=o=>{o.component("TournamentBracket",J)};x.PERMISSIONS=S,x.TournamentBracket=J,x.createLowerBracketStructure=M,x.createTournamentState=We,x.install=lt,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
