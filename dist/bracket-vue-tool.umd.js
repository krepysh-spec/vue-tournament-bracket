(function(M,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(M=typeof globalThis<"u"?globalThis:M||self,e(M.BracketVueTool={},M.Vue))})(this,function(M,e){"use strict";const D={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination",SWISS:"swiss",ROUND_ROBIN:"round_robin"},C="TBD",r={ONE:"teamOne",TWO:"teamTwo"},k={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},z={key:0,class:"flex items-center gap-2"},H=["src","alt"],v=["value","disabled"],J={key:1,class:"flex items-center gap-2"},G=["src","alt"],K={class:"text-gray-900 dark:text-white"},Q={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:u}){const a=t,o=u,i=e.ref(a.team.name),n=e.computed(()=>{var m;return i.value===C?null:((m=a.availableTeams.find(O=>O.name===i.value))==null?void 0:m.logo)||null});e.watch(()=>a.team,m=>{i.value=m.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const p=m=>m===C?!1:a.selectedTeams.includes(m)&&m!==a.team.name||m===a.team.name&&a.team.name!==C,c=e.computed(()=>a.availableTeams?a.availableTeams.filter(m=>m.name===C||m.name===a.team.name?!0:!p(m.name)):[]),E=()=>{a.team.name!==C&&o("highlight-team",a.team.name)},b=()=>{o("unhighlight-team")},l=()=>{const m=a.availableTeams.find(O=>O.name===i.value);console.log("Updating team:",{selectedTeam:i.value,selectedTeamData:m}),o("update:team",{position:a.teamPosition,team:{id:(m==null?void 0:m.id)||null,name:i.value,logo:(m==null?void 0:m.logo)||null,score:0}})};return(m,O)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":t.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":t.isLoser,"bg-green-500/20 dark:bg-green-500/20":t.shouldHighlight&&t.isWinner,"bg-red-500/20 dark:bg-red-500/20":t.shouldHighlight&&t.isLoser}]),onMouseenter:E,onMouseleave:b},[t.canEdit&&t.permissions[e.unref(k).CAN_SELECT_TEAM]?(e.openBlock(),e.createElementBlock("div",z,[n.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:n.value,alt:i.value,class:"w-6 h-6 rounded-full"},null,8,H)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":O[0]||(O[0]=d=>i.value=d),class:"select select-ghost w-full select-xs",onChange:l},[O[1]||(O[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,d=>(e.openBlock(),e.createElementBlock("option",{key:d.id,value:d.name,disabled:p(d.name)},e.toDisplayString(d.name),9,v))),128))],544),[[e.vModelSelect,i.value]])])):(e.openBlock(),e.createElementBlock("div",J,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,G)):e.createCommentVNode("",!0),e.createElementVNode("span",K,e.toDisplayString(t.team.name),1)]))],34))}},X={key:1,class:"text-white"},Y={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:u}){const a=t,o=u,i=e.ref(!1),n=e.ref(a.team.score??0),p=()=>{a.canEditScore&&(i.value=!0)},c=()=>{const E=parseInt(n.value)||0;o("update:score",{position:a.teamPosition,score:E})};return e.watch(()=>a.team,E=>{n.value=E.score??0},{deep:!0}),(E,b)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:p},[i.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":b[0]||(b[0]=l=>n.value=l),class:"input input-xs",required:"",min:"0",onChange:c,onBlur:b[1]||(b[1]=l=>i.value=!1)},null,544)),[[e.vModelText,n.value]]):(e.openBlock(),e.createElementBlock("span",X,e.toDisplayString(t.team.score),1))],2))}},Z={class:"flex"},W={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0,[k.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(u,a)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createVNode(Q,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"is-first-team":t.isFirstTeam,"onUpdate:team":a[0]||(a[0]=o=>u.$emit("update:team",o)),onHighlightTeam:a[1]||(a[1]=o=>u.$emit("highlight-team",o)),onUnhighlightTeam:a[2]||(a[2]=o=>u.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),e.createVNode(Y,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=o=>u.$emit("update:score",o))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},ee={class:"flex flex-col w-full"},te={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},ae=["value","disabled"],ne={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+10px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"},ie={__name:"BracketMatch",props:{match:{type:Object,required:!0,default:()=>({teamOne:{name:C,score:0},teamTwo:{name:C,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0,[k.CAN_EDIT_DATE]:!0,[k.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:u}){const a=t,o=u,i=e.computed(()=>a.roundIndex===0&&a.permissions[k.CAN_SELECT_TEAM]),n=e.computed(()=>a.match[r.ONE].name!==C&&a.match[r.TWO].name!==C&&a.permissions[k.CAN_EDIT_SCOPE]),p=h=>a.match.winner===h,c=h=>a.match.winner&&a.match.winner!==h,E=h=>{const S=a.match[h].name;return a.highlightedTeam===S},b=h=>{o("highlight-team",h)},l=()=>{o("unhighlight-team")},m=({position:h,team:S})=>{const I={...a.match,[h]:S};o("update:match",I)},O=({position:h,score:S})=>{const I={...a.match,[h]:{...a.match[h],score:S}};I[r.ONE].score>I[r.TWO].score?I.winner=r.ONE:I[r.TWO].score>I[r.ONE].score?I.winner=r.TWO:I.winner=null,o("update:match",I)},d=h=>h?new Date(h).toISOString().slice(0,16):"",B=h=>{const S={...a.match,date:h.target.value};o("update:match",S)},w=h=>{const S=h.target.tagName.toLowerCase();S==="input"||S==="select"||S==="option"||S==="button"||h.target.closest("input,select,option,button")||!(!a.permissions[k.CAN_SELECT_TEAM]&&!a.permissions[k.CAN_EDIT_DATE]&&!a.permissions[k.CAN_EDIT_SCOPE])||o("click-match",{match:a.match,roundIndex:a.roundIndex,matchIndex:a.index,id:a.match.id??null})};return(h,S)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",ee,[e.createElementVNode("div",te,[e.createElementVNode("input",{type:"datetime-local",value:d(t.match.date),onInput:B,class:"input input-ghost input-sm",disabled:!t.permissions[e.unref(k).CAN_EDIT_DATE]},null,40,ae)]),e.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:w},[e.createVNode(W,{team:t.match.teamOne,"team-position":e.unref(r).ONE,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":i.value,"can-edit-score":n.value,"is-winner":p(e.unref(r).ONE),"is-loser":c(e.unref(r).ONE),"should-highlight":E(e.unref(r).ONE),"is-first-team":!0,"can-select-team":h.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":m,"onUpdate:score":O,onHighlightTeam:b,onUnhighlightTeam:l},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),e.createVNode(W,{team:t.match.teamTwo,"team-position":e.unref(r).TWO,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":i.value,"can-edit-score":n.value,"is-winner":p(e.unref(r).TWO),"is-loser":c(e.unref(r).TWO),"should-highlight":E(e.unref(r).TWO),"can-select-team":h.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":m,"onUpdate:score":O,onHighlightTeam:b,onUnhighlightTeam:l},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",ne,S[0]||(S[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},se={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},oe={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"},q={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:u}){const a=t,o=u,i=(p,c)=>{o("update:match",a.columnIndex,p,c)},n=(p,c)=>{o("click-match",{...c,roundIndex:a.columnIndex,matchIndex:p})};return(p,c)=>(e.openBlock(),e.createElementBlock("div",se,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.matches,(E,b)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:E.id},[e.createElementVNode("div",oe,e.toDisplayString(E.number),1),e.createVNode(ie,{match:E,index:b,"total-matches":t.column.matches.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:match":l=>i(b,l),onHighlightTeam:c[0]||(c[0]=l=>p.$emit("highlight-team",l)),onUnhighlightTeam:c[1]||(c[1]=l=>p.$emit("unhighlight-team")),onClickMatch:l=>n(b,l)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))]))}},le={class:"flex justify-between px-5"},re={class:"flex flex-col items-center gap-2"},ce={class:"mt-2"},de={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},me={class:"join"},ue=["onBlur","disabled","onUpdate:modelValue"],he=["value","onChange","disabled"],fe=["value"],R={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(t,{emit:u}){const a=t,o=u,i=[1,3,5,7,9],n=e.ref(a.columns.map(E=>E.name));e.watch(()=>a.columns,E=>{n.value=E.map(b=>b.name)},{deep:!0});const p=(E,b)=>{n.value[E]=b;const l=[...a.columns];l[E]={...l[E],name:b},o("update:columns",l)},c=(E,b)=>{const l=[...a.columns];l[E]={...l[E],bestOf:Number(b)},o("update:columns",l)};return(E,b)=>(e.openBlock(),e.createElementBlock("div",le,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:l.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[e.createElementVNode("div",re,[e.createElementVNode("div",ce,[e.createElementVNode("div",de,[e.createElementVNode("div",me,[e.withDirectives(e.createElementVNode("input",{onBlur:O=>p(m,O.target.value),disabled:!t.permissions[e.unref(k).CAN_EDIT_ROUND_NAME],"onUpdate:modelValue":O=>n.value[m]=O,type:"text",class:"input input-bordered join-item"},null,40,ue),[[e.vModelText,n.value[m]]]),e.createElementVNode("select",{value:l.bestOf,onChange:O=>c(m,O.target.value),disabled:!t.permissions[e.unref(k).CAN_EDIT_BEST_OF],class:"select select-bordered join-item"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(i,O=>e.createElementVNode("option",{key:O,value:O}," Best of "+e.toDisplayString(O),9,fe)),64))],40,he)])])])])]))),128))]))}},ge={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},pe={class:"flex flex-col"},Ee={class:"overflow-x-auto"},Te={class:"min-w-max"},Ne={class:"flex flex-1 p-5"},Oe={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0,[k.CAN_EDIT_DATE]:!0,[k.CAN_EDIT_SCOPE]:!0,[k.CAN_EDIT_ROUND_NAME]:!0,[k.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state"],setup(t,{emit:u}){const a=u,o=t,i=e.ref([]),n=e.ref(null),p=e.computed(()=>{const d=new Set;return i.value.forEach(B=>{B.matches.forEach(w=>{w[r.ONE].name!==C&&d.add(w[r.ONE].name),w[r.TWO].name!==C&&d.add(w[r.TWO].name)})}),Array.from(d)}),c=d=>{n.value=d},E=()=>{n.value=null},b=(d,B,w)=>{if(console.log("Updating lower match:",{roundIndex:d,matchIndex:B,updatedMatch:w}),i.value[d]&&i.value[d].matches){if(i.value[d].matches[B]=w,w.winner&&d<i.value.length-1){const h=d+1,S=Math.floor(B/2);if(i.value[h]&&i.value[h].matches[S]){const I=i.value[h].matches[S],L=B%2===0?r.ONE:r.TWO,s=w[w.winner];i.value[h].matches[S]={...I,[L]:{id:s.id,name:s.name,logo:s.logo,score:0}}}}m()}},l=d=>{console.log("Updating lower columns:",d),i.value=d,m()},m=()=>{console.log("Emitting lower tournament state:",i.value),a("update:state",i.value)},O=()=>{console.log("Initializing lower tournament with state:",o.initialState),o.initialState&&o.initialState.length>0&&(i.value=JSON.parse(JSON.stringify(o.initialState)))};return e.watch(()=>o.initialState,()=>{O()},{deep:!0}),e.onMounted(()=>{O()}),(d,B)=>(e.openBlock(),e.createElementBlock("div",ge,[B[0]||(B[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Lower Bracket",-1)),e.createElementVNode("div",pe,[e.createElementVNode("div",Ee,[e.createElementVNode("div",Te,[e.createVNode(R,{columns:i.value,"onUpdate:columns":l,permissions:t.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",Ne,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(w,h)=>(e.openBlock(),e.createBlock(q,{key:w.id,column:w,"column-index":h,"available-teams":t.availableTeams,"selected-teams":p.value,"highlighted-team":n.value,permissions:t.permissions,"onUpdate:match":b,onHighlightTeam:c,onUnhighlightTeam:E},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])])]))}},P=()=>({id:null,name:C,logo:null,score:0}),j=t=>({id:`match-${t}`,number:t,[r.ONE]:P(),[r.TWO]:P(),winner:null,date:null}),ye=(t,u=3)=>{const a=[],o=Math.log2(t);let i=1;for(let n=0;n<o;n++){const p=Math.pow(2,o-n-1),c=[];for(let E=0;E<p;E++)c.push(j(i++));a.push({id:`upper-round-${n+1}`,name:`Round ${n+1}`,matches:c,bestOf:u})}return a},U=(t,u)=>{const a=[];let o=1;const i=t-1;for(let n=0;n<i;n++){const p=Math.pow(2,t-n-2),c=[];for(let E=0;E<p;E++)c.push(j(o++));a.push({id:`lower-round-${n+1}`,name:`Lower Round ${n+1}`,matches:c,bestOf:u})}return a};function we(t,u=[]){const a={};t.forEach(l=>{a[l.score]||(a[l.score]=[]),a[l.score].push(l)});const o=Object.keys(a).map(Number).sort((l,m)=>m-l),i=[],n=new Set,p=t.map(l=>l.id),c=new Set(u.map(([l,m])=>`${l}-${m}`));function E(l){const m=[],O=new Set;for(let d=0;d<l.length;d++){if(O.has(l[d].id))continue;let B=!1;for(let w=d+1;w<l.length;w++)if(!O.has(l[w].id)&&!c.has(`${l[d].id}-${l[w].id}`)&&!c.has(`${l[w].id}-${l[d].id}`)){m.push([l[d],l[w]]),O.add(l[d].id),O.add(l[w].id),n.add(l[d].id),n.add(l[w].id),B=!0;break}if(!B){for(let w of o)if(w!==l[d].score){for(let h of a[w]||[])if(!n.has(h.id)&&!c.has(`${l[d].id}-${h.id}`)&&!c.has(`${h.id}-${l[d].id}`))return m.push([l[d],h]),O.add(l[d].id),O.add(h.id),n.add(l[d].id),n.add(h.id),m}}}return m}for(let l of o){const m=a[l].filter(B=>!n.has(B.id)),O=E(m);i.push(...O);const d=m.filter(B=>!n.has(B.id));if(d.length===1){let B=!1;for(let w of o)if(w!==l){for(let h of a[w]||[])if(!n.has(h.id)&&!c.has(`${d[0].id}-${h.id}`)&&!c.has(`${h.id}-${d[0].id}`)){i.push([d[0],h]),n.add(d[0].id),n.add(h.id),B=!0;break}if(B)break}B||(i.push([d[0],null]),n.add(d[0].id))}}const b=p.filter(l=>!n.has(l));for(let l of b){const m=t.find(O=>O.id===l);i.push([m,null])}return i}function be(t){const u={},a={};t.forEach(i=>{i.matches.forEach(n=>{if(["teamOne","teamTwo"].forEach(p=>{const c=n[p];c&&(u[c.id]||(u[c.id]={...c,wins:0,losses:0,ties:0,score:0,ptsDiff:0,buchholz:0}),a[c.id]||(a[c.id]=[]))}),n.teamOne&&n.teamTwo){const p=n.teamOne,c=n.teamTwo,E=p.score||0,b=c.score||0;n.winner==="teamOne"?(u[p.id].wins++,u[p.id].score+=1,u[c.id].losses++):n.winner==="teamTwo"?(u[c.id].wins++,u[c.id].score+=1,u[p.id].losses++):n.winner===null&&(E>0||b>0)&&(u[p.id].ties++,u[c.id].ties++,u[p.id].score+=.5,u[c.id].score+=.5),u[p.id].ptsDiff+=E-b,u[c.id].ptsDiff+=b-E,a[p.id].push(c.id),a[c.id].push(p.id)}else n.teamOne&&!n.teamTwo?(u[n.teamOne.id].wins++,u[n.teamOne.id].score+=1):!n.teamOne&&n.teamTwo&&(u[n.teamTwo.id].wins++,u[n.teamTwo.id].score+=1)})}),Object.values(u).forEach(i=>{i.buchholz=(a[i.id]||[]).reduce((n,p)=>{var c;return n+(((c=u[p])==null?void 0:c.score)||0)},0)});const o=Object.values(u).sort((i,n)=>n.score-i.score||n.wins-i.wins||n.buchholz-i.buchholz||n.ptsDiff-i.ptsDiff);return o.forEach((i,n)=>{i.place=n+1}),o}const ke={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},Se={class:"relative overflow-x-auto shadow-md sm:rounded-lg mt-8"},Be={class:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},xe={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},Ae={key:0,scope:"col",class:"px-6 py-3"},De={scope:"row",class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"},Ce={class:"px-6 py-4"},Ie={class:"px-6 py-4"},$e={class:"px-6 py-4"},Me={key:0,class:"px-6 py-4"},Ve={class:"px-6 py-4"},_e={__name:"StandingsTable",props:{standings:{type:Array,required:!0},format:{type:String,required:!0},TOURNAMENT_FORMAT:{type:Object,required:!0}},setup(t){return(u,a)=>(e.openBlock(),e.createElementBlock("div",ke,[a[5]||(a[5]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Standings",-1)),e.createElementVNode("div",Se,[e.createElementVNode("table",Be,[e.createElementVNode("thead",xe,[e.createElementVNode("tr",null,[a[0]||(a[0]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Place",-1)),a[1]||(a[1]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Team",-1)),a[2]||(a[2]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"W-L-T",-1)),a[3]||(a[3]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Points",-1)),t.format===t.TOURNAMENT_FORMAT.SWISS?(e.openBlock(),e.createElementBlock("th",Ae,"Buchholz")):e.createCommentVNode("",!0),a[4]||(a[4]=e.createElementVNode("th",{scope:"col",class:"px-6 py-3"},"Pts Diff",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.standings,o=>(e.openBlock(),e.createElementBlock("tr",{key:o.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600"},[e.createElementVNode("th",De,e.toDisplayString(o.place),1),e.createElementVNode("td",Ce,e.toDisplayString(o.name),1),e.createElementVNode("td",Ie,e.toDisplayString(o.wins)+"-"+e.toDisplayString(o.losses)+"-"+e.toDisplayString(o.ties),1),e.createElementVNode("td",$e,e.toDisplayString(o.score),1),t.format===t.TOURNAMENT_FORMAT.SWISS?(e.openBlock(),e.createElementBlock("td",Me,e.toDisplayString(o.buchholz),1)):e.createCommentVNode("",!0),e.createElementVNode("td",Ve,e.toDisplayString(o.ptsDiff),1)]))),128))])])])]))}},Ue={class:"flex flex-col"},Le={class:"flex flex-col"},We={class:"overflow-x-auto"},qe={class:"min-w-max"},Re={class:"flex flex-1 p-5"},F={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,required:!0,default:()=>({[k.CAN_SELECT_TEAM]:!0,[k.CAN_EDIT_ROUND_NAME]:!0,[k.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(t,{emit:u}){const a=u,o=t,i=e.ref([]),n=e.ref([]),p=e.ref(null),c=e.computed(()=>{const s=new Set;return i.value.forEach(A=>{A.matches.forEach(T=>{T[r.ONE].name!==C&&s.add(T[r.ONE].name),T[r.TWO].name!==C&&s.add(T[r.TWO].name)})}),o.format===D.DOUBLE_ELIMINATION&&n.value.forEach(A=>{A.matches.forEach(T=>{T[r.ONE].name!==C&&s.add(T[r.ONE].name),T[r.TWO].name!==C&&s.add(T[r.TWO].name)})}),Array.from(s)}),E=e.computed(()=>o.format!==D.SWISS?[]:be(i.value)),b=e.computed(()=>{if(o.format!==D.ROUND_ROBIN)return[];const s={};i.value.forEach(T=>{T.matches.forEach(f=>{[r.ONE,r.TWO].forEach(x=>{const y=f[x];!y||!y.id||s[y.id]||(s[y.id]={...y,wins:0,losses:0,ties:0,score:0,ptsDiff:0})});const N=f[r.ONE],g=f[r.TWO];if(N&&g&&N.id&&g.id){const x=N.score||0,y=g.score||0;f.winner===r.ONE?(s[N.id].wins++,s[N.id].score+=1,s[g.id].losses++):f.winner===r.TWO?(s[g.id].wins++,s[g.id].score+=1,s[N.id].losses++):f.winner===null&&(x>0||y>0)&&(s[N.id].ties++,s[g.id].ties++,s[N.id].score+=.5,s[g.id].score+=.5),s[N.id].ptsDiff+=x-y,s[g.id].ptsDiff+=y-x}})});const A=Object.values(s).sort((T,f)=>f.score-T.score||f.wins-T.wins||f.ptsDiff-T.ptsDiff);return A.forEach((T,f)=>{T.place=f+1}),A}),l=e.computed(()=>{if(o.format===D.SWISS||o.format===D.ROUND_ROBIN)return[];const s={};i.value.forEach(T=>{T.matches.forEach(f=>{[r.ONE,r.TWO].forEach(x=>{const y=f[x];!y||!y.id||s[y.id]||(s[y.id]={...y,wins:0,losses:0,ties:0,score:0,ptsDiff:0})});const N=f[r.ONE],g=f[r.TWO];if(N&&g&&N.id&&g.id){const x=N.score||0,y=g.score||0;f.winner===r.ONE?(s[N.id].wins++,s[N.id].score+=1,s[g.id].losses++):f.winner===r.TWO?(s[g.id].wins++,s[g.id].score+=1,s[N.id].losses++):f.winner===null&&(x>0||y>0)&&(s[N.id].ties++,s[g.id].ties++,s[N.id].score+=.5,s[g.id].score+=.5),s[N.id].ptsDiff+=x-y,s[g.id].ptsDiff+=y-x}})}),o.format===D.DOUBLE_ELIMINATION&&n.value&&n.value.forEach(T=>{T.matches.forEach(f=>{[r.ONE,r.TWO].forEach(x=>{const y=f[x];!y||!y.id||s[y.id]||(s[y.id]={...y,wins:0,losses:0,ties:0,score:0,ptsDiff:0})});const N=f[r.ONE],g=f[r.TWO];if(N&&g&&N.id&&g.id){const x=N.score||0,y=g.score||0;f.winner===r.ONE?(s[N.id].wins++,s[N.id].score+=1,s[g.id].losses++):f.winner===r.TWO?(s[g.id].wins++,s[g.id].score+=1,s[N.id].losses++):f.winner===null&&(x>0||y>0)&&(s[N.id].ties++,s[g.id].ties++,s[N.id].score+=.5,s[g.id].score+=.5),s[N.id].ptsDiff+=x-y,s[g.id].ptsDiff+=y-x}})});const A=Object.values(s).sort((T,f)=>f.score-T.score||f.wins-T.wins||f.ptsDiff-T.ptsDiff);return A.forEach((T,f)=>{T.place=f+1}),A}),m=e.computed(()=>o.format===D.SWISS?E.value:o.format===D.ROUND_ROBIN?b.value:l.value),O=s=>{p.value=s},d=()=>{p.value=null},B=(s,A,T)=>{if(console.log("Updating upper match:",{roundIndex:s,matchIndex:A,updatedMatch:T}),i.value[s]&&i.value[s].matches){if(i.value[s].matches[A]=T,T.winner&&s<i.value.length-1){const f=s+1,N=Math.floor(A/2);if(i.value[f]&&i.value[f].matches[N]){const g=i.value[f].matches[N],x=A%2===0?r.ONE:r.TWO,y=T[T.winner];i.value[f].matches[N]={...g,[x]:{id:y.id,name:y.name,logo:y.logo,score:0}}}}if(o.format===D.DOUBLE_ELIMINATION&&T.winner){const f=T[T.winner===r.ONE?r.TWO:r.ONE];if(f.name!==C){const N=Math.floor(s/2),g=Math.floor(A/2);if(n.value[N]&&n.value[N].matches[g]){const x=n.value[N].matches[g],y=A%2===0?r.ONE:r.TWO;n.value[N].matches[g]={...x,[y]:{id:f.id,name:f.name,logo:f.logo,score:0}}}}}S()}if(o.format===D.SWISS&&i.value[s].matches.every(g=>g.winner)&&s<i.value.length-1){const g={};for(let V=0;V<=s;V++)i.value[V].matches.forEach($=>{["teamOne","teamTwo"].forEach(ze=>{const _=$[ze];_&&(g[_.id]||(g[_.id]={..._,score:0}))}),$.winner&&$.teamOne&&$.teamTwo&&($.winner==="teamOne"&&(g[$.teamOne.id].score+=1),$.winner==="teamTwo"&&(g[$.teamTwo.id].score+=1))});const x=[];for(let V=0;V<=s;V++)i.value[V].matches.forEach($=>{$.teamOne&&$.teamTwo&&x.push([$.teamOne.id,$.teamTwo.id])});const y=Object.values(g),je=we(y,x),Fe=i.value[s+1];Fe.matches=je.map((V,$)=>({id:`swiss-match-${s+2}-${$+1}`,number:$+1,teamOne:V[0],teamTwo:V[1],winner:null,date:null}))}},w=s=>{console.log("Updating upper columns:",s),i.value=s,S()},h=s=>{console.log("Updating lower state:",s),n.value=s,S()},S=()=>{console.log("Emitting tournament state:",{upper:i.value,lower:o.format===D.DOUBLE_ELIMINATION?n.value:null}),a("update:state",{upper:i.value,lower:o.format===D.DOUBLE_ELIMINATION?n.value:null})},I=()=>{console.log("Initializing tournament with state:",o.initialState),o.initialState&&(Array.isArray(o.initialState)?(i.value=JSON.parse(JSON.stringify(o.initialState)),o.format===D.DOUBLE_ELIMINATION?n.value=U(i.value.length,o.defaultBestOf):o.format===D.SWISS&&(n.value=[])):(i.value=JSON.parse(JSON.stringify(o.initialState.upper||[])),n.value=JSON.parse(JSON.stringify(o.initialState.lower||[]))))};e.watch(()=>o.initialState,()=>{I()},{deep:!0}),e.watch(()=>o.format,s=>{s===D.DOUBLE_ELIMINATION&&(!n.value||n.value.length===0)&&(n.value=U(i.value.length,o.defaultBestOf),S())});const L=s=>{a("click-match",s)};return e.onMounted(()=>{I()}),(s,A)=>(e.openBlock(),e.createElementBlock("div",Ue,[A[0]||(A[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Upper Bracket",-1)),e.createElementVNode("div",Le,[e.createElementVNode("div",We,[e.createElementVNode("div",qe,[e.createVNode(R,{columns:i.value,"onUpdate:columns":w,permissions:t.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",Re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(T,f)=>(e.openBlock(),e.createBlock(q,{key:T.id,column:T,"column-index":f,"available-teams":t.availableTeams,"selected-teams":c.value,"highlighted-team":p.value,permissions:t.permissions,"onUpdate:match":B,onHighlightTeam:O,onUnhighlightTeam:d,onClickMatch:L},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])]),t.format===e.unref(D).DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(Oe,{key:0,"initial-state":n.value,"available-teams":t.availableTeams,"default-best-of":t.defaultBestOf,permissions:t.permissions,"onUpdate:state":h},null,8,["initial-state","available-teams","default-best-of","permissions"])):e.createCommentVNode("",!0),e.createVNode(_e,{standings:m.value,format:t.format,TOURNAMENT_FORMAT:e.unref(D)},null,8,["standings","format","TOURNAMENT_FORMAT"])]))}},Pe=t=>{t.component("TournamentBracket",F)};M.PERMISSIONS=k,M.TournamentBracket=F,M.createLowerBracketStructure=U,M.createTournamentState=ye,M.install=Pe,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"})});
