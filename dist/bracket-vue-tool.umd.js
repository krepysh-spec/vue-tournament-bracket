(function(x,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(x=typeof globalThis<"u"?globalThis:x||self,e(x.BracketVueTool={},x.Vue))})(this,function(x,e){"use strict";const B={SINGLE_ELIMINATION:"single_elimination",DOUBLE_ELIMINATION:"double_elimination"},y="TBD",s={ONE:"teamOne",TWO:"teamTwo"},T={CAN_SELECT_TEAM:"can_select_team",CAN_EDIT_DATE:"can_edit_date",CAN_EDIT_SCOPE:"can_edit_scope",CAN_EDIT_ROUND_NAME:"can_edit_round_name",CAN_EDIT_BEST_OF:"can_edit_best_of"},V={key:0,class:"flex items-center gap-2"},q=["src","alt"],v=["value","disabled"],W={key:1,class:"flex items-center gap-2"},P=["src","alt"],F={class:"text-gray-900 dark:text-white"},j={__name:"TeamSelect",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0})},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1}},emits:["update:team","highlight-team","unhighlight-team"],setup(t,{emit:b}){const a=t,i=b,n=e.ref(a.team.name),o=e.computed(()=>{var c;return n.value===y?null:((c=a.availableTeams.find(p=>p.name===n.value))==null?void 0:c.logo)||null});e.watch(()=>a.team,c=>{n.value=c.name},{immediate:!0}),e.onMounted(()=>{console.log("TeamSelect mounted:",{team:a.team,availableTeams:a.availableTeams})});const f=c=>c===y?!1:a.selectedTeams.includes(c)&&c!==a.team.name||c===a.team.name&&a.team.name!==y,g=e.computed(()=>a.availableTeams?a.availableTeams.filter(c=>c.name===y||c.name===a.team.name?!0:!f(c.name)):[]),r=()=>{a.team.name!==y&&i("highlight-team",a.team.name)},E=()=>{i("unhighlight-team")},h=()=>{const c=a.availableTeams.find(p=>p.name===n.value);console.log("Updating team:",{selectedTeam:n.value,selectedTeamData:c}),i("update:team",{position:a.teamPosition,team:{id:(c==null?void 0:c.id)||null,name:n.value,logo:(c==null?void 0:c.logo)||null,score:0}})};return(c,p)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex-grow p-2.5 hover:bg-gray-200/30 dark:hover:bg-gray-950/20",{"hover:bg-green-500/20 dark:hover:bg-green-500/20":t.isWinner,"hover:bg-red-500/20 dark:hover:bg-red-500/20":t.isLoser,"bg-green-500/20 dark:bg-green-500/20":t.shouldHighlight&&t.isWinner,"bg-red-500/20 dark:bg-red-500/20":t.shouldHighlight&&t.isLoser}]),onMouseenter:r,onMouseleave:E},[t.canEdit&&t.permissions[e.unref(T).CAN_SELECT_TEAM]?(e.openBlock(),e.createElementBlock("div",V,[o.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:o.value,alt:n.value,class:"w-6 h-6 rounded-full"},null,8,q)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":p[0]||(p[0]=u=>n.value=u),class:"fi-select-input p-0 w-full border-none bg-transparent text-base text-gray-900 transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900 hover:cursor-pointer",onChange:h},[p[1]||(p[1]=e.createElementVNode("option",{value:"TBD"},"TBD",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,u=>(e.openBlock(),e.createElementBlock("option",{key:u.id,value:u.name,disabled:f(u.name)},e.toDisplayString(u.name),9,v))),128))],544),[[e.vModelSelect,n.value]])])):(e.openBlock(),e.createElementBlock("div",W,[t.team.logo?(e.openBlock(),e.createElementBlock("img",{key:0,src:t.team.logo,alt:t.team.name,class:"w-6 h-6 rounded-full"},null,8,P)):e.createCommentVNode("",!0),e.createElementVNode("span",F,e.toDisplayString(t.team.name),1)]))],34))}},R={key:1,class:"text-white"},H={__name:"TeamScoreInput",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},canEditScore:{type:Boolean,required:!0},isFirstTeam:{type:Boolean,default:!1}},emits:["update:score"],setup(t,{emit:b}){const a=t,i=b,n=e.ref(!1),o=e.ref(a.team.score??0),f=()=>{a.canEditScore&&(n.value=!0)},g=()=>{const r=parseInt(o.value)||0;i("update:score",{position:a.teamPosition,score:r})};return e.watch(()=>a.team,r=>{o.value=r.score??0},{deep:!0}),(r,E)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["p-2.5 bg-orange-500 dark:bg-orange-600 cursor-pointer min-w-10 text-center",{"border-b border-orange-600 dark:border-orange-700":t.isFirstTeam}]),onClick:f},[n.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":E[0]||(E[0]=h=>o.value=h),class:"w-12 border-none bg-orange-500 dark:bg-orange-600 text-center text-white text-base transition duration-75 focus:ring-0 disabled:text-gray-500 disabled:[-webkit-text-fill-color:theme(colors.gray.500)] dark:text-white dark:disabled:text-gray-400 dark:disabled:[-webkit-text-fill-color:theme(colors.gray.400)] sm:text-sm sm:leading-6 [&_optgroup]:bg-white [&_optgroup]:dark:bg-gray-900 [&_option]:bg-white [&_option]:dark:bg-gray-900",min:"0",onChange:g,onBlur:E[1]||(E[1]=h=>n.value=!1)},null,544)),[[e.vModelText,o.value]]):(e.openBlock(),e.createElementBlock("span",R,e.toDisplayString(t.team.score),1))],2))}},z={class:"flex"},M={__name:"TeamRow",props:{team:{type:Object,required:!0},teamPosition:{type:String,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},canEdit:{type:Boolean,required:!0},canEditScore:{type:Boolean,required:!0},isWinner:{type:Boolean,default:!1},isLoser:{type:Boolean,default:!1},shouldHighlight:{type:Boolean,default:!1},isFirstTeam:{type:Boolean,default:!1},highlightedTeam:{type:Number,default:null},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0,[T.CAN_EDIT_SCOPE]:!0})}},emits:["update:team","update:score","highlight-team","unhighlight-team"],setup(t){return(b,a)=>(e.openBlock(),e.createElementBlock("div",z,[e.createVNode(j,{team:t.team,"team-position":t.teamPosition,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"can-edit":t.canEdit,"is-winner":t.isWinner,"is-loser":t.isLoser,"should-highlight":t.shouldHighlight,"is-first-team":t.isFirstTeam,"onUpdate:team":a[0]||(a[0]=i=>b.$emit("update:team",i)),onHighlightTeam:a[1]||(a[1]=i=>b.$emit("highlight-team",i)),onUnhighlightTeam:a[2]||(a[2]=i=>b.$emit("unhighlight-team"))},null,8,["team","team-position","available-teams","selected-teams","highlighted-team","permissions","can-edit","is-winner","is-loser","should-highlight","is-first-team"]),e.createVNode(H,{team:t.team,"team-position":t.teamPosition,"can-edit-score":t.canEditScore,"is-first-team":t.isFirstTeam,"onUpdate:score":a[3]||(a[3]=i=>b.$emit("update:score",i))},null,8,["team","team-position","can-edit-score","is-first-team"])]))}},J={class:"flex flex-col w-full"},G={class:"px-3 py-1 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center"},K=["value","disabled"],Q={key:0,class:"absolute top-1/2 left-full w-2.5 h-[calc(100%+2px)] border-2 border-gray-300 dark:border-gray-600 border-l-0 rounded-r flex items-center z-10 -mt-[-10px] ml-[15px] mx-2 transition-colors duration-200"},X={__name:"BracketMatch",props:{match:{type:Object,required:!0,default:()=>({teamOne:{name:y,score:0},teamTwo:{name:y,score:0},winner:null,date:new Date().toISOString().split("T")[0]})},index:{type:Number,required:!0},totalMatches:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},roundIndex:{type:Number,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0,[T.CAN_EDIT_DATE]:!0,[T.CAN_EDIT_SCOPE]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:b}){const a=t,i=b,n=e.computed(()=>a.roundIndex===0&&a.permissions[T.CAN_SELECT_TEAM]),o=e.computed(()=>a.match[s.ONE].name!==y&&a.match[s.TWO].name!==y&&a.permissions[T.CAN_EDIT_SCOPE]),f=l=>a.match.winner===l,g=l=>a.match.winner&&a.match.winner!==l,r=l=>{const d=a.match[l].name;return a.highlightedTeam===d},E=l=>{i("highlight-team",l)},h=()=>{i("unhighlight-team")},c=({position:l,team:d})=>{const m={...a.match,[l]:d};i("update:match",m)},p=({position:l,score:d})=>{const m={...a.match,[l]:{...a.match[l],score:d}};m[s.ONE].score>m[s.TWO].score?m.winner=s.ONE:m[s.TWO].score>m[s.ONE].score?m.winner=s.TWO:m.winner=null,i("update:match",m)},u=l=>l?new Date(l).toISOString().slice(0,16):"",k=l=>{const d={...a.match,date:l.target.value};i("update:match",d)},N=l=>{const d=l.target.tagName.toLowerCase();d==="input"||d==="select"||d==="option"||d==="button"||l.target.closest("input,select,option,button")||!(!a.permissions[T.CAN_SELECT_TEAM]&&!a.permissions[T.CAN_EDIT_DATE]&&!a.permissions[T.CAN_EDIT_SCOPE])||i("click-match",{match:a.match,roundIndex:a.roundIndex,matchIndex:a.index,id:a.match.id??null})};return(l,d)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["relative text-[0.8em] flex items-center",{group:t.index%2==0&&t.totalMatches>1}])},[e.createElementVNode("div",J,[e.createElementVNode("div",G,[e.createElementVNode("input",{type:"datetime-local",value:u(t.match.date),onInput:k,class:"bg-transparent border-none focus:ring-0 p-0 text-xs",disabled:!t.permissions[e.unref(T).CAN_EDIT_DATE]},null,40,K)]),e.createElementVNode("div",{class:"my-1.5 ml-2.5 bg-white dark:bg-gray-900 rounded overflow-hidden w-full min-w-[200px] shadow-sm ring-1 ring-gray-950/5 dark:bg-gray-900 dark:ring-white/10",onClick:N},[e.createVNode(M,{team:t.match.teamOne,"team-position":e.unref(s).ONE,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":o.value,"is-winner":f(e.unref(s).ONE),"is-loser":g(e.unref(s).ONE),"should-highlight":r(e.unref(s).ONE),"is-first-team":!0,"can-select-team":l.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":c,"onUpdate:score":p,onHighlightTeam:E,onUnhighlightTeam:h},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"]),e.createVNode(M,{team:t.match.teamTwo,"team-position":e.unref(s).TWO,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"can-edit":n.value,"can-edit-score":o.value,"is-winner":f(e.unref(s).TWO),"is-loser":g(e.unref(s).TWO),"should-highlight":r(e.unref(s).TWO),"can-select-team":l.canSelectTeam,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:team":c,"onUpdate:score":p,onHighlightTeam:E,onUnhighlightTeam:h},null,8,["team","team-position","available-teams","selected-teams","can-edit","can-edit-score","is-winner","is-loser","should-highlight","can-select-team","highlighted-team","permissions"])])]),t.index%2==0&&t.totalMatches>1?(e.openBlock(),e.createElementBlock("div",Q,d[0]||(d[0]=[e.createElementVNode("span",{class:"w-2.5 h-0.5 bg-gray-300 dark:bg-gray-600 translate-x-full block"},null,-1)]))):e.createCommentVNode("",!0)],2))}},Y={class:"flex-1 px-5 pb-2.5 grid grid-cols-[min-content_auto]"},Z={class:"text-[0.7em] text-gray-900 dark:text-white flex justify-end items-center opacity-50 mt-[23px]"},_={__name:"BracketColumn",props:{column:{type:Object,required:!0},columnIndex:{type:Number,required:!0},availableTeams:{type:Array,required:!0},selectedTeams:{type:Array,required:!0},highlightedTeam:{type:String,default:null},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0})}},emits:["update:match","highlight-team","unhighlight-team","click-match"],setup(t,{emit:b}){const a=t,i=b,n=(f,g)=>{i("update:match",a.columnIndex,f,g)},o=(f,g)=>{i("click-match",{...g,roundIndex:a.columnIndex,matchIndex:f})};return(f,g)=>(e.openBlock(),e.createElementBlock("div",Y,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.column.matches,(r,E)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:r.id},[e.createElementVNode("div",Z,e.toDisplayString(r.number),1),e.createVNode(X,{match:r,index:E,"total-matches":t.column.matches.length,"round-index":t.columnIndex,"available-teams":t.availableTeams,"selected-teams":t.selectedTeams,"highlighted-team":t.highlightedTeam,permissions:t.permissions,"onUpdate:match":h=>n(E,h),onHighlightTeam:g[0]||(g[0]=h=>f.$emit("highlight-team",h)),onUnhighlightTeam:g[1]||(g[1]=h=>f.$emit("unhighlight-team")),onClickMatch:h=>o(E,h)},null,8,["match","index","total-matches","round-index","available-teams","selected-teams","highlighted-team","permissions","onUpdate:match","onClickMatch"])],64))),128))]))}},ee={class:"flex justify-between px-5"},te={class:"flex flex-col items-center gap-2"},ae={class:"mt-2"},ne={class:"flex items-center rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600"},le=["onUpdate:modelValue","onBlur","disabled"],ie={class:"grid shrink-0 grid-cols-1 focus-within:relative"},oe=["value","onChange","disabled"],se=["value"],D={__name:"BracketRoundHeaders",props:{columns:{type:Array,required:!0},permissions:{type:Object,required:!0}},emits:["update:columns"],setup(t,{emit:b}){const a=t,i=b,n=[1,3,5,7,9],o=e.ref(a.columns.map(r=>r.name));e.watch(()=>a.columns,r=>{o.value=r.map(E=>E.name)},{deep:!0});const f=(r,E)=>{o.value[r]=E;const h=[...a.columns];h[r]={...h[r],name:E},i("update:columns",h)},g=(r,E)=>{const h=[...a.columns];h[r]={...h[r],bestOf:Number(E)},i("update:columns",h)};return(r,E)=>(e.openBlock(),e.createElementBlock("div",ee,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,(h,c)=>(e.openBlock(),e.createElementBlock("div",{key:h.name,class:"flex-1 text-center text-sm text-gray-400 py-2 rounded overflow-hidden"},[e.createElementVNode("div",te,[e.createElementVNode("div",ae,[e.createElementVNode("div",ne,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":p=>o.value[c]=p,onBlur:p=>f(c,p.target.value),disabled:!t.permissions[e.unref(T).CAN_EDIT_ROUND_NAME],class:"block min-w-0 grow py-1.5 pr-3 text-gray-800 dark:text-white border-none pl-1 text-base text-gray-900 bg-white dark:bg-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6"},null,40,le),[[e.vModelText,o.value[c]]]),e.createElementVNode("div",ie,[e.createElementVNode("select",{value:h.bestOf,onChange:p=>g(c,p.target.value),disabled:!t.permissions[e.unref(T).CAN_EDIT_BEST_OF],class:"col-start-1 row-start-1 w-full text-gray-800 dark:text-white border-none appearance-none py-1.5 bg-white dark:bg-gray-900 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(n,p=>e.createElementVNode("option",{key:p,value:p}," Best of "+e.toDisplayString(p),9,se)),64))],40,oe)])])])])]))),128))]))}},re={class:"flex flex-col mt-8 border-t-2 border-gray-300 dark:border-gray-600 pt-8"},ce={class:"flex flex-col"},me={class:"overflow-x-auto"},de={class:"min-w-max"},ue={class:"flex flex-1 p-5"},he={__name:"BracketLower",props:{initialState:{type:Array,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,default:3,validator:t=>[1,3,5,7,9].includes(t)},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0,[T.CAN_EDIT_DATE]:!0,[T.CAN_EDIT_SCOPE]:!0,[T.CAN_EDIT_ROUND_NAME]:!0,[T.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state"],setup(t,{emit:b}){const a=b,i=t,n=e.ref([]),o=e.ref(null),f=e.computed(()=>{const u=new Set;return n.value.forEach(k=>{k.matches.forEach(N=>{N[s.ONE].name!==y&&u.add(N[s.ONE].name),N[s.TWO].name!==y&&u.add(N[s.TWO].name)})}),Array.from(u)}),g=u=>{o.value=u},r=()=>{o.value=null},E=(u,k,N)=>{if(console.log("Updating lower match:",{roundIndex:u,matchIndex:k,updatedMatch:N}),n.value[u]&&n.value[u].matches){if(n.value[u].matches[k]=N,N.winner&&u<n.value.length-1){const l=u+1,d=Math.floor(k/2);if(n.value[l]&&n.value[l].matches[d]){const m=n.value[l].matches[d],O=k%2===0?s.ONE:s.TWO,w=N[N.winner];n.value[l].matches[d]={...m,[O]:{id:w.id,name:w.name,logo:w.logo,score:0}}}}c()}},h=u=>{console.log("Updating lower columns:",u),n.value=u,c()},c=()=>{console.log("Emitting lower tournament state:",n.value),a("update:state",n.value)},p=()=>{console.log("Initializing lower tournament with state:",i.initialState),i.initialState&&i.initialState.length>0&&(n.value=JSON.parse(JSON.stringify(i.initialState)))};return e.watch(()=>i.initialState,()=>{p()},{deep:!0}),e.onMounted(()=>{p()}),(u,k)=>(e.openBlock(),e.createElementBlock("div",re,[k[0]||(k[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Lower Bracket",-1)),e.createElementVNode("div",ce,[e.createElementVNode("div",me,[e.createElementVNode("div",de,[e.createVNode(D,{columns:n.value,"onUpdate:columns":h,permissions:t.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",ue,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(N,l)=>(e.openBlock(),e.createBlock(_,{key:N.id,column:N,"column-index":l,"available-teams":t.availableTeams,"selected-teams":f.value,"highlighted-team":o.value,permissions:t.permissions,"onUpdate:match":E,onHighlightTeam:g,onUnhighlightTeam:r},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])])]))}},L=()=>({id:null,name:y,logo:null,score:0}),U=t=>({id:`match-${t}`,number:t,[s.ONE]:L(),[s.TWO]:L(),winner:null,date:null}),ge=(t,b=3)=>{const a=[],i=Math.log2(t);let n=1;for(let o=0;o<i;o++){const f=Math.pow(2,i-o-1),g=[];for(let r=0;r<f;r++)g.push(U(n++));a.push({id:`upper-round-${o+1}`,name:`Round ${o+1}`,matches:g,bestOf:b})}return a},C=(t,b)=>{const a=[];let i=1;const n=t-1;for(let o=0;o<n;o++){const f=Math.pow(2,t-o-2),g=[];for(let r=0;r<f;r++)g.push(U(i++));a.push({id:`lower-round-${o+1}`,name:`Lower Round ${o+1}`,matches:g,bestOf:b})}return a},fe={class:"flex flex-col"},pe={class:"flex flex-col"},Te={class:"overflow-x-auto"},Ee={class:"min-w-max"},be={class:"flex flex-1 p-5"},$={__name:"TournamentBracket",props:{initialState:{type:Object,required:!0},availableTeams:{type:Array,required:!0},defaultBestOf:{type:Number,required:!0},format:{type:String,required:!0},permissions:{type:Object,required:!0,default:()=>({[T.CAN_SELECT_TEAM]:!0,[T.CAN_EDIT_ROUND_NAME]:!0,[T.CAN_EDIT_BEST_OF]:!0})}},emits:["update:state","click-match"],setup(t,{emit:b}){const a=b,i=t,n=e.ref([]),o=e.ref([]),f=e.ref(null),g=e.computed(()=>{const l=new Set;return n.value.forEach(d=>{d.matches.forEach(m=>{m[s.ONE].name!==y&&l.add(m[s.ONE].name),m[s.TWO].name!==y&&l.add(m[s.TWO].name)})}),i.format===B.DOUBLE_ELIMINATION&&o.value.forEach(d=>{d.matches.forEach(m=>{m[s.ONE].name!==y&&l.add(m[s.ONE].name),m[s.TWO].name!==y&&l.add(m[s.TWO].name)})}),Array.from(l)}),r=l=>{f.value=l},E=()=>{f.value=null},h=(l,d,m)=>{if(console.log("Updating upper match:",{roundIndex:l,matchIndex:d,updatedMatch:m}),n.value[l]&&n.value[l].matches){if(n.value[l].matches[d]=m,m.winner&&l<n.value.length-1){const O=l+1,w=Math.floor(d/2);if(n.value[O]&&n.value[O].matches[w]){const S=n.value[O].matches[w],I=d%2===0?s.ONE:s.TWO,A=m[m.winner];n.value[O].matches[w]={...S,[I]:{id:A.id,name:A.name,logo:A.logo,score:0}}}}if(i.format===B.DOUBLE_ELIMINATION&&m.winner){const O=m[m.winner===s.ONE?s.TWO:s.ONE];if(O.name!==y){const w=Math.floor(l/2),S=Math.floor(d/2);if(o.value[w]&&o.value[w].matches[S]){const I=o.value[w].matches[S],A=d%2===0?s.ONE:s.TWO;o.value[w].matches[S]={...I,[A]:{id:O.id,name:O.name,logo:O.logo,score:0}}}}}u()}},c=l=>{console.log("Updating upper columns:",l),n.value=l,u()},p=l=>{console.log("Updating lower state:",l),o.value=l,u()},u=()=>{console.log("Emitting tournament state:",{upper:n.value,lower:i.format===B.DOUBLE_ELIMINATION?o.value:null}),a("update:state",{upper:n.value,lower:i.format===B.DOUBLE_ELIMINATION?o.value:null})},k=()=>{console.log("Initializing tournament with state:",i.initialState),i.initialState&&(Array.isArray(i.initialState)?(n.value=JSON.parse(JSON.stringify(i.initialState)),i.format===B.DOUBLE_ELIMINATION&&(o.value=C(n.value.length,i.defaultBestOf))):(n.value=JSON.parse(JSON.stringify(i.initialState.upper||[])),o.value=JSON.parse(JSON.stringify(i.initialState.lower||[]))))};e.watch(()=>i.initialState,()=>{k()},{deep:!0}),e.watch(()=>i.format,l=>{l===B.DOUBLE_ELIMINATION&&(!o.value||o.value.length===0)&&(o.value=C(n.value.length,i.defaultBestOf),u())});const N=l=>{a("click-match",l)};return e.onMounted(()=>{k()}),(l,d)=>(e.openBlock(),e.createElementBlock("div",fe,[d[0]||(d[0]=e.createElementVNode("div",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Upper Bracket",-1)),e.createElementVNode("div",pe,[e.createElementVNode("div",Te,[e.createElementVNode("div",Ee,[e.createVNode(D,{columns:n.value,"onUpdate:columns":c,permissions:t.permissions},null,8,["columns","permissions"]),e.createElementVNode("div",be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(m,O)=>(e.openBlock(),e.createBlock(_,{key:m.id,column:m,"column-index":O,"available-teams":t.availableTeams,"selected-teams":g.value,"highlighted-team":f.value,permissions:t.permissions,"onUpdate:match":h,onHighlightTeam:r,onUnhighlightTeam:E,onClickMatch:N},null,8,["column","column-index","available-teams","selected-teams","highlighted-team","permissions"]))),128))])])])]),t.format===e.unref(B).DOUBLE_ELIMINATION?(e.openBlock(),e.createBlock(he,{key:0,"initial-state":o.value,"available-teams":t.availableTeams,"default-best-of":t.defaultBestOf,permissions:t.permissions,"onUpdate:state":p},null,8,["initial-state","available-teams","default-best-of","permissions"])):e.createCommentVNode("",!0)]))}},ye=t=>{t.component("TournamentBracket",$)};x.PERMISSIONS=T,x.TournamentBracket=$,x.createLowerBracketStructure=C,x.createTournamentState=ge,x.install=ye,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
